{"version":3,"sources":["WPTB_Builder.js","WPTB_Button.js","WPTB_Cell.js","WPTB_ElementCounters.js","WPTB_ElementOptions.js","WPTB_Image.js","WPTB_Initializer.js","WPTB_LeftPanel.js","WPTB_List.js","WPTB_ListItem.js","WPTB_MultipleSelect.js","WPTB_Parser.js","WPTB_Settings.js","WPTB_Space.js","WPTB_Stringifier.js","WPTB_Table.js","WPTB_Text.js","applyGenericItemSettings.js","wptb-builder.js"],"names":["detectMode","url","window","location","href","regex","RegExp","results","exec","decodeURIComponent","replace","WPTB_Builder","table_id","http","XMLHttpRequest","ajaxurl","open","setRequestHeader","onreadystatechange","d","readyState","status","document","getElementsByClassName","style","display","appendChild","WPTB_Parser","responseText","send","counter","ElementCounters","select","MultipleSelect","initializer","WPTB_Initializer","settings","WPTB_Settings","addEventListener","WPTB_Button","text","DOMElement","createElement","elButton2","el_B","kind","classList","add","innerHTML","undefined","getDOMElement","applyGenericItemSettings","WPTB_Cell","callback","console","log","newElementProxy","el","WPTB_List","WPTB_Image","WPTB_Text","highlightRow","td","parentRow","parentNode","columnCount","parseInt","getElementById","value","tds","getElementsByTagName","i","length","remove","classToAdd","ttd","highlightColumn","index","rowCount","table","tr","draggable","onclick","ondragenter","e","div","dataTransfer","getData","ondragover","preventDefault","ondragleave","ondrop","element","classId","space","t_space","spaceParent","WPTB_Space","nextSibling","removeChild","setCoords","y","x","dataset","yIndex","xIndex","getCoords","coords","appendElement","node","priv","increment","key","nextIndex","WPTB_ElementOptions","elemIdClass","prop","querySelector","cloneNode","properties","infArr","className","match","optionsClass","children","childNodes","buttons","size","n_Class","type","num","affectedEl","b","optionControls","contains","jQuery","wpColorPicker","change","event","ui","parent","target","classe","ps","number","backgroundColor","color","toString","slider","oninput","onchange","val","img","src","alt","width","height","fontSize","bullets","querySelectorAll","listStyleType","toLowerCase","file_frame","wp","media","frames","title","button","multiple","on","attachment","state","get","first","toJSON","MIN_COLUMNS","MIN_ROWS","MAX_COLUMNS","MAX_ROWS","tableGenerator","body","columnsDecrementButton","columnsIncrementButton","rowsDecrementButton","rowsIncrementButton","columnsInput","rowsInput","columns","rows","WPTB_Table","WPTB_LeftPanel","wptbElementButtons","tableRows","j","tableHeader","addInnerBorderSize","tableCells","border","addCellPadding","padding","addInnerBorder","checked","styles","marginBottom","addBorderSize","_val","ondragstart","setData","wptbElement","toggleTableEditMode","addRowToTheEnd","addRowToTheStart","addRowBefore","addRowAfter","addColumnEnd","addColumnStart","mergeCells","splitCell","innerElements","el_L","item","WPTB_ListItem","divdot","divcontent","libullet","onkeyup","listItemKeyListener","onmouseenter","btnDelete","btnCopy","actions","previous","article","content","html","duplicate","append","onmouseleave","onkeydown","which","keyCode","lastP","dontAddItems","insertBefore","focus","selectedCells","multipleCellMode","activateMultipleSelectMode","deactivateMultipleSelectMode","isActivated","pushSelectedCell","cell","push","flushSelectedCells","getFirst","minXIndex","minYIndex","getLast","maxXIndex","maxYIndex","last","removeAllButFirst","code","pos","getChar","getToken","char","token","ctoken","getCurrentToken","getExpectedToken","expected","getWordFromToken","p","indexOf","word","substring","getAttributesFromToken","elems","split","pair","attr","trim","parseAllHTML","analizeElement","t","analizeElements","analizeRows","tableNode","insertRow","analizeTds","analizeTd","row","analizeHeader","header","analizeRoot","n","effectAllowed","getAttribute","messagingArea","WPTB_Stringifier","setTimeout","params","spaceBetween","stopPropagation","tagName","margin","bg1","bg2","bg3","colSpan","rowSpan","isHidden","listClass","buttonSize","buttonColor","buttonBorder","fontColor","fontFamily","additionalCSS","additionalClass","additionalID","borderSize","innerBorder","colspan","rowspan","trueNode","nodeContent","listitems","array","wptbTableSetup","maxAmountOfCells","maxAmountOfRows","mark","rs","cs","markedCells","position","column","realTimeArray","carried","cols","matriz","items","k","justAssigned","amount","carriedRowspans","colspansAcumulados","bar","recalculateIndexes","trs","maxCols","undoSelect","firstCell","addColumnBefore","addColumnAfter","addRow","_this","referenceRow","active","evt","r","aux","Array","from","drawTable","rowspans","noPending","filter","elem","arr","isSquare","a","rowStart","columnStart","rowEnd","columnEnd","itemsEstimate","string","fillTableArray","colspansSums","cells","colspanSumInRow","Math","max","apply","search","skipInCols","slice","call","shift","deleteRow","tbody","deleteColumn","dimensions","refCell","pt","newCell","elText2","elP","listItems","btnMove","act","temp","srcList","copy","setDragImage","tinyMCE","init","inline","plugins","dialog_type","theme","menubar","fixed_toolbar_container","toolbar","setup","ed","execCommand","init_instance_callback","editor","getContent","setContent","range","selection","getRng","KeyID","startOffset","currentEditor","totalWidth","offsetWidth","scrollTop","bodyElement","right","top","paste_as_text","formerActions","par"],"mappings":"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","file":"admin.js","sourcesContent":["(function(){  \n\n\tfunction detectMode() {\n\t    var url = window.location.href, \n\t    \tregex = new RegExp('[?&]table(=([^&#]*)|&|#|$)'),\n\t        results = regex.exec(url);\n\t    if (!results) return false;\n\t    if (!results[2]) return '';\n\t    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n\t}\n\t\n\tvar WPTB_Builder = function(){ \n\t\tvar table_id = detectMode();\n\t\tif(table_id){\n\t\t\tvar http = new XMLHttpRequest(),\n        \turl = ajaxurl+\"?action=get_table\"+'&id='+table_id;\n\t\t\thttp.open('GET', url, true);\n\t\t\thttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\t\t\thttp.onreadystatechange = function(d) {\n\t            if (this.readyState == 4 && this.status == 200) {\n            \t\tdocument.getElementsByClassName('wptb-table-generator')[0].style.display = 'none';\n\t                document.getElementsByClassName('wptb-table-setup')[0].appendChild(WPTB_Parser(http.responseText));\n\t            }\n\t\t\t}\n\t\t\thttp.send(null);\n\t\t}\n\t\tdocument.counter = new ElementCounters();\n\t\tdocument.select = new MultipleSelect();\n\n\t\tvar initializer = WPTB_Initializer();\n\t\t\tsettings = WPTB_Settings();\n\t};\n\n\tdocument.addEventListener('DOMContentLoaded', WPTB_Builder); \n})();","var WPTB_Button = function(text){\n        var DOMElement = document.createElement('div'),\n        \telButton2 = document.createElement('div'),\n        \tel_B = document.createElement('p');\n\n\t\tthis.kind = 'button';\n\n        DOMElement.classList.add('wptb-button-container');\n        elButton2.classList.add('wptb-button-wrapper');\n        el_B.classList.add('wptb-button');\n        el_B.classList.add('editable');\n        el_B.innerHTML = text != undefined ? text : 'Button Text';\n        elButton2.appendChild(el_B);\n        DOMElement.appendChild(elButton2);\n\n        this.getDOMElement = function (){ \n        \treturn DOMElement;\n        }\n\n        applyGenericItemSettings(this);\n\n        return this;\n};","var WPTB_Cell = function(callback,DOMElement){\n        console.log('CB',callback);\n\t\tfunction newElementProxy(el){\n\t\t\tif(el == 'list'){\n                return new WPTB_List();\n            }\n            else if(el == 'image'){\n                return new WPTB_Image();\n            }   \n            else if(el == 'text'){\n                return new WPTB_Text();\n            }\n            else if(el == 'button'){\n                return new WPTB_Button();\n            }\n\t\t}\n\n        function highlightRow(td){\n            var parentRow = td.parentNode,\n                columnCount = parseInt(document.getElementById('wptb-columns-number').value),\n                tds = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n                for (var i = 0; i < tds.length; i++) {\n                    tds[i].classList.remove('highlighted-row-first','highlighted-row-last','highlighted-row-inner',\n                                            'highlighted-column-first','highlighted-column-last','highlighted-column-inner');\n                }\n                for (var i = 0; i < columnCount; i++) {\n\n                    var classToAdd = (i == 0 ? 'highlighted-row-first' : \n                                    (i == columnCount-1 ? 'highlighted-row-last' \n                                        : 'highlighted-row-inner'));\n                    var ttd = parentRow.getElementsByTagName('td')[i];\n                    if(ttd!==td){\n                    ttd.classList.add(classToAdd);\n                    }\n                }\n        }\n\n        function highlightColumn(td){\n           \n            var index,\n                parentRow = td.parentNode;\n                columnCount = parseInt(document.getElementById('wptb-columns-number').value),\n                rowCount = parseInt(document.getElementById('wptb-rows-number').value),\n                table = document.getElementsByClassName('wptb-preview-table')[0];\n                for (var i = 0; i < columnCount; i++) {\n                    if(parentRow.getElementsByTagName('td')[i] === td ){\n                        index = i;\n                        break;\n                    }\n                }\n\n                for (var i = 0; i < rowCount; i++) {\n                    var classToAdd = (i == 0 ? 'highlighted-column-first' : \n                                    (i == rowCount-1 ? 'highlighted-column-last' \n                                        : 'highlighted-column-inner'));\n                    var tr = table.getElementsByTagName('tr')[i];\n                    if(tr.getElementsByTagName('td')[index]!==td){\n                        tr.getElementsByTagName('td')[index].classList.add(classToAdd);\n                    }\n                }\n        }\n        \n        DOMElement = document.createElement(\"td\");\n\n        DOMElement.draggable = false;\n        \n        DOMElement.classList.add('wptb-droppable', 'wptb-cell');  \n\n        DOMElement.onclick = callback; /*function(){\n\n        \tvar relativeActions, cells;\n\n        \tif(!document.select.isActivated()){\n        \t\treturn;\n        \t}\n        \telse{\n        \t \n\n            if(this.classList.contains('wptb-highlighted')){\n                this.classList.remove('wptb-highlighted');\n            }\n            else{\n                console.log('Not contains');\n        \t\tthis.classList.add('wptb-highlighted');    \n                //highlightRow(this);\n                //highlightColumn(this);\n            }\n\n        \t}\n        \t\n        };*/;\n\n        DOMElement.ondragenter = function(e){\n        \tvar div;\n            if(!e.dataTransfer.getData('wptbElement') \n                && !e.dataTransfer.getData('node')){\n                return;\n            }\n        \tthis.classList.add('wptb-drop-here-empty');\n        }\n\n        DOMElement.ondragover = function(e){\n        \te.preventDefault();\n        }\n\n        DOMElement.ondragleave = function(){\n        \tthis.classList.remove('wptb-drop-here-empty');\n\n        }\n\n        DOMElement.ondrop = function(e){\n        \tvar element, classId, space, t_space, spaceParent;\n        \te.preventDefault();\n            space = new WPTB_Space();\n\n            console.log(e.dataTransfer);\n\n            if(!e.dataTransfer.getData('wptbElement') \n                && !e.dataTransfer.getData('node')){\n                return;\n            }\n\n            if(e.dataTransfer.getData('wptbElement')){\n        \t   element = newElementProxy(e.dataTransfer.getData('wptbElement'));\n                if(this.innerHTML==''){\n                    this.appendChild(new WPTB_Space());\n                }\n                this.appendChild(element.getDOMElement());\n                this.appendChild(space);\n        \t}\n            else{\n\n                classId = e.dataTransfer.getData('node');\n                element = document.getElementsByClassName(classId)[0];\n                if(this.innerHTML==''){\n                    t_space = element.nextSibling;\n                    spaceParent = element.parentNode;\n                    if(t_space != undefined){\n                        spaceParent.removeChild(t_space);\n                    }\n                    this.appendChild(new WPTB_Space());\n                }\n                this.appendChild(element);\n                this.appendChild(space);\n            }\n        \tthis.classList.remove('wptb-drop-here-empty');\n        \treturn true;\n        }\n\n        this.getDOMElement = function (){ \n        \treturn DOMElement;\n        }\n\n        this.setCoords = function(y,x){\n        \tvar el = this.getDOMElement();\n        \tel.dataset.yIndex = y;\n        \tel.dataset.xIndex = x;\n        }\n\n        this.getCoords = function(){\n        \tvar coords,\n        \t\tel = this.getDOMElement();\n        \tcoords.x = el.dataset.xIndex;\n        \tcoords.y = el.dataset.yIndex;\n        \treturn coords;\n        }\n\n        this.appendElement = function(node){\n        \tgetDOMElement().appendChild(node);\n        }\n\n        return this;\n\n};","var ElementCounters = function(){\n\tvar priv = [];\n\tpriv['text'] = 0;\n\tpriv['image'] = 0;\n\tpriv['list'] = 0;\n\tpriv['button'] = 0; \n\n\tthis.increment = function(key){\n\n\t\tif(! (key in priv) ){\n\t\t\treturn;\n\t\t}\n\n\t\tpriv[key]++;\n\t}\n\tthis.nextIndex = function(key){\n\n\t\tif(! (key in priv) ){\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn priv[key] + 1;\n\t}\n\treturn this;\n};","var WPTB_ElementOptions = function(element,index){\n\n\tvar node = element.getDOMElement(), elemIdClass;\n\n\tprop = document.querySelector(\".wptb-\" + element.kind + \"-options-prototype\").cloneNode(true);\n    prop.classList.remove(\"wptb-\" + element.kind + \"-options-prototype\"); // remove prototype from the class\n    elemIdClass='wptb-options-' + element.kind + \"-\" +  index;\n\n    var properties = prop.getElementsByClassName('wptb-element-property');\n\n    for (var i = 0; i < properties.length; i++) {\n    \tproperties[i].dataset.element = elemIdClass;\n    }\n\n    prop.classList.add(elemIdClass);\n    document.getElementById(\"element-options-group\").appendChild(prop);\n\n    node.onclick = function(){\n        var infArr = this.className.match(/wptb-element-((.+-)\\d+)/i),\n\t\t\toptionsClass = '.wptb-' + infArr[2] + 'options' +\n                        '.wptb-options-' + infArr[1];\n\n    \tdocument.getElementById('add-elements').getElementsByTagName('a')[0].classList.remove('active');\n        document.getElementById('element-options').getElementsByTagName('a')[0].classList.add('active');\n\t\t\n\t\tdocument.getElementsByClassName('wptb-elements-container')[0].style.display = 'none';\n        document.getElementsByClassName('wptb-settings-section')[0].style.display = 'none';\n        document.getElementById(\"element-options-group\").style.display = 'block';\n\n        var children = document.getElementById(\"element-options-group\").childNodes;\n        for (var i = 0; i < children.length; i++) {\n            if (children[i].style)\n                children[i].style.display = 'none';\n        }\n\n        document.querySelector(optionsClass).style.display = 'block';\n    };\n\n    if(element.kind == 'button'){\n        //We must add this special kind of property, since it is triggered with click event\n        var buttons = prop.getElementsByClassName('wptb-btn-size-btn');\n\n        for (var i = 0; i < buttons.length; i++) {\n            buttons[i].onclick = function(){\n                console.log('Now we should change button size');\n                var size = this.innerHTML,\n                n_Class = this.dataset.element,\n                infArr = n_Class.match(/wptb-options-(.+)-(\\d+)/i),\n                type = infArr[1],\n                num = infArr[2],\n                affectedEl = document.getElementsByClassName('wptb-element-'+type+'-'+num)[0];\n                affectedEl.classList.remove('wptb-size-S');\n                affectedEl.classList.remove('wptb-size-M');\n                affectedEl.classList.remove('wptb-size-L');\n                affectedEl.classList.remove('wptb-size-XL');\n                affectedEl.classList.add('wptb-size-'+size);\n                var b = prop.getElementsByClassName('wptb-btn-size-btn');\n                for (var i = 0; i < b.length; i++) {\n                    b[i].classList.remove('selected');\n                }\n                this.classList.add('selected');\n            }\n        }\n    }\n\n    var optionControls = prop.getElementsByClassName('wptb-element-property');\n\n    for (var i = 0; i < optionControls.length; i++) {\n    \tif(optionControls[i].classList.contains('wptb-color-picker')){\n    \t\tjQuery(optionControls[i]).wpColorPicker({\n                change: function(event, ui){\n                    var parent = event.target, classe, type, ps, number;\n \n\n\n                    classe = parent.dataset.element.match(/wptb-options-(.+)-(\\d+)/i);\n                    type = classe[1];\n                    number = classe[2]; \n                    affectedEl = document.getElementsByClassName('wptb-element-'+type+'-'+number)[0];\n                    if(type=='button'){\n                        affectedEl.getElementsByClassName('wptb-button')[0].style.backgroundColor = ui.color.toString();\n                    }\n                    else{\n                        ps = affectedEl.getElementsByTagName(\"p\");\n                        for (var i = 0; i < ps.length; i++) {\n                                ps[i].style.color =  ui.color.toString();\n                        } \n                    }\n                }\n            });\n    \t}\n\n        if(optionControls[i].dataset.type === 'font-size'){\n            var slider = optionControls[i].parentNode.parentNode.getElementsByClassName('wptb-text-font-size-slider')[0];\n            slider.oninput = function(){\n                this.parentNode.parentNode.getElementsByClassName('wptb-text-font-size-number')[0].value = this.value;\n                this.parentNode.parentNode.getElementsByClassName('wptb-text-font-size-number')[0].onchange();\n            }\n        }\n\n    \toptionControls[i].onchange = function(event){\n\n    \t\tvar n_Class = this.dataset.element,\n    \t\t\tinfArr = n_Class.match(/wptb-options-(.+)-(\\d+)/i),\n\t\t\t\ttype = infArr[1],\n                num = infArr[2],\n    \t\t\taffectedEl = document.getElementsByClassName('wptb-element-'+type+'-'+num)[0],\n    \t\t\tval = this.value;\n \n\n    \t\tswitch(this.dataset.type){\n                case 'src':\n                        var img = affectedEl.getElementsByTagName(\"img\")[0];\n                        img.src=this.value;\n                        break; \n                    case 'alternative-text':\n                        var img = affectedEl.getElementsByTagName(\"img\")[0];\n                        img.alt=this.value;\n                        break;\n                    case 'image-width':\n                        var img = affectedEl.getElementsByTagName(\"img\")[0];\n                        console.log(img,this.value);\n                        img.width=this.value;\n                        break; \n                    case 'image-height':\n                        var img = affectedEl.getElementsByTagName(\"img\")[0];\n                        img.height=this.value;\n                        break; \n    \t\t\tcase 'font-size':\n                        var ps = affectedEl.getElementsByTagName(\"p\");\n                        for (var i = 0; i < ps.length; i++) {\n                            ps[i].style.fontSize =  val + 'px';\n                        }\n\n                        this.parentNode.parentNode.getElementsByClassName('wptb-text-font-size-slider')[0].value = this.value;\n                        \n                        break;\n                    case 'color':\n                        var ps = affectedEl.getElementsByTagName(\"p\");\n                        for (var i = 0; i < ps.length; i++) {\n                            ps[i].style.color =  val;\n                        } \n                        break;\n                    case 'button-color': console.log('Event called!'); \n                                        break;\n                    case 'list-class': \n                        if (val == 'unordered') {\n                            event.target\n                                .parentNode\n                                .parentNode\n                                .querySelector('[data-type=list-style-type]')\n                                .parentNode\n                                .style\n                                .display= 'flex';\n                            var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                            for (var i = 0; i < bullets.length; i++) {\n                                bullets[i].style.listStyleType= 'disc';\n                            }\n                            document.querySelector('[data-type=list-style-type]').value = 'disc';\n                        } else {\n                            event.target\n                                .parentNode\n                                .parentNode\n                                .querySelector('[data-type=list-style-type]')\n                                .parentNode\n                                .style\n                                .display= 'none';\n                            var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                            for (var i = 0; i < bullets.length; i++) {\n                                bullets[i].style.listStyleType= 'decimal';\n                            } \n                        }\n                        break; \n                    case 'list-style-type':\n                            var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                            for (var i = 0; i < bullets.length; i++) {\n                                bullets[i].style.listStyleType= val.toLowerCase();\n                            } \n                        break;\n    \t\t}\n    \t};\n    }\n};","var WPTB_Image = function(src){\n        var DOMElement = document.createElement('div'),\n        \timg = document.createElement('img');\n\n\t\tthis.kind = 'image';\n\n        DOMElement.appendChild(img);\n\n        this.getDOMElement = function (){ \n        \treturn DOMElement;\n        }\n        applyGenericItemSettings(this);\n\n        file_frame = wp.media.frames.file_frame = wp.media({\n                                        title: 'Select a image to upload',\n                                        button: {\n                                                text: 'Use this image',\n                                        },\n                                        multiple: false  \n                                });\n                                // When an image is selected, run a callback.\n                                file_frame.on( 'select', function() {\n                                        attachment = file_frame.state().get('selection').first().toJSON();\n                                        img.src = attachment.url; \n                                });\n                                        // Finally, open the modal\n        if(src==undefined){\n                file_frame.open();\n        }\n        else{\n                img.src=src;\n        }\n\n        return this;\n};","var WPTB_Initializer = function(){\n\tconst MIN_COLUMNS = 1,\n\t\t  MIN_ROWS = 1,\n\t\t  MAX_COLUMNS = 10,\n\t\t  MAX_ROWS = 10;\n\n\tvar tableGenerator = document.body;\n\t\tcolumnsDecrementButton = tableGenerator.getElementsByClassName('wptb-input-number-decrement')[0],\n\t\tcolumnsIncrementButton = tableGenerator.getElementsByClassName('wptb-input-number-increment')[0],\n\t\trowsDecrementButton = tableGenerator.getElementsByClassName('wptb-input-number-decrement')[1],\n\t\trowsIncrementButton = tableGenerator.getElementsByClassName('wptb-input-number-increment')[1],\n\t\tcolumnsInput = document.getElementById('wptb-columns-number'),\n\t\trowsInput = document.getElementById('wptb-rows-number');\n\n\n\t\tcolumnsDecrementButton.onclick = function(){\n\t\t\tif(columnsInput.value > MIN_COLUMNS){\n\t\t\t\tcolumnsInput.value--;\n\t\t\t}\n\t\t};\n\n\t\tcolumnsIncrementButton.onclick = function(){\n\t\t\tif(columnsInput.value < MAX_COLUMNS){\n\t\t\t\tcolumnsInput.value++;\n\t\t\t}\n\t\t};\n\n\t\trowsDecrementButton.onclick = function(){\n\t\t\tif(rowsInput.value > MIN_ROWS){\n\t\t\t\trowsInput.value--;\n\t\t\t}\n\t\t};\n\t\t\n\t\trowsIncrementButton.onclick = function(){\n\t\t\tif(rowsInput.value < MAX_ROWS){\n\t\t\t\trowsInput.value++;\n\t\t\t}\n\t\t};\n\n\tdocument.getElementById('wptb-generate-table').onclick = function(){\n\n\t\t\t var columns = document.getElementById('wptb-columns-number').value,\n\t\t\t \t rows = document.getElementById('wptb-rows-number').value;\n\n\t\t\t WPTB_Table(columns, rows);\n\t\t}\n\n};","var WPTB_LeftPanel = function(){\n\tvar table = document.getElementsByClassName('wptb-preview-table')[0],\n\twptbElementButtons = document.getElementsByClassName('wptb-element');\n\n\tjQuery('#wptb-even-row-bg').wpColorPicker({\n\t\tchange: function(event,ui){\n                var tableRows = table.getElementsByTagName('tr');\n                for (var i = 1; i < tableRows.length; i+=2) {\n                \ttds = tableRows[i].getElementsByTagName('td');\n                \tfor (var j = 0; j < tds.length; j++) {\n                \t\ttds[j].style.backgroundColor = ui.color.toString();\n                \t} \n                }\n    \t}\n\t}); \n    jQuery('#wptb-odd-row-bg').wpColorPicker({\n    \tchange: function(event,ui){\n                var tableRows = table.getElementsByTagName('tr');\n                for (var i = 2; i < tableRows.length; i+=2) {\n                \ttds = tableRows[i].getElementsByTagName('td');\n                \tfor (var j = 0; j < tds.length; j++) {\n                \t\ttds[j].style.backgroundColor = ui.color.toString();\n                \t} \n                }\n    \t}\n    });\n    jQuery('#wptb-table-header-bg').wpColorPicker({\n    \tchange: function(event,ui){\n                var tableHeader = table.getElementsByTagName('tr')[0],\n                \ttds = tableHeader.getElementsByTagName('td');\n                \tfor (var j = 0; j < tds.length; j++) {\n                \t\ttds[j].style.backgroundColor = ui.color.toString();\n                \t} \n    \t}\n    });\n\n\n\n    function addInnerBorderSize(value) {\n                var tableCells = table.getElementsByTagName('td');\n                for (var i = 0; i < tableCells.length; i++) {\n                    tableCells[i].style.border = value + 'px solid';\n                }\n    }\n\n    function addCellPadding(value) {\n                var tableCells = table.getElementsByTagName('td');\n                for (var i = 0; i < tableCells.length; i++) {\n                    tableCells[i].style.padding = value + 'px';\n                }\n    }\n\n\n    function addInnerBorder(checked) {\n                var styles;\n\n                if (checked == 'checked') {\n                    document.getElementById('wptb-apply-inner-border').style.marginBottom = '0px';\n                    var tableCells = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n                    for (var i = 0; i < tableCells.length; i++) {\n                        tableCells[i].style.border = '1px solid';\n                    }\n\n                    document.getElementById('wptb-inner-border-settings').classList.add('visible');\n                } else {\n                    document.getElementById('wptb-inner-border-settings').classList.remove('visible');\n                    var tableCells = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n                    for (var i = 0; i < tableCells.length; i++) {\n                        tableCells[i].style.border = '';\n                    }\n                }\n    }\n\n    function addBorderSize(value) {\n                table.style.border = value + 'px solid';\n    }\n\n    document.getElementById('wptb-table-cell-slider').oninput = function () {\n            document.getElementById('wptb-table-cell-number').value = this.value;\n            addCellPadding(this.value);\n    };\n\n    document.getElementById('wptb-table-cell-number').onchange = function () {\n            document.getElementById('wptb-table-cell-slider').value = this.value;\n            addCellPadding(this.value);\n    };\n\n    document.getElementById('wptb-table-border-slider').oninput = function () {\n            document.getElementById('wptb-table-border-number').value = this.value;\n            addBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-border-number').onchange = function () {\n            document.getElementById('wptb-table-border-slider').value = this.value;\n            addBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-inner-border-slider').oninput = function () {\n            document.getElementById('wptb-table-inner-border-number').value = this.value;\n            addInnerBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-inner-border-number').onchange = function () {\n            document.getElementById('wptb-table-inner-border-slider').value = this.value;\n            addInnerBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-inner-border-check').onchange = function () {\n                var _val = this.checked ? 'checked' : 'unchecked';\n                addInnerBorder(_val);\n            };\n\n\tfor (var i = 0; i < wptbElementButtons.length; i++) {\n\t\twptbElementButtons[i].ondragstart = function(e){\n\t\t\te.dataTransfer.setData('wptbElement',this.dataset.wptbElement);\n\t\t}\n\t}\n\n    document.getElementById('wptb-activate-cell-management-mode').onclick = table.toggleTableEditMode;\n\tdocument.getElementById('wptb-add-end-row').onclick = table.addRowToTheEnd;\n\tdocument.getElementById('wptb-add-start-row').onclick = table.addRowToTheStart;\n\tdocument.getElementById('wptb-add-row-before').onclick = table.addRowBefore;\n\tdocument.getElementById('wptb-add-row-after').onclick = table.addRowAfter;\n\tdocument.getElementById('wptb-add-end-column').onclick = table.addColumnEnd;\n\tdocument.getElementById('wptb-add-start-column').onclick = table.addColumnStart;\n\t//document.getElementById('wptb-add-column-before').onclick = table.addColumnBefore;\n\t//document.getElementById('wptb-add-column-after').onclick = table.addColumnAfter;\n    //document.getElementById('wptb-delete-column').onclick = table.deleteColumn;\n    //document.getElementById('wptb-delete-row').onclick = table.deleteRow;\n    document.getElementById('wptb-merge-cells').onclick = table.mergeCells;\n    document.getElementById('wptb-split-cell').onclick = table.splitCell;\n\tdocument.getElementById('add-elements').onclick = function(){\n        document.getElementById('element-options').getElementsByTagName('a')[0].classList.remove('active');\n        document.getElementById('add-elements').getElementsByTagName('a')[0].classList.add('active');\n        document.getElementsByClassName('wptb-elements-container')[0].style.display = 'table';\n        document.getElementsByClassName('wptb-settings-section')[0].style.display = 'block';\n        document.getElementById(\"element-options-group\").style.display = 'none';\n\t};\n};","var WPTB_List = function(innerElements){\n    \tvar el_L = document.createElement('ul'), item,\n\t\t\tDOMElement = document.createElement('div');\n\n\t\tthis.kind = 'list';\n\n        if (!innerElements)\n            for (var i = 0; i < 3; i++) {\n            \titem = new WPTB_ListItem('List Item ' + (i + 1));\n                el_L.appendChild(item.getDOMElement());\n            }\n        else {\n            for (var i = 0; i < innerElements.length; i++) {\n            \titem = new WPTB_ListItem(innerElements[i]);\n                el_L.appendChild(item.getDOMElement());\n            }\n        } \n        DOMElement.appendChild(el_L);\n        //window.addElementOptions('list', elList);\n\n        this.getDOMElement = function (){ \n        \treturn DOMElement;\n        }\n        applyGenericItemSettings(this);\n\n        return this;\n};","var WPTB_ListItem = function(text){\n\n        if (text == undefined) text = 'New List Item';\n        var DOMElement = document.createElement('article'),\n        \tdivdot = document.createElement('div'),\n            divcontent = document.createElement('div'),\n            libullet = document.createElement('li');\n        divdot.classList.add('wptb-list-item-style-dot');\n        divcontent.classList.add('wptb-list-item-content');\n        libullet.classList.add('wptb-bullet');\n        DOMElement.appendChild(divdot);\n        DOMElement.appendChild(divcontent);\n        divdot.appendChild(libullet);\n        divcontent.innerHTML = text;\n        divcontent.onkeyup = window.listItemKeyListener;\n\n        DOMElement.onmouseenter = function (event) {\n\n            var btnDelete = document.createElement('span'),\n                btnCopy = document.createElement('span'),\n                actions = document.createElement('span'),\n                previous, i;\n            actions.classList.add('wptb-actions');\n            btnDelete.classList.add('dashicons', 'dashicons-trash', 'delete-action');\n            btnCopy.classList.add('dashicons', 'dashicons-admin-page', 'duplicate-action');\n            this.classList.add('wptb-directlyhovered');\n\n            btnDelete.onclick = function () {\n                var item = this.parentNode.parentNode,\n                    parent = item.parentNode;\n                parent.removeChild(item);\n            };\n\n            btnCopy.onclick = function (event) {\n                console.log('Clicking item');\n                var article = event.target.parentNode.parentNode,\n                    content = article.querySelector('.wptb-list-item-content'),\n                    html = content.innerHTML;\n                var duplicate = new WPTB_ListItem(html);\n                article.parentNode.appendChild(duplicate.getDOMElement());\n            };\n\n            actions.append(btnCopy, btnDelete);\n            this.appendChild(actions);\n        };\n\n        DOMElement.onmouseleave = function (event) {\n            this.classList.remove('wptb-directlyhovered');\n            var actions = this.parentNode.querySelector('.wptb-actions');\n            if (actions != undefined) {\n                let parent = actions.parentNode;\n                parent.removeChild(actions);\n            }\n        };\n\n        divcontent.onkeydown = function (event) {\n            var key = (event.which != undefined) ? event.which :\n                event.keyCode, \n                duplicate, lastP;\n            if (key !== 13 ||\n                (window.dontAddItems !== undefined && window.dontAddItems === true)) {\n                return;\n            }\n            event.preventDefault();\n            duplicate = new WPTB_ListItem(this.innerHTML);\n            console.log('duplicate',duplicate.getDOMElement());\n            DOMElement.parentNode.insertBefore(duplicate.getDOMElement(),DOMElement);\n            console.log(divcontent);\n            divcontent.innerHTML = 'New List Item';\n            duplicate.getDOMElement().querySelector('.wptb-list-item-content').focus();\n\n            return false;\n        };\n\n        this.getDOMElement = function (){ \n        \treturn DOMElement;\n        }\n\n        return this;\n\n};","var MultipleSelect = function(){\n\t\n\tvar selectedCells = [],\n\t\tmultipleCellMode = false; \n\n\tthis.activateMultipleSelectMode = function(){\n\t\tselectedCells = [];\n\t\tvar tds = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\ttds[i].classList.remove('wptb-highlighted');\n\t\t}\n\t\tmultipleCellMode = true;\n\t}\n\n\tthis.deactivateMultipleSelectMode = function(){\n\t\tconsole.log(selectedCells);\n\t\tmultipleCellMode = false;\n\t}\n\n\tthis.isActivated = function(){\n\t\treturn multipleCellMode;\n\t}\n\n\tthis.pushSelectedCell = function(cell){ \n\t\tif(!multipleCellMode){ \n\t\t\treturn;\n\t\t}\n\t\tselectedCells.push(cell); \n\t\tcell.classList.add('wptb-highlighted');\n\t};\n\n\tthis.selectedCells = function(){\n\t\treturn selectedCells;\n\t}\n\n\tthis.flushSelectedCells = function(){\n\t\tselectedCells = [];\n\t}\n\n\tthis.getFirst = function(){\n\t\tvar minXIndex = 1000, minYIndex = 1000, first;\n\t\tfor (var i = selectedCells.length - 1; i >= 0; i--) { \n\t\t\tif(minXIndex >= selectedCells[i].dataset.xIndex \n\t\t\t\t&& minYIndex >= selectedCells[i].dataset.yIndex)\n\t\t\t{ \n\t\t\t\tfirst = selectedCells[i];\n\t\t\t\tminXIndex = selectedCells[i].dataset.xIndex ;\n\t\t\t\tminYIndex = selectedCells[i].dataset.yIndex ;\n\t\t\t}\n\t\t} \n\t\treturn first;\n\t}\n\n\tthis.getLast = function(){\n\t\tvar maxXIndex = -1, maxYIndex = -1, last;\n\t\tfor (var i = selectedCells.length - 1; i >= 0; i--) { \n\t\t\tif(maxXIndex <= selectedCells[i].dataset.xIndex \n\t\t\t\t&& maxYIndex <= selectedCells[i].dataset.yIndex)\n\t\t\t{  \n\t\t\t\tlast = selectedCells[i];\n\t\t\t\tmaxXIndex = selectedCells[i].dataset.xIndex ;\n\t\t\t\tmaxYIndex = selectedCells[i].dataset.yIndex ;\n\t\t\t}\n\t\t} \n\t\treturn last;\n\t}\n\n\tthis.removeAllButFirst = function(){\n\t\tvar td = this.getFirst();\n\t\tfor (var i = 1; i < selectedCells.length; i++) {\n\t\t    selectedCells[i].classList.add('wptb-fused-cell-'+td.dataset.xIndex+'-'+td.dataset.yIndex);\n\t\t}\n\t}\n\n\treturn this;\n};","var WPTB_Parser = function(code){\n\tvar node, pos=0;\n\n\tfunction getChar(){\n\t\tif(pos>=code.length){\n\t\t\treturn -1;\n\t\t}\n\t\treturn code[pos++];\n\t}\n\n\tfunction getToken(){\n\t\tvar char = getChar(),\n\t\t\ttoken=char; \n\n\t\tif(char !== '['){\n\t\t\treturn;\n\t\t}\n\n\t\tdo{\n\t\t\tchar = getChar();\n\t\t\tif(char === -1){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\ttoken+=char;\n\t\t}while(char != ']');\n \n\t\tctoken = token; \n\t\t\n\t\treturn true;\n\t}\n\n\tfunction getCurrentToken(){\n\t\treturn ctoken;\n\t}\n\n\tfunction getExpectedToken(expected){ \n\t\tif(getWordFromToken(ctoken) !== expected){\n\t\t\tthrow 'There was an error with the file and therefore the table could not be rendered'; \n\t\t}\n\t\t\n\t\tgetToken();\n\t}\n\n\tfunction getWordFromToken(token){ \n\t\tvar p = token.indexOf(' '),\n\t\tword = token.substring(1,p);\n\t\tif(p == -1){ //This is, if token tag has no attributes\n\t\t\treturn token;\n\t\t}\n\t\treturn '['+word+']';\n\t}\n\n\tfunction getAttributesFromToken(){\n\t\tvar elems = ctoken.split(' '),\n\t\t\tpair,\n\t\t\tkey,\n\t\t\tvalue,\n\t\t\tattr = [];\n\t\t\n\t\tfor (var i = 1; i < elems.length; i++) {\n\t\t\tpair = elems[i].trim().split('='); \n\t\t\tkey = pair[0];\n\t\t\tvalue = pair[1].substring(1,pair[1].length-1);\n\t\t\tattr[key] = value;\n\t\t}\n \n\n\t\treturn attr;\n\t}\n\n\tfunction parseAllHTML(){\n\t\tvar html='';\n\t\tpos--;\n\n\t\tdo{\n\t\t\tchar = getChar();\n\t\t\tif(char === -1){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\thtml+=char;\n\t\t}while(char != '[');\n\n\t\thtml = html.substring(0,html.length-1);\n\n\t\tpos--;\n \n\t\treturn html;\n\t\t\n\t}\n\n\tfunction analizeElement(){\n\t\tvar t = getWordFromToken(getCurrentToken()), html, node;\n\t\t\t\n\t\tswitch(t){\n\t\t\tcase '[text]': attr = getAttributesFromToken();\n\t\t\t\t\t\t\tconsole.log('Attributes',attr);\n\t\t\t\t\t\t\t getExpectedToken('[text]'); \n\t\t\t\t\t\t\thtml = parseAllHTML();\n\t\t\t\t\t\t\tnode = new WPTB_Text(html);\n\t\t\t\t\t\t\tconsole.log(html);\n\t\t\t\t\t\t\tgetToken();\n\t\t\t\t\t\t\tgetExpectedToken('[/text]'); \n\t\t\t\t\t\t\tbreak;\n\t\t\tcase '[button]': attr = getAttributesFromToken();\n\t\t\t\t\t\t\tconsole.log('Attributes',attr);\n\t\t\t\t\t\t\tgetExpectedToken('[button]'); \n\t\t\t\t\t\t\thtml = parseAllHTML();\n\t\t\t\t\t\t\tnode = new WPTB_Button(html);\n\t\t\t\t\t\t\tgetToken();\n\t\t\t\t\t\t\tgetExpectedToken('[/button]'); \n\t\t\t\t\t\t\tbreak;\n\t\t\tcase '[img]': attr = getAttributesFromToken();\n\t\t\t\t\t\t\tconsole.log('Attributes',attr);\n\t\t\t\t\t\t\tnode = new WPTB_Image(attr['src']);\n\t\t\t\t\t\t\tgetExpectedToken('[img]'); \n\t\t\t\t\t\t\tbreak;\n\t\t}\n\n\t\treturn node.getDOMElement();\n\t}\n\n\tfunction analizeElements(td){\n\t\tdo{\n\t\t\ttd.appendChild(analizeElement());\n\t\t}while(getCurrentToken()=='[image]' \n\t\t\t\t|| getCurrentToken()=='[text]' \n\t\t\t\t|| getCurrentToken()=='[list]'\n\t\t\t\t|| getCurrentToken()=='[button]' );\n\t}\n\n\tfunction analizeRows(tableNode){\n\t\tconsole.log('Tr',tr);\n\t\tdo{\n\t\t\tvar tr = tableNode.insertRow();  \n\t\t\ttr.classList.add('wptb-row');\n\t\t\tgetExpectedToken('[tr]');\n\t\t\tanalizeTds(tr);\n\t\t\tgetExpectedToken('[/tr]');\n\t\t}while(getWordFromToken(getCurrentToken()) === '[tr]');\n\t}\n\n\tfunction analizeTd(){\n\t\tvar td = new WPTB_Cell();\n\t\tgetExpectedToken('[td]');\n\t\tanalizeElements(td.getDOMElement());\n\t\tgetExpectedToken('[/td]');\n\t\treturn td.getDOMElement();\n\t}\n\n\tfunction analizeTds(row){\n\t\tdo{\n\t\t\trow.appendChild(analizeTd());\n\t\t}while(getCurrentToken()=='[td]');\n\t}\n\n\tfunction analizeHeader(tableNode){ \n\t\tvar header = tableNode.insertRow(); \n\t\theader.classList.add('wptb-row','wptb-table-head');\n\t\tconsole.log('Tr',header); \n\t\tgetExpectedToken('[tr]');\n\t\tanalizeTds(header);\n\t\tgetExpectedToken('[/tr]');\n\t}\n\n\tfunction analizeRoot(){\n\t\tgetToken();\n\t\tvar n = document.createElement('table');\n\t\tn.classList.add('wptb-preview-table');\n\t\tgetExpectedToken('[table]');\n\t\tanalizeHeader(n);\n\t\tanalizeRows(n);\n\t\tgetExpectedToken('[/table]');\n\t\treturn n;\n\t}\n\n\tnode = analizeRoot();\n\n\treturn node;\n};","var WPTB_Settings = function(){\n\t\n\tvar elems = document.getElementsByClassName('wptb-element');\n\n\tfor (var i = 0; i < elems.length; i++) {\n\t\telems[i].ondragstart = function(event){\n\t\tevent.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData(\"text/plain\", event.target.getAttribute('id'));\n\t}\n\t};\n\n\tdocument.getElementsByClassName('wptb-save-btn')[0].onclick = function(){\n\t\tvar http = new XMLHttpRequest(),\n        \turl = ajaxurl+\"?action=save_table\",\n        \tt = document.getElementById('wptb-setup-name').value.trim(), \n\t\t\tmessagingArea,\n\t\t\tcode = WPTB_Stringifier(document.getElementsByClassName('wptb-preview-table')[0]);\n\t\t\t\n\t\tif(t === ''){\n\t\t\tmessagingArea = document.getElementsByClassName('wptb-messaging')[0];\n\t\t\tmessagingArea.innerHTML = 'Error: You must assign a name to the table before saving it.';\n\t\t\tmessagingArea.classList.add('warning');\n\t\t\tsetTimeout(function(){\n\t\t\t\tmessagingArea.classList.remove('warning');\n\t\t\t},5000);\n\t\t}\n        console.log('Ajax called');\n\t\tvar params = 'title='+t+'&content='+code;\n\t\thttp.open('POST', url, true);\n\t\thttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\t\thttp.onreadystatechange = function(d) {\n            if (this.readyState == 4 && this.status == 200) {\n                messagingArea = document.getElementById('wptb-messaging-area');\n\t\t\t\tmessagingArea.innerHTML = 'Success: table \"'+t+'\" was successfully saved.';\n\t\t\t\tmessagingArea.classList.add('success');\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tmessagingArea.classList.remove('success');\n\t\t\t\t},5000);\n            }\n\t\t}\n\t\thttp.send(params);\n\t}\n};\n","var WPTB_Space = function(text){\n\n    function newElementProxy(el){\n            if(el == 'list'){\n                return new WPTB_List();\n            }\n            else if(el == 'image'){\n                return new WPTB_Image();\n            }   \n            else if(el == 'text'){\n                return new WPTB_Text();\n            }\n            else if(el == 'button'){\n                return new WPTB_Button();\n            }\n    }\n\n    spaceBetween = document.createElement('div'),\n    spaceBetween.classList.add('wptb-space-between');\n\n    spaceBetween.ondragenter = function(){\n        this.classList.add('visible');\n    };\n    spaceBetween.ondragover = function(event){\n                event.preventDefault();\n        };\n\n    spaceBetween.ondragleave = function(){\n        this.classList.remove('visible');\n    };\n\n    spaceBetween.ondrop = function(event){\n        event.stopPropagation();\n        \n                var p = event.target.nextSibling,\n                td = event.target,\n                element, t_space,spaceParent; \n\n                while(!td.classList.contains('wptb-droppable')){\n                    td = td.parentNode;\n                }\n\n        if(event.dataTransfer.getData('wptbElement'))\n        {\n            element = newElementProxy(event.dataTransfer.getData('wptbElement')); \n            this.classList.remove('visible');\n                \n \n\n            if(p == null){\n                td.appendChild(element.getDOMElement());\n                td.appendChild(new WPTB_Space());\n            }\n            else{\n                td.insertBefore(element.getDOMElement(),p);\n                td.insertBefore(new WPTB_Space(),p);\n            } \n \n\n         }\n\n        else\n        {  \n                    element = document.getElementsByClassName(event.dataTransfer.getData('node'))[0];\n\n                    t_space = element.nextSibling;\n                    spaceParent = element.parentNode;\n                    if(t_space != undefined){\n                        spaceParent.removeChild(t_space);\n                    }\n\n                    if(p == null){\n                     td.appendChild(element);\n                     td.appendChild(new WPTB_Space());\n                    }\n                    else{\n                        td.insertBefore(element,p);\n                        td.insertBefore(new WPTB_Space(),p);\n                    }  \n\n            }\n        this.classList.remove('visible');\n        };\n\n    return spaceBetween;\n};","var WPTB_Stringifier = function(node){\n\n\tif(node == undefined || node.tagName == undefined){\n\t\treturn '';\n\t}\n\n\tvar code='', children = node.childNodes,\n\tpadding, margin, bg1, bg2, bg3, border,\n\tcolSpan, rowSpan, isHidden, // Table Attributes\n\tlistClass, listStyleType, //list attributes\n\tbuttonSize, buttonColor, buttonBorder, //button attributes\n\tfontSize, fontColor, fontFamily, //text attributes\n\tsrc,width,height, //image attributes\n\tadditionalCSS, additionalClass, additionalID; // A few global attributes I wanted to add.\n\n\tswitch(node.tagName.toLowerCase()){\n\t\tcase 'table':  \n\t\t\t\t\t\tborder = node.style.borderSize;\n\t\t\t\t\t\tmargin = node.getElementsByTagName('td')[0].style.margin;\n\t\t\t\t\t\tpadding = node.getElementsByTagName('td')[0].style.padding;\n\t\t\t\t\t\tinnerBorder = node.getElementsByTagName('td')[0].style.borderSize;\n\t\t\t\t\t\tbg1 = node.rows[0].getElementsByTagName('td')[0].style.backgroundColor;\n\n\t\t\t\t\t\tif(node.rows.length > 1){\n\t\t\t\t\t\t\tbg2 = node.rows[1].getElementsByTagName('td')[0].style.backgroundColor;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(node.rows.length > 2){\n\t\t\t\t\t\t\tbg3 = node.rows[2].getElementsByTagName('td')[0].style.backgroundColor;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(innerBorder); \n\t\t\t\t\t\tcode += '[table'\n\t\t\t\t\t\t\t\t+(margin != undefined && margin != '' ? ' margin=\"'+margin+'\"' : '')\n\t\t\t\t\t\t\t\t+(padding != undefined && padding != '' ? ' padding=\"'+padding+'\"' : '')\n\t\t\t\t\t\t\t\t+(innerBorder != undefined ? ' inner-border=\"'+innerBorder+'\"' : '')\n\t\t\t\t\t\t\t\t+(bg1 != undefined ? ' data-bg1=\"'+bg1+'\"' : '')\n\t\t\t\t\t\t\t\t+(bg2 != undefined ? ' data-bg2=\"'+bg2+'\"' : '')\n\t\t\t\t\t\t\t\t+(bg3 != undefined ? ' data-bg3=\"'+bg3+'\"' : '')\n\t\t\t\t\t\t\t\t+']';\n\n\t\t\t\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\tcode +='[/table]';\n\t\t\t\t\tbreak;\n\t\tcase 'tbody': \n\t\t\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\tcase 'tr': \n\t\t\t\t\tcode += '[tr]';\n\n\t\t\t\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\tcode +='[/tr]';\n\t\t\t\t\t\tbreak;\n\t\tcase 'td': colspan = node.colSpan;\n\t\t\t\t   rowspan = node.rowSpan;\n\t\t\t\t   isHidden = node.classList.contains(/^wptb-fused-cell-(\\d+)$/);\n\t\t\t\t\tcode += '[td'\n\t\t\t\t\t\t\t\t+(colspan != undefined && colspan > 1 ? ' colspan=\"'+colspan+'\"' : '')\n\t\t\t\t\t\t\t\t+(rowspan != undefined && rowspan > 1 ? ' rowspan=\"'+rowspan+'\"' : '')\n\t\t\t\t\t\t\t\t+(isHidden ? ' hidden=\"true\"' : '')\n\t\t\t\t\t+']';\n\n\t\t\t\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\tcode +='[/td]';\n\t\t\t\t\t\tbreak;\n\t\tcase 'div': \n\t\t\t\t\tif(node.classList.contains('wptb-ph-element')){ \n\t\t\t\t\t\t\n\t\t\t        var infArr = node.className.match(/wptb-element-(.+)-(\\d+)/i),\n\t\t\t        \toptionsClass, trueNode,\n\t\t\t        \tnodeContent;\n\t\t\t        \tif(infArr == undefined){\n\t\t\t        \t\treturn;\n\t\t\t        \t} \n\t\t\t\t\t\tswitch(infArr[1]){\n\t\t\t\t\t\t\tcase 'list': \n\t\t\t\t\t\t\t\t\t\ttrueNode = node.getElementsByTagName('ul')[0];\n\t\t\t\t\t\t\t\t\t\tif(!trueNode){\n\t\t\t\t\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tlistStyleType = trueNode.getElementsByTagName('li')[0].style.listStyleType;\n\t\t\t\t\t\t\t\t\t\tlistClass = listStyleType == 'decimal' ? 'numbered' : 'unordered';\n\n\t\t\t\t\t\t\t\t\t\tcode += '[list'\n\t\t\t\t\t\t\t\t\t\t+(listClass != undefined ? ' class=\"'+listClass+'\"' : 'class=\"unordered\"')\n\t\t\t\t\t\t\t\t\t\t+(listStyleType != undefined ? ' style-type=\"'+listStyleType+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+']';\n\t\t\t\t\t\t\t\t\t\tlistitems = trueNode.getElementsByTagName('article');\n\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < listitems.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\tcode+='[item]';\n\t\t\t\t\t\t\t\t\t\t\tcode += listitems[i]\n\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementsByClassName('wptb-list-item-content')[0]\n\t\t\t\t\t\t\t\t\t\t\t\t\t.innerHTML;\n\t\t\t\t\t\t\t\t\t\t\tcode+='[/item]';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcode += '[/list]';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'image': \n\n\t\t\t\t\t\t\t\t\t\ttrueNode = node.getElementsByTagName('img')[0];\n\t\t\t\t\t\t\t\t\t\tif(!trueNode){\n\t\t\t\t\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t\t\tsrc = trueNode.src;\n\t\t\t\t\t\t\t\t\t\twidth = trueNode.width;\n\t\t\t\t\t\t\t\t\t\theight = trueNode.height;\n\t\t\t\t\t\t\t\t\t\talt = trueNode.alt;\n\t\t\t\t\t\t\t\t\t\tcode += '[img'+\n\t\t\t\t\t\t\t\t\t\t+(src != undefined ? ' src=\"'+src+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+(width != undefined ? ' width=\"'+width+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+(height != undefined ? ' height=\"'+height+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+']';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'text': \n\t\t\t\t\t\t\t\t\t\ttrueNode = node.getElementsByClassName('editable')[0];\n\t\t\t\t\t\t\t\t\t\tif(!trueNode){\n\t\t\t\t\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t\t\tfontSize = trueNode.getElementsByTagName('p')[0].style.fontSize;\n\t\t\t\t\t\t\t\t\t\tfontColor = trueNode.getElementsByTagName('p')[0].style.color;\n\t\t\t\t\t\t\t\t\t\tcode += '[text'\n\t\t\t\t\t\t\t\t\t\t+(fontSize != undefined ? ' size=\"'+fontSize+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+(fontColor != undefined ? ' color=\"'+fontColor+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+']';\n\t\t\t\t\t\t\t\t\t\tcode+= trueNode.innerHTML;\n\t\t\t\t\t\t\t\t\t\tcode += '[/text]';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'button': \n\t\t\t\t\t\t\t\t\t\ttrueNode = node.getElementsByClassName('editable')[0];\n\t\t\t\t\t\t\t\t\t\tif(!trueNode){\n\t\t\t\t\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbuttonColor = trueNode.style.backgroundColor;\n\t\t\t\t\t\t\t\t\t\tconsole.log(node);\n\t\t\t\t\t\t\t\t\t\tbuttonSize = node.className.match(/wptb-size-(.+)/i)[1];\n\n\t\t\t\t\t\t\t\t\t\tcode += '[button'\n\t\t\t\t\t\t\t\t\t\t+(buttonColor != undefined ? ' color=\"'+buttonColor+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+(buttonSize != undefined ? ' size=\"'+buttonSize+'\"' : '')\n\t\t\t\t\t\t\t\t\t\t+']';\n\t\t\t\t\t\t\t\t\t\tcode += trueNode.innerHTML;\n\t\t\t\t\t\t\t\t\t\tcode += '[/button]';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse{ \n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\tdefault: \n\t\t\t\tcode+= '';\n\t\t\t\tbreak;\n\t}\n\n\tif(node.nextSibling != undefined){\n\t\tWPTB_Stringifier(node.nextSibling);\n\t}\n\n\treturn code;\n};","var array=[], WPTB_Table = function(columns, rows){\n\t\t\t\n\t\t\tvar settings = document.getElementsByClassName('wptb-settings-items'),\n\t\t\t\twptbTableSetup = document.getElementsByClassName(\"wptb-table-setup\")[0],\n\t\t\t\ttable, row, cell, \n\t\t\t\tmaxAmountOfCells,\n\t\t\t\tmaxAmountOfRows;\n\n\t\t      var mark = function(event){\n\t\t        var rs = this.rowSpan,\n\t\t            cs = this.colSpan,\n\t\t            markedCells,\n\t\t         //   noCells = document.getElementsByClassName('no-cell-action'),\n\t\t         //   singleCells = document.getElementsByClassName('single-action'),\n\t\t         //   multipleCells = document.getElementsByClassName('multiple-select-action'),\n\t\t            position = getCoords(this),\n\t\t            row = position[0],\n\t\t            column = position[1];\n\t\t            for (var i = 0; i < rs; i++) {\n\t\t                for (var j = 0; j < cs; j++) {\n\t\t                  array[row+i][column+j] = 1;\n\t\t                }\n\t\t            }\n\t\t        this.classList.add('wptb-highlighted'); \n\t\t        markedCells = document.getElementsByClassName('wptb-highlighted').length;\n\t\t    /*    if(markedCells === 1){\n\t\t          for (var i = 0; i < singleCells.length; i++) {\n\t\t            singleCells[i].classList.add('visible');\n\t\t            multipleCells[i].classList.remove('visible');\n\t\t            noCells[i].classList.remove('visible');\n\t\t          }\n\t\t        }\n\t\t        else{\n\t\t            singleCells[i].classList.remove('visible');\n\t\t            multipleCells[i].classList.add('visible');\n\t\t            noCells[i].classList.remove('visible');\n\t\t        }*/\n\t\t      };\n\n            for (var i = 0; i < settings.length; i++) {\n                settings[i].classList.add('visible');\n            }\n\n            document.getElementsByClassName('wptb-table-generator')[0].style.display = 'none';\n            \n\n            //Create a HTML Table element.\n            table = document.createElement('table');\n            table.classList.add('wptb-preview-table');\n\n\n            //Add the header row.\n            row = table.insertRow(-1);\n            row.classList.add('wptb-table-head', 'wptb-row');\n\n            for (var i = 0; i < columns; i++) {\n            \tconsole.log(mark);\n                cell = new WPTB_Cell(mark);\n                cell.setCoords(0,i); \n                row.appendChild(cell.getDOMElement()); \n            }\n\n            //Add the data rows.\n            for (var i = 1; i < rows; i++) {\n\n                row = table.insertRow(-1);\n                row.classList.add('wptb-row');\n\n                for (var j = 0; j < columns; j++) {\n                    cell = new WPTB_Cell(mark);\n                \tcell.setCoords(i,j); \n                    row.appendChild(cell.getDOMElement());\n                }\n            }\n\n            var realTimeArray = function(){\n\t\t        var carried = [],tds,cols, matriz = [];\n\n\t\t        for (var i = 0; i < maxAmountOfCells; i++) {\n\t\t          carried[i] = 0;\n\t\t        }\n\n\t\t        for (var i = 0; i < table.rows.length; i++) { \n\t\t          cols = [];\n\n\t\t          var tds = table.rows[i].getElementsByTagName('td');\n\n\t\t          for (items=0; items < tds.length;items++) {\n\n\t\t              for (var k = 0; k < tds[items].colSpan; k++) {\n\t\t            cols.push(1);\n\t\t            }\n\n\t\t            if(tds[items].rowSpan > 1){\n\t\t              for (var k = 0; k < tds[items].colSpan; k++) {\n\t\t                carried[items+k]={\n\t\t                  justAssigned : true,\n\t\t                  amount : tds[items].rowSpan\n\t\t                };\n\t\t              }\n\n\t\t            \n\t\t            }\n\n\t\t          }\n\n\n\t\t          for (var k = 0; k < maxAmountOfCells; k++) {\n\t\t          if(typeof carried[k] == 'object' && carried[k].amount > 0){\n\t\t            \n\t\t            carried[k].amount--;\n\n\t\t            if(carried[k].justAssigned){\n\t\t              carried[k].justAssigned = false;\n\t\t            }\n\t\t            else{            \n\t\t              cols.push(1);\n\t\t            }\n\t\t          }\n\t\t        }\n\t\t \n\t\t          matriz.push(cols);\n\n\t\t        } \n\t\t        return matriz;\n\t\t      };\n\n            var carriedRowspans = function(row){\n\t\t        var carried = [],tds,cols;\n\n\t\t        for (var i = 0; i < maxAmountOfCells; i++) {\n\t\t          carried[i] = 0;\n\t\t        }\n\n\t\t        for (var i = 0; i <= row; i++) { \n\t\t          //console.log('Fila '+(i+1));\n\t\t          tds = table.rows[i].getElementsByTagName('td');\n\t\t          cols = 0,\n\t\t          items = 0;  \n\n\t\t          for (colspansAcumulados=0;colspansAcumulados<maxAmountOfCells && items < tds.length;) {\n\t\t            if(carried[colspansAcumulados]){\n\t\t              //console.log('En '+colspansAcumulados+' va la prolongacion vertical de una celda');\n\t\t              carried[colspansAcumulados]--;\n\t\t              colspansAcumulados++;\n\t\t              continue;\n\t\t            }\n\t\t            cell = tds[items++];\n\t\t            if(cell.rowSpan>1){\n\t\t              for (var k = 0; k < cell.colSpan; k++) {\n\t\t                carried[colspansAcumulados+k]=cell.rowSpan;\n\t\t              }\n\t\t            }\n\t\t            if(carried[colspansAcumulados])\n\t\t            carried[colspansAcumulados]--;\n\t\t            //console.log('Celda del colspan numero'+colspansAcumulados);\n\t\t            colspansAcumulados += cell.colSpan;\n\t\t          }\n\n\t\t        }\n\t\t        console.log(carried);\n\t\t        return carried;\n\t\t      };\n\n            table.toggleTableEditMode = function(){\n            \tvar bar = document.getElementById('edit-bar');\n            \tconsole.log('Bar',bar);\n            \tif(bar.classList.contains('visible')){\n            \t\tdocument.select.deactivateMultipleSelectMode();\n            \t\tbar.classList.remove('visible');\n            \t}\n            \telse{\n            \t\tdocument.select.activateMultipleSelectMode();\n            \t\tbar.classList.add('visible');\n\n            \t}\n            }\n\n    \t\ttable.recalculateIndexes = function(){\n    \t\t\tvar trs = this.getElementsByTagName('tr'), tds, maxCols= 0;\n\n\t\t        for (var i = 0; i < trs.length; i++) {\n\t\t            tds = trs[i].getElementsByTagName('td');\n\t\t            for (var j = 0; j < tds.length; j++) {\n\n\t\t                if(i==0){ \n\t\t                    tds[j].parentNode.className=''; \n\t\t                    tds[j].parentNode.classList.add('wptb-row','wptb-table-head');\n\t\t                }\n\t\t                else{\n\t\t                    tds[j].parentNode.className=''; \n\t\t                    tds[j].parentNode.classList.add('wptb-row'); \n\t\t                }\n\n\t\t                tds[j].dataset.xIndex = j;\n\t\t                tds[j].dataset.yIndex = i;\n\t\t            }\n\t\t            if(j > maxCols){\n\t\t            \tmaxCols = j;\n\t\t            }\n\t\t        } \n\t\t    \tthis.columns = maxCols; \n\t\t    \tconsole.log('Table dimensions: '+trs.length+' rows ,'+maxCols+' columns');\n    \t\t}\n\n\t      table.addColumnEnd = function(){\n\t        \n\t      \tconsole.log('add to the end');\n\t        for (var i = 0; i < table.rows.length; i++) {\n\t          td = new WPTB_Cell(mark); \n\t          table.rows[i].appendChild(td.getDOMElement());\n\t        \tarray[i].push(0);\n\t        } \n\t        maxAmountOfCells++; \n\t        undoSelect();\n\t      };\n\n\t      table.addColumnStart = function(){\n\t      \tconsole.log('add to the start');\n\t        for (var i = 0; i < table.rows.length; i++) {\n\t          td = new WPTB_Cell(mark); \n\t          firstCell = table.rows[i].getElementsByTagName('td')[0];\n\t          if(firstCell){\n\t          table.rows[i].insertBefore(td.getDOMElement(),firstCell);\n\t          }\n\t          else{\n\t            table.rows[i].appendChild(td.getDOMElement());\n\t          }\n\t        array[i].push(0);\n\t        }\n\n\t        maxAmountOfCells++;  \n\t        undoSelect();\n\t      };\n\n\t\t    table.addColumnBefore = function(){\n\t\t        \n\t\t    };\n\n\t\t    table.addColumnAfter = function(){\n\t\t        \n\t\t    };\n\n    \t\ttable.addRow = function(pos){\n    \t\t\tvar _this, row, referenceRow = undefined;\n\t\t            \n\t\t        if(pos == 'end' || pos == 'start'){ \n\t\t            row = this.insertRow( pos == 'end' ? -1 : 0);\n\t\t        }else{\n\t\t            row = document.createElement('tr');\n\t\t        }\n\t\t            \n\t\t        for (var j = 0; j < this.columns; j++) {\n\t\t            var cell = new WPTB_Cell(mark);\n\t\t            row.appendChild(cell.getDOMElement());\n\t\t        }\n\n\t\t        row.classList.add('wptb-row'); \n\n\t\t        if(pos == 'before' || pos == 'after' ){\n\t\t        \t_this = this.getElementsByClassName('wptb-highlighted')[0];\n\t\t            referenceRow = this.getElementsByTagName('tr')[_this.dataset.yIndex];\n\t\t            if(pos == \"before\"){\n\t\t                this.getElementsByTagName('tbody')[0].insertBefore(row,referenceRow);\n\t\t                var buttons = document.getElementsByClassName('wptb-relative-action');\n\t\t                for (var i = 0; i < buttons.length; i++) {\n\t\t                    buttons[i].dataset.yIndex++;\n\t\t                } \n\t\t            }else{\n\t\t                this.getElementsByTagName('tbody')[0].insertBefore(row,referenceRow.nextSibling);\n\t\t            }\n\t\t        }\n\n\t\t        if(pos =='before' || pos == 'start'){\n\t\t        \tvar active = document.querySelector('wptb-highlighted');\n\t\t        \tif(active){\n\t\t        \t\tactive.onclick();\n\t\t        \t}\n\t\t        }\n\n\t\t        table.recalculateIndexes();\n    \t\t};\n\n    \t\ttable.addRowToTheEnd = function(evt){\n\t\t        var r = table.insertRow(-1),\n\t\t        td,\n\t\t        aux;\n\t\t        for (var i = 0; i < maxAmountOfCells; i++) {\n\t\t          td = new WPTB_Cell(mark); \n\t\t          r.appendChild(td.getDOMElement());\n\t\t        }\n\t\t        aux = Array.from(array[0]);\n\t\t        array.push(aux);\n\t\t        drawTable(array);\n\t\t        table.recalculateIndexes();\n\t\t        undoSelect();\n\t\t    };\n\n\t\t    table.addRowToTheStart = function(evt){\t\t        \n\t\t        var r = table.insertRow(0);\n\t\t        for (var i = 0; i < maxAmountOfCells; i++) {\n\t\t          td = new WPTB_Cell(mark); \n\t\t          r.appendChild(td.getDOMElement());\n\t\t        }\n\t\t        aux = Array.from(array[0]);\n\t\t        array.push(aux);\n\t\t        drawTable(array);\n\t\t        table.recalculateIndexes();\n\t\t        undoSelect();\n\t\t    };\n\n\t\t    table.addRowBefore = function(){    \n\t\t        var cell = document.querySelector('.wptb-highlighted'),\n\t\t            row = getCoords(cell)[0],\n\t\t            r = table.insertRow(row),\n\t\t            aux,\n\t\t            rowspans = carriedRowspans(row-1);\n\n\t\t        noPending = rowspans.filter(function(elem){\n\t\t          return elem == 0;\n\t\t        });\n\t\t \n\n\t\t        for (var i = 0; i < noPending.length; i++) {\n\t\t          var td = new WPTB_Cell(mark);\n\t\t          r.appendChild(td.getDOMElement());\n\t\t        }\n\n\t\t        arr = realTimeArray();\n\n\t\t        for (var i = 0; i < arr.length; i++) {\n\t\t          console.log('Loop iteration');\n\n\t\t          if(arr[i].length > maxAmountOfCells){\n\t\t            //Still not watched\n\t\t          }\n\n\t\t          if(arr[i].length < maxAmountOfCells){\n\n\t\t            for (var j = arr[i].length; j < maxAmountOfCells; j++) {\n\t\t              td = new WPTB_Cell(mark); \n\t\t              table.rows[i].appendChild(td.getDOMElement());\n\t\t            }\n\t\t          }\n\t\t        }\n\n\t\t      \n\t\t        aux = Array.from(array[0]);\n\t\t        array.push(aux);\n\t\t        drawTable(array);\n\t\t        table.recalculateIndexes();\n\t\t        undoSelect();\n\t\t    };\n\n\t\t    table.addRowAfter = function(){\n\t\t        \n\t\t        var cell = document.querySelector('.wptb-highlighted'),\n\t\t            row = getCoords(cell)[0],\n\t\t            r = table.insertRow(row+1),\n\t\t            aux,\n\t\t            rowspans = carriedRowspans(row);\n\n\t\t        noPending = rowspans.filter(function(elem){\n\t\t          return elem == 0;\n\t\t        });\n\t\t \n\n\t\t        for (var i = 0; i < noPending.length; i++) {\n\t\t          td = new WPTB_Cell(mark); \n\t\t          r.appendChild(td.getDOMElement());\n\t\t        }\n\n\t\t        arr = realTimeArray();\n\n\t\t        console.log('Arr',arr);\n\n\t\t        for (var i = 0; i < arr.length; i++) {\n\t\t          console.log('Loop iteration');\n\n\t\t          if(arr[i].length > maxAmountOfCells){\n\t\t            //Still not watched\n\t\t          }\n\n\t\t          if(arr[i].length < maxAmountOfCells){\n\n\t\t            for (var j = arr[i].length; j < maxAmountOfCells; j++) {\n\t\t              td = new WPTB_Cell(mark);  \n\t\t              table.rows[i].appendChild(td);\n\t\t            }\n\t\t          }\n\t\t        }\n\n\t\t      \n\t\t        aux = Array.from(array[0]);\n\t\t        array.push(aux);\n\t\t        drawTable(array);\n\t\t        table.recalculateIndexes();\n\t\t        undoSelect();\n\t\t    };\n\n\t\t    var isSquare = function(a){\n\t\t        var rowStart = -1, \n\t\t            columnStart = -1, \n\t\t            rowEnd = -1, \n\t\t            columnEnd = -1,\n\t\t            height,\n\t\t            width,\n\t\t            itemsEstimate=0,\n\t\t            items=0;\n\n\t\t        for (var i = 0; i < a.length; i++) {\n\t\t          for (var j = 0; j < a[i].length; j++) {\n\t\t            if(a[i][j]==1){\n\t\t              rowStart = i;\n\t\t              columnStart = j;\n\t\t              break;\n\t\t            }  \n\t\t          }\n\t\t          if(rowStart!== -1 && columnStart !== -1){\n\t\t            break;\n\t\t          }\n\t\t        }\n\n\t\t        for (var i = a.length-1; i > -1; i--) {\n\t\t          for (var j = a[i].length-1; j > -1; j--) {\n\t\t               if(a[i][j]==1){\n\t\t              rowEnd = i;\n\t\t              columnEnd = j;\n\t\t              break;\n\t\t            } \n\t\t          }\n\t\t          if(rowEnd!== -1 && columnEnd !== -1){\n\t\t            break;\n\t\t          }\n\t\t        }\n\t\t \n\n\t\t        for (var i = rowStart; i < rowEnd; i++) {\n\t\t          for (var j = columnStart; j < columnEnd; j++) {\n\t\t            if(a[i][j] == 0 || a[i][j]== undefined){ \n\t\t              return false;\n\t\t            }  \n\t\t          }\n\t\t        }\n\n\t\t        for (var i = 0; i < a.length; i++) {\n\t\t          for (var j = 0; j < a[i].length; j++) {\n\t\t              if(a[i][j]==1){\n\t\t                items++;\n\t\t              }\n\t\t          } \n\t\t        }\n\n\t\t        height = rowEnd-rowStart+1;\n\t\t        width = columnEnd-columnStart+1;\n\t\t        itemsEstimate = height * width; \n\n\t\t        if(itemsEstimate!==items){ \n\t\t          return false;\n\t\t        } \n\t\t        return [height,width];\n\t\t      };\n\n\t\t      var drawTable = function(a){\n\t\t       var string = 'DRAWING TABLE:\\n';\n\t\t        for (var i = 0; i < a.length; i++) {\n\t\t          \n\t\t          for (var j = 0; j < a[i].length; j++) {\n\t\t            string += ' '+a[i][j];\n\t\t          } \n\t\t          string+='\\n';\n\t\t        } \n\t\t        console.log(string);\n\t\t        isSquare(a);\n\t\t      };\n\n\t\t      var undoSelect = function(){\n\t\t        var tds = table.getElementsByClassName('marked');\n\t\t        while(tds.length){\n\t\t          tds[0].classList.remove('marked');\n\t\t        }\n\t\t         for (var i = 0; i < array.length; i++) {\n\t\t          \n\t\t          for (var j = 0; j < array[i].length; j++) {\n\t\t            array[i][j]=0;\n\t\t          } \n\t\t          \n\t\t        } \n\t\t      };\n\n\t\t      var fillTableArray = function(){ \n\t\t\t        var  colspansSums = [], a = [];\n\n\t\t\t        //calculate max amount of cells inside a row\n\t\t\t        for (var i = 0; i < table.rows.length; i++) {\n\t\t\t          var cells = table.rows[i].getElementsByTagName('td'),\n\t\t\t              colspanSumInRow=0;\n\t\t\t          for (var j = 0; j < cells.length; j++) {\n\t\t\t            colspanSumInRow += cells[j].colSpan;\n\t\t\t          }\n\t\t\t              colspansSums.push(colspanSumInRow);\n\t\t\t        }\n\n\t\t\t        console.log(colspanSumInRow);\n\n\t\t\t        maxAmountOfCells = Math.max.apply(null,colspansSums);\n\t\t\t        //calculate max rows\n\t\t\t        var maxAmountOfRows = table.rows.length; /* I'm feeling like I'm gonna go crazy if I don't assume \n\t\t\t                                                  the table starts having a fixed amount of rows,\n\t\t\t                                                  therefore no matter if I vertically fuse all cells from the\n\t\t\t                                                  first row to the last row, the TR nodes won't dissapear\n\t\t\t                                                  (tough they will run empty after the merging function deletes\n\t\t\t                                                  all of its tds for increasing the first row tds rowspan),\n\t\t\t                                                  so its length remains as a confident max rows amount.\n\t\t\t                                                  */\n\t\t\t        // fill with zeros from both values\n\t\t\t        for (var i = 0; i < maxAmountOfRows; i++) {\n\t\t\t          a[i] = [];\n\t\t\t          for (var j = 0; j < maxAmountOfCells; j++) {\n\t\t\t            a[i].push(0);\n\t\t\t          }\n\t\t\t        }\n\t\t\t        drawTable(a);\n\t\t\t        return a;\n\t\t\t      };\n\n\n\t      var getCoords = function(search){\n\t        var skipInCols = [],cell;\n\n\t        for (var i = 0; i < table.rows.length; i++) {\n\n\n\t          var tds = [].slice.call(table.rows[i].getElementsByTagName('td'));\n\n\t          for (var j = 0; j < maxAmountOfCells; ) {\n\n\t                if(skipInCols[j] !== undefined && skipInCols[j] > 0){ \n\t                    j++;\n\t                    skipInCols[j]--;\n\t                    continue;\n\t                }\n\n\t                cell = tds.shift();\n\n\t                if(cell.rowSpan>1){\n\t                    for(k = 0; k < cell.colSpan; k++){\n\t                          skipInCols[j+k] = cell.rowSpan - 1 ;\n\t                    } \n\t                }\n\n\t                if(cell==search){\n\t                      return [i,j];\n\t                }\n\n\t                j += cell.colSpan;\n\n\t          }\n\n\n\n\t        }\n\t      };\n\n\n\t\t    table.deleteRow = function(e){\t        \n\t\t        var cell = document.getElementsByClassName('wptb-highlighted')[0],\n\t\t        \tindex = cell.dataset.yIndex,\n\t\t        \ttable = document.getElementsByClassName('wptb-preview-table')[0],\n\t\t            row = table.getElementsByTagName('tr')[index],\n\t\t            rowCount = table.rows.length,\n\t\t            tbody = row.parentNode;\n\t\t        if((rowCount==1 && columnCount==1) || tbody == undefined){\n\t\t             return;\n\t\t         }\n\t\t        tbody.removeChild(row);  \n\t\t        this.recalculateIndexes();\n\t\t    };\n\n\t\t    table.deleteColumn= function(e){\n\t\t        var cell = document.getElementsByClassName('wptb-highlighted')[0],\n\t\t        \tnum = cell.dataset.xIndex,\n\t\t        \ttable = document.getElementsByClassName('wptb-preview-table')[0],\n\t\t            rowCount = table.rows.length;\n\n\t\t        if((rowCount==1 && columnCount==1)){\n\t\t             return;\n\t\t         }\n\t\t        for (var i = 0; i < rowCount; i++) {\n\t\t             var td = table.getElementsByTagName('tr')[i].getElementsByTagName('td')[num],\n\t\t                tr = td.parentNode;\n\t\t             tr.removeChild(td);\n\t\t        }        \n\t\t        this.recalculateIndexes();\n\t\t    };\n\n\t\t    table.mergeCells = function(){\t   \n\t\t    \tconsole.log('Meging');\n\t\t          var dimensions = isSquare(array),\n\t\t              rowspan = dimensions[0],\n\t\t              colspan = dimensions[1],\n\t\t              first = document.querySelector('.wptb-highlighted'),\n\t\t              tds = [].slice.call(document.getElementsByClassName('wptb-highlighted'),1);\n\n\t\t              console.log('Dimensions:',dimensions);\n\t\t              console.log('First:',first);\n\t\t              console.log('Cells without the first one:',tds);\n\t\t              \n\n\t\t          for (var i = 0; i<tds.length; i++) {\n\t\t            var p = tds[i].parentNode;\n\t\t            p.removeChild(tds[i]);  \n\t\t          } \n\n\t\t          first.colSpan = colspan;\n\t\t          first.rowSpan = rowspan;\n\t\t          undoSelect();\n\t\t    };\n\n\t\t    table.splitCell = function(){\n\t          var cell = document.getElementsByClassName('wptb-highlighted')[0],\n\t              rowspan = cell.rowSpan,\n\t              colspan = cell.colSpan;\n\t          cell.rowSpan = 1;\n\t          cell.colSpan = 1;\n\t          console.log('Cell',cell.rowSpan,cell.rowspan);\n\t          for (var i = 0; i<rowspan; i++) {\n\t          \tconsole.log('Let\"s split it!',cell);\n\t              if(i == 0){\n\t              \tconsole.log('Iteration 1');\n\t              refCell = cell;\n\t              }\n\t              else\n\t              {\n\t              \tconsole.log('Conter');\n\t                for (var k = 0, pt= 0; k < colspan; k+=refCell.colSpan,pt++)\n\t                { \n\t              \tconsole.log('Increasing Conter');\n\t                  refCell = table.rows[i].getElementsByTagName('td')[pt];\n\t                  if(!refCell){\n\t                    break;\n\t                  }\n\t                }\n\t              }\n\t \t\t\tconsole.log(refCell);\n\n\t                var p = refCell ? refCell.parentNode : table.rows[i];\n\t            for (var j = 0; j<colspan; j++) {\n\t              if(!i && !j){\n\t                continue;\n\t              }\n\t              newCell = document.createElement('td');\n\t          newCell.onclick = mark;\n\t              if(refCell && refCell.nextSibling){\n\t                p.insertBefore(newCell,refCell.nextSibling)\n\t              }\n\t              else{\n\t                p.appendChild(newCell);\n\t              }\n\t              refCell = newCell;\n\t            }\n\t          }\n\t          undoSelect();\n\n\t\t    };\n\n\t\t    array = fillTableArray();\n\n            wptbTableSetup.appendChild(table);\n\n            table.recalculateIndexes();\n\n\t\t    WPTB_LeftPanel();\n\n             \n};","var WPTB_Text = function(text){\n        var DOMElement = document.createElement('div'),\n                elText2 = document.createElement('div'),\n                elP = document.createElement('p');\n\n                this.kind = 'text';\n\n        elText2.classList.add('editable');\n        elP.innerHTML = text != undefined ? text : 'Text';\n        elText2.appendChild(elP);\n        DOMElement.appendChild(elText2);\n\n        this.getDOMElement = function (){ \n                return DOMElement;\n        }\n        applyGenericItemSettings(this);\n\n        return this;\n};","var applyGenericItemSettings = function(element){\n\tvar node = element.getDOMElement(),\n\t\tindex = document.counter.nextIndex(element.kind),\n\t\tlistItems;\n\n\tnode.onmouseenter = function(event){\n        this.classList.add('wptb-directlyhovered');\n        var btnDelete = document.createElement('span'),\n            btnCopy = document.createElement('span'),\n            btnMove = document.createElement('span'),\n            actions = document.createElement('span'),\n            previous, i;\n        actions.classList.add('wptb-actions');\n        btnDelete.classList.add('dashicons', 'dashicons-trash', 'delete-action');\n        btnCopy.classList.add('dashicons', 'dashicons-admin-page', 'duplicate-action');\n        btnMove.classList.add(\"dashicons\",\"dashicons-move\", 'move-action');\n        btnMove.draggable = true;\n        btnDelete.onclick = function (event) {\n\t        var act = this.parentNode.parentNode,\n\t            el = act.parentNode;\n\t        el.removeChild(act); \n\t    };\n        btnCopy.onclick = function(event){\n        \tif(element.kind=='list'){\n\n\t\t        var td = event.target.parentNode.parentNode.parentNode,\n\t\t            temp = [],\n\t\t            srcList = event.target.parentNode.parentNode.querySelectorAll('ul article .wptb-list-item-content');\n\n\t\t        for (var i = 0; i < srcList.length; i++) {\n\t\t            temp.push(srcList[i].innerHTML);\n\t\t        }\n\t\t        var copy = new WPTB_List(temp);\n\t\t        td.appendChild(copy.getDOMElement());\n    \n        \t}\n        \telse if(element.kind=='text'){\n        \t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t            \tcopy = new WPTB_Text(event.target.parentNode.parentNode.childNodes[0].innerHTML);\n\t        \ttd.appendChild(copy.getDOMElement());\n        \t}else if(element.kind=='image'){\n\t\t\t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t            \tcopy = new WPTB_Image(event.target.parentNode.parentNode.childNodes[0].src);\n\t        \ttd.appendChild(copy.getDOMElement());\n        \t}\n        \telse{\n        \t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t\t            copy = new WPTB_Button(event.target.parentNode.parentNode.childNodes[0].innerHTML);\n\t\t        td.appendChild(copy.getDOMElement());\n        \t}\n        };\n        btnMove.ondragstart = function(event){\n        \tvar parent = this,infArr,type;\n\n        \twhile(parent.className == '' || \n        \t\t! parent.classList.contains('wptb-ph-element') ){\n        \t\tparent = parent.parentNode;\n        \t}\n\n\n        \tinfArr = parent.className.match(/wptb-element-(.+)-(\\d+)/i);\n\t\t\ttype = infArr[1];\n\n        \tvar img = document.createElement(\"img\");\n        \timg.src = \"http://localhost/sandbox/wp-content/plugins/wp-table-builder/inc/admin/views/builder/icons/\"+type+\".png\";\n        \tconsole.log(img.src);\n\t\t    event.dataTransfer.setDragImage(img, 0, 0);\n\t\t    event.dataTransfer.setData('node','wptb-element-'+infArr[1]+'-'+infArr[2]);\n        \t};\n\n\n        if(element.kind === 'button'){\n        \ttinyMCE.init({\n\t            target: node.childNodes[0].childNodes[0],\n\t            inline: true,\n\t            plugins: \"link\",\n\t            dialog_type: \"modal\",\n\t            theme: 'modern',\n\t            menubar: false,\n\t            fixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t            toolbar: 'bold italic strikethrough',\n\t            setup: function (ed) {\n\t                ed.on(\"init\",\n\t                    function (ed) {\n\t                        tinyMCE.execCommand('mceRepaint');\n\t                    }\n\t                );\n\t            },\n\t            init_instance_callback: function (editor) {\n\t                editor.on('change', function (e) {\n\t                    // check if it becomes empty because if there's no value it's hard to edit the editor in button element\n\t                    if (editor.getContent() == \"\") {\n\t                        editor.setContent(\"<p class='wptb-button'>Button Text</p>\");\n\t                    }\n\t                });\n\t                editor.on('KeyDown', function (e) {\n\t                    var range = editor.selection.getRng();\n\t                    var KeyID = e.keyCode;\n\t                    if (range.startOffset == 0 && (KeyID == 8 || KeyID == 46)) {\n\t                        e.preventDefault();\n\t                        editor.setContent(\"<p class='wptb-button'></p>\");\n\t                    }\n\t                });\n\n\t                window.currentEditor = editor;\n\t                editor.on('focus', function (e) {\n\t                    \n\t                    var totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t        if (window.currentEditor &&\n\t\t\t\t            document.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t            window.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t        } else {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t        }\n\t                });\n            \n\t            }\n\t        });\n        }\n        else if(element.kind === 'text'){\n        \ttinyMCE.init({\n\t            target: node.childNodes[0],\n\t            inline: true,\n\t            plugins: \"link, paste\",\n\t            dialog_type: \"modal\",\n\t            theme: 'modern',\n\t            menubar: false,\n\t            fixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t            paste_as_text: true,\n\t            toolbar: 'bold italic strikethrough link unlink | alignleft aligncenter alignright alignjustify',\n\t            init_instance_callback: function (editor) {\n\t                window.currentEditor = editor;\n\t                editor.on('focus', function (e) {\n\t                \t\n\t                    var totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t        if (window.currentEditor &&\n\t\t\t\t            document.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t            window.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t        } else {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t        }\n\t                });\n\t            }\n\t        });\n\n        }\n        else{\n        \tlistItems = node.getElementsByClassName('wptb-list-item-content');\n        \tfor (var i = 0; i < listItems.length; i++) {\n        \t\ttinyMCE.init({\n\t\t            target: listItems[i],\n\t\t            inline: true,\n\t\t            plugins: \"link, paste\",\n\t\t            dialog_type: \"modal\",\n\t\t            theme: 'modern',\n\t\t            menubar: false,\n\t\t            fixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t\t            paste_as_text: true,\n\t\t            toolbar: 'bold italic strikethrough link unlink | alignleft aligncenter alignright alignjustify',\n\t\t            init_instance_callback: function (editor) {\n\t\t                window.currentEditor = editor;\n\t\t                editor.on('focus', function (e) {\n\t\t                    var totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t        if (window.currentEditor &&\n\t\t\t\t            document.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t            window.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t        } else {\n\t\t\t\t            document.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t            delete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t        }\n\t\t                });\n\t\t            }\n\t\t        });\n        \t}\n        }\n\n        actions.appendChild(btnMove);\n        actions.appendChild(btnCopy);\n        actions.appendChild(btnDelete);\n        this.appendChild(actions);\n\t};\n\n\tnode.onmouseleave = function(event){\n\t\tvar formerActions = this.getElementsByClassName('wptb-actions');\n        if (formerActions && formerActions[0]) {\n            let par = formerActions[0].parentNode;\n            par.removeChild(formerActions[0]);\n        }\n        this.classList.remove('wptb-directlyhovered');\n\t};\n\n\tnode.classList.add('wptb-ph-element', 'wptb-element-'+element.kind+'-' +\n           index);\n\n\tnew WPTB_ElementOptions(element,index);\n\n\tdocument.counter.increment(element.kind);\n     \n};",""]}