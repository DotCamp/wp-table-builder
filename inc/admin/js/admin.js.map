{"version":3,"sources":["WPTB_Builder.js","WPTB_Button.js","WPTB_Cell.js","WPTB_ElementCounters.js","WPTB_ElementOptions.js","WPTB_Image.js","WPTB_Initializer.js","WPTB_LeftPanel.js","WPTB_List.js","WPTB_ListItem.js","WPTB_MultipleSelect.js","WPTB_Parser.js","WPTB_Settings.js","WPTB_Space.js","WPTB_Stringifier.js","WPTB_Table.js","WPTB_Text.js","applyGenericItemSettings.js","wptb-builder.js"],"names":["detectMode","url","window","location","href","regex","RegExp","results","exec","decodeURIComponent","replace","WPTB_Builder","table_id","http","XMLHttpRequest","ajaxurl","open","setRequestHeader","onreadystatechange","d","readyState","status","ans","JSON","parse","responseText","document","getElementById","value","getElementsByClassName","style","display","appendChild","WPTB_Parser","WPTB_LeftPanel","WPTB_Settings","send","counter","ElementCounters","select","MultipleSelect","initializer","WPTB_Initializer","settings","addEventListener","WPTB_Button","text","DOMElement","createElement","elButton2","el_B","kind","classList","add","innerHTML","undefined","getDOMElement","applyGenericItemSettings","WPTB_Cell","callback","newElementProxy","el","WPTB_List","WPTB_Image","WPTB_Text","highlightRow","td","parentRow","parentNode","columnCount","parseInt","tds","getElementsByTagName","i","length","remove","classToAdd","ttd","highlightColumn","index","rowCount","table","tr","padding","jQuery","val","innerBorderWidth","border","draggable","onclick","ondragenter","e","div","dataTransfer","getData","ondragover","preventDefault","ondragleave","ondrop","element","classId","space","t_space","spaceParent","WPTB_Space","nextSibling","removeChild","setCoords","y","x","dataset","yIndex","xIndex","getCoords","coords","appendElement","node","priv","increment","key","nextIndex","WPTB_ElementOptions","elemIdClass","prop","querySelector","cloneNode","properties","infArr","className","match","optionsClass","children","childNodes","listStyleType","listJustifyContent","find","wpColorPicker","defaultColor","color","fontSize","substring","justifyContent","selectedIndex","backgroundColor","buttons","size","n_Class","type","num","affectedEl","b","optionControls","contains","change","event","ui","parent","target","classe","ps","number","toString","slider","oninput","onchange","img","src","alt","checked","width","height","float","margin","jc","articles","querySelectorAll","bullets","toLowerCase","anchor","file_frame","wp","media","frames","title","button","multiple","on","attachment","state","get","first","toJSON","MIN_COLUMNS","MIN_ROWS","MAX_COLUMNS","MAX_ROWS","tableGenerator","body","columnsDecrementButton","columnsIncrementButton","rowsDecrementButton","rowsIncrementButton","columnsInput","rowsInput","onmousedown","columns","rows","WPTB_Table","wptbElementButtons","hexToRgb","hex","result","tableRows","j","tableHeader","tableCells","addInnerBorderSize","addCellPadding","addInnerBorder","styles","marginBottom","addBorderSize","_val","ondragstart","setData","wptbElement","toggleTableEditMode","addRowToTheEnd","addRowToTheStart","addRowBefore","addRowAfter","addColumnEnd","addColumnStart","addColumnBefore","addColumnAfter","deleteColumn","deleteRow","mergeCells","splitCell","innerElements","el_L","item","WPTB_ListItem","divdot","divcontent","libullet","onkeyup","listItemKeyListener","onmouseenter","btnDelete","btnCopy","actions","previous","article","content","html","duplicate","append","onmouseleave","onkeydown","which","keyCode","lastP","dontAddItems","insertBefore","focus","selectedCells","multipleCellMode","activateMultipleSelectMode","deactivateMultipleSelectMode","isActivated","pushSelectedCell","cell","push","flushSelectedCells","getFirst","minXIndex","minYIndex","getLast","maxXIndex","maxYIndex","last","removeAllButFirst","code","pos","getChar","getToken","char","token","ctoken","getCurrentToken","getExpectedToken","expected","getWordFromToken","p","indexOf","word","getAttributesFromToken","elems","split","pair","attr","trim","join","parseAllHTML","analizeImage","attributes","analizeText","analizeButton","textcolor","analizeListItem","analizeList","stylety","analizeElement","t","analizeElements","analizeRows","tableNode","insertRow","analizeTds","analizeTd","attrs","colSpan","rowSpan","row","analizeHeader","header","analizeRoot","n","effectAllowed","messagingArea","WPTB_Stringifier","setTimeout","firstChild","params","rs","wptbId","action","data","includes","spaceBetween","stopPropagation","tagName","bg1","bg2","bg3","isHidden","borderColor","listClass","listAlignment","buttonSize","buttonColor","buttonBorder","buttonTextColor","buttonLink","buttonAlignment","fontColor","fontFamily","imageAlignment","imageLink","openInNewTab","additionalCSS","additionalClass","additionalID","borderWidth","innerBorder","borderStyle","colspan","rowspan","trueNode","nodeContent","listitems","buttonOpenInNewTab","array","wptbTableSetup","maxAmountOfCells","maxAmountOfRows","mark","cs","markedCells","noCells","singleCells","multipleCells","position","column","isSquare","realTimeArray","carried","cols","matriz","items","k","justAssigned","amount","carriedRowspans","cellsBuffer","cellPointer","xPosition","stepsToMove","celda","drawTable","a","string","undoSelect","fillTableArray","colspansSums","cells","colspanSumInRow","Math","max","apply","getActualPointsInRow","points","search","skipInCols","id","bar","recalculateIndexes","trs","maxCols","firstCell","c_pos","pendingInsertion","bro","currentCell","l","r","aux","Array","from","rowspans","noPending","filter","elem","arr","rowStart","columnStart","rowEnd","columnEnd","itemsEstimate","dimensions","slice","call","addLackingCells","findRowspannedCells","difference","actualPoints","sumRows","totalColspan","reduct","pop","cell_ref","buffer","elText2","elP","listItems","btnMove","act","space2","temp","srcList","copy","setDragImage","tinyMCE","init","inline","plugins","dialog_type","theme","menubar","fixed_toolbar_container","toolbar","verify_html","setup","ed","execCommand","init_instance_callback","editor","getContent","setContent","range","selection","getRng","KeyID","startOffset","currentEditor","totalWidth","offsetWidth","scrollTop","bodyElement","right","top","paste_as_text","formerActions","par"],"mappings":"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","file":"admin.js","sourcesContent":["(function () {\n\n\tfunction detectMode() {\n\t\tvar url = window.location.href,\n\t\t\tregex = new RegExp('[?&]table(=([^&#]*)|&|#|$)'),\n\t\t\tresults = regex.exec(url);\n\t\tif (!results) return false;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, ' '));\n\t}\n\n\tvar WPTB_Builder = function () {\n\t\tvar table_id = detectMode();\n\t\tif (table_id) {\n\t\t\tvar http = new XMLHttpRequest(),\n\t\t\t\turl = ajaxurl + \"?action=get_table\" + '&id=' + table_id;\n\t\t\thttp.open('GET', url, true);\n\t\t\thttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\t\t\thttp.onreadystatechange = function (d) {\n\t\t\t\tif (this.readyState == 4 && this.status == 200) {\n\t\t\t\t\tvar ans = JSON.parse(http.responseText);\n\t\t\t\t\tdocument.getElementById('wptb-setup-name').value = ans[0];\n\t\t\t\t\tdocument.getElementsByClassName('wptb-table-generator')[0].style.display = 'none';\n\t\t\t\t\tdocument.getElementsByClassName('wptb-table-setup')[0].appendChild(WPTB_Parser(ans[1]));\n\t\t\t\t\tWPTB_LeftPanel();\n\t\t\t\t\tWPTB_Settings();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\thttp.send(null);\n\t\t}\n\t\tdocument.counter = new ElementCounters();\n\t\tdocument.select = new MultipleSelect();\n\n\t\tvar initializer = WPTB_Initializer();\n\t\tsettings = WPTB_Settings();\n\t};\n\n\tdocument.addEventListener('DOMContentLoaded', WPTB_Builder);\n\n})();","var WPTB_Button = function (text) {\n\n\tvar DOMElement = document.createElement('div'),\n\t\telButton2 = document.createElement('div'),\n\t\tel_B = document.createElement('a');\n\n\tthis.kind = 'button';\n\n\tDOMElement.classList.add('wptb-button-container', 'wptb-size-M');\n\telButton2.classList.add('wptb-button-wrapper');\n\tel_B.classList.add('wptb-button');\n\tel_B.classList.add('editable');\n\tel_B.innerHTML = text != undefined ? text : 'Button Text';\n\telButton2.appendChild(el_B);\n\tDOMElement.appendChild(elButton2);\n\n\tthis.getDOMElement = function () {\n\t\treturn DOMElement;\n\t}\n\n\tapplyGenericItemSettings(this);\n\n\treturn this;\n\n};","var WPTB_Cell = function (callback, DOMElement) {\n\n    function newElementProxy(el) {\n        if (el == 'list') {\n            return new WPTB_List();\n        } else if (el == 'image') {\n            return new WPTB_Image();\n        } else if (el == 'text') {\n            return new WPTB_Text();\n        } else if (el == 'button') {\n            return new WPTB_Button();\n        }\n    }\n\n    function highlightRow(td) {\n        var parentRow = td.parentNode,\n            columnCount = parseInt(document.getElementById('wptb-columns-number').value),\n            tds = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n        for (var i = 0; i < tds.length; i++) {\n            tds[i].classList.remove('highlighted-row-first', 'highlighted-row-last', 'highlighted-row-inner',\n                'highlighted-column-first', 'highlighted-column-last', 'highlighted-column-inner');\n        }\n        for (var i = 0; i < columnCount; i++) {\n\n            var classToAdd = (i == 0 ? 'highlighted-row-first' :\n                (i == columnCount - 1 ? 'highlighted-row-last'\n                    : 'highlighted-row-inner'));\n            var ttd = parentRow.getElementsByTagName('td')[i];\n            if (ttd !== td) {\n                ttd.classList.add(classToAdd);\n            }\n        }\n    }\n\n    function highlightColumn(td) {\n\n        var index,\n            parentRow = td.parentNode;\n        columnCount = parseInt(document.getElementById('wptb-columns-number').value),\n            rowCount = parseInt(document.getElementById('wptb-rows-number').value),\n            table = document.getElementsByClassName('wptb-preview-table')[0];\n        for (var i = 0; i < columnCount; i++) {\n            if (parentRow.getElementsByTagName('td')[i] === td) {\n                index = i;\n                break;\n            }\n        }\n\n        for (var i = 0; i < rowCount; i++) {\n            var classToAdd = (i == 0 ? 'highlighted-column-first' :\n                (i == rowCount - 1 ? 'highlighted-column-last'\n                    : 'highlighted-column-inner'));\n            var tr = table.getElementsByTagName('tr')[i];\n            if (tr.getElementsByTagName('td')[index] !== td) {\n                tr.getElementsByTagName('td')[index].classList.add(classToAdd);\n            }\n        }\n    }\n\n    DOMElement = document.createElement(\"td\");\n\n    DOMElement.style.padding = jQuery('#wptb-table-padding-number').val() + 'px';\n\n    var innerBorderWidth = jQuery('#wptb-table-inner-border-number').val();\n\n    if (innerBorderWidth != '' && parseInt(innerBorderWidth) != 0) {\n        DOMElement.style.border = innerBorderWidth + 'px solid ' + jQuery('#wptb-table-border-color').val();\n    } else {\n        DOMElement.style.border = '1px dashed #969fa6';\n    }\n\n    DOMElement.draggable = false;\n\n    DOMElement.classList.add('wptb-droppable', 'wptb-cell');\n\n    DOMElement.onclick = callback;\n\n    DOMElement.ondragenter = function (e) {\n        var div;\n        if (!e.dataTransfer.getData('wptbElement')\n            && !e.dataTransfer.getData('node')) {\n            return;\n        }\n        this.classList.add('wptb-drop-here-empty');\n    }\n\n    DOMElement.ondragover = function (e) {\n        e.preventDefault();\n    }\n\n    DOMElement.ondragleave = function () {\n        this.classList.remove('wptb-drop-here-empty');\n    }\n\n    DOMElement.ondrop = function (e) {\n        var element, classId, space, t_space, spaceParent;\n        e.preventDefault();\n        space = new WPTB_Space();\n\n        if (!e.dataTransfer.getData('wptbElement')\n            && !e.dataTransfer.getData('node')) {\n            return;\n        }\n\n        if (e.dataTransfer.getData('wptbElement')) {\n            element = newElementProxy(e.dataTransfer.getData('wptbElement'));\n            if (this.innerHTML == '') {\n                this.appendChild(new WPTB_Space());\n            }\n            this.appendChild(element.getDOMElement());\n            this.appendChild(space);\n        }\n        else {\n\n            classId = e.dataTransfer.getData('node');\n            element = document.getElementsByClassName(classId)[0];\n            if (this.innerHTML == '') {\n                t_space = element.nextSibling;\n                spaceParent = element.parentNode;\n                if (t_space != undefined) {\n                    spaceParent.removeChild(t_space);\n                }\n                this.appendChild(new WPTB_Space());\n            }\n            this.appendChild(element);\n            this.appendChild(space);\n        }\n        this.classList.remove('wptb-drop-here-empty');\n        return true;\n    }\n\n    this.getDOMElement = function () {\n        return DOMElement;\n    }\n\n    this.setCoords = function (y, x) {\n        var el = this.getDOMElement();\n        el.dataset.yIndex = y;\n        el.dataset.xIndex = x;\n    }\n\n    this.getCoords = function () {\n        var coords,\n            el = this.getDOMElement();\n        coords.x = el.dataset.xIndex;\n        coords.y = el.dataset.yIndex;\n        return coords;\n    }\n\n    this.appendElement = function (node) {\n        getDOMElement().appendChild(node);\n    }\n\n    return this;\n\n};","var ElementCounters = function () {\n\n\tvar priv = [];\n\tpriv['text'] = 0;\n\tpriv['image'] = 0;\n\tpriv['list'] = 0;\n\tpriv['button'] = 0;\n\n\tthis.increment = function (key) {\n\t\tif (!(key in priv)) {\n\t\t\treturn;\n\t\t}\n\t\tpriv[key]++;\n\t}\n\n\tthis.nextIndex = function (key) {\n\t\tif (!(key in priv)) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn priv[key] + 1;\n\t}\n\n\treturn this;\n\n};","var WPTB_ElementOptions = function (element, index) {\n\n    var node = element.getDOMElement(), elemIdClass;\n\n    prop = document.querySelector(\".wptb-\" + element.kind + \"-options-prototype\").cloneNode(true);\n    prop.classList.remove(\"wptb-\" + element.kind + \"-options-prototype\"); // remove prototype from the class\n    elemIdClass = 'wptb-options-' + element.kind + \"-\" + index;\n\n    var properties = prop.getElementsByClassName('wptb-element-property');\n\n    for (var i = 0; i < properties.length; i++) {\n        properties[i].dataset.element = elemIdClass;\n    }\n\n    prop.classList.add(elemIdClass);\n    document.getElementById(\"element-options-group\").appendChild(prop);\n\n    node.onclick = function () {\n        var infArr = this.className.match(/wptb-element-((.+-)\\d+)/i),\n            optionsClass = '.wptb-' + infArr[2] + 'options' +\n                '.wptb-options-' + infArr[1];\n\n        document.getElementById('add-elements').getElementsByTagName('a')[0].classList.remove('active');\n        document.getElementById('element-options').getElementsByTagName('a')[0].classList.add('active');\n\n        document.getElementsByClassName('wptb-elements-container')[0].style.display = 'none';\n        document.getElementsByClassName('wptb-settings-section')[0].style.display = 'none';\n        document.getElementById(\"element-options-group\").style.display = 'block';\n\n        var children = document.getElementById(\"element-options-group\").childNodes;\n        for (var i = 0; i < children.length; i++) {\n            if (children[i].style)\n                children[i].style.display = 'none';\n        }\n\n        document.querySelector(optionsClass).style.display = 'block';\n\n        var listStyleType, listJustifyContent;\n\n        switch (element.kind) {\n\n            case 'text':\n                jQuery(prop).find('[data-type=color]').wpColorPicker({ defaultColor: node.style.color });\n                prop.querySelector('[type=number][data-type=font-size]').value\n                    = prop.querySelector('[type=ran][data-type=font-size]').value\n                    = node.style.fontSize.substring(0, node.style.fontSize.length - 2);\n                break;\n            case 'list':\n                listJustifyContent = node.querySelector('article').style.justifyContent;\n                listStyleType = node.querySelector('article .wptb-list-item-style-dot li').style.listStyleType;\n                prop.querySelector('[type=ran][data-type=list-class]').selectedIndex = (listStyleType == 'decimal' ? 0 : 1);\n                prop.querySelector('[type=ran][data-type=list-style-type]').selectedIndex = (listStyleType == 'circle' ? 0 : (listStyleType == 'square' ? 1 : 2));\n                prop.querySelector('[type=ran][data-type=list-alignment]').selectedIndex = (listJustifyContent == 'flex-start' ? 0 : (listJustifyContent == 'center' ? 1 : 2));\n                break;\n            case 'image':\n                break;\n            case 'button':\n                jQuery(prop).find('[data-type=button-color]').wpColorPicker({ defaultColor: node.style.backgroundColor });\n                break;\n\n        }\n    };\n\n    if (element.kind == 'button') {\n        //We must add this special kind of property, since it is triggered with click event\n        var buttons = prop.getElementsByClassName('wptb-btn-size-btn');\n\n        for (var i = 0; i < buttons.length; i++) {\n            buttons[i].onclick = function () {\n                var size = this.innerHTML,\n                    n_Class = this.dataset.element,\n                    infArr = n_Class.match(/wptb-options-(.+)-(\\d+)/i),\n                    type = infArr[1],\n                    num = infArr[2],\n                    affectedEl = document.getElementsByClassName('wptb-element-' + type + '-' + num)[0];\n                affectedEl.classList.remove('wptb-size-S');\n                affectedEl.classList.remove('wptb-size-M');\n                affectedEl.classList.remove('wptb-size-L');\n                affectedEl.classList.remove('wptb-size-XL');\n                affectedEl.classList.add('wptb-size-' + size);\n                var b = prop.getElementsByClassName('wptb-btn-size-btn');\n                for (var i = 0; i < b.length; i++) {\n                    b[i].classList.remove('selected');\n                }\n                this.classList.add('selected');\n            }\n        }\n    }\n\n    var optionControls = prop.getElementsByClassName('wptb-element-property');\n\n    for (var i = 0; i < optionControls.length; i++) {\n        if (optionControls[i].classList.contains('wptb-color-picker')) {\n            jQuery(optionControls[i]).wpColorPicker({\n                change: function (event, ui) {\n                    var parent = event.target, classe, type, ps, number;\n                    classe = parent.dataset.element.match(/wptb-options-(.+)-(\\d+)/i);\n                    type = classe[1];\n                    number = classe[2];\n                    affectedEl = document.getElementsByClassName('wptb-element-' + type + '-' + number)[0];\n                    if (type == 'button') {\n                        if (parent.dataset.type == 'button-text-color') {\n                            affectedEl.getElementsByClassName('wptb-button')[0].style.color = ui.color.toString();\n                        } else {\n                            affectedEl.getElementsByClassName('wptb-button')[0].style.backgroundColor = ui.color.toString();\n                        }\n                    } else {\n                        affectedEl.style.color = ui.color.toString();\n                    }\n                }\n            });\n        }\n\n        if (optionControls[i].dataset.type === 'font-size') {\n            var slider = optionControls[i].parentNode.parentNode.getElementsByClassName('wptb-text-font-size-slider')[0];\n            slider.oninput = function () {\n                this.parentNode.parentNode.getElementsByClassName('wptb-text-font-size-number')[0].value = this.value;\n                this.parentNode.parentNode.getElementsByClassName('wptb-text-font-size-number')[0].onchange();\n            }\n        }\n\n        if (optionControls[i].dataset.type === 'image-size') {\n            var slider = optionControls[i].parentNode.parentNode.getElementsByClassName('wptb-image-size-slider')[0];\n            slider.oninput = function () {\n                this.parentNode.parentNode.getElementsByClassName('wptb-image-width-number')[0].value = this.value;\n                this.parentNode.parentNode.getElementsByClassName('wptb-image-width-number')[0].onchange();\n            }\n        }\n\n        optionControls[i].onchange = function (event) {\n\n            var n_Class = this.dataset.element,\n                infArr = n_Class.match(/wptb-options-(.+)-(\\d+)/i),\n                type = infArr[1],\n                num = infArr[2],\n                affectedEl = document.getElementsByClassName('wptb-element-' + type + '-' + num)[0],\n                val = this.value;\n\n            switch (this.dataset.type) {\n                case 'src':\n                    var img = affectedEl.getElementsByTagName(\"img\")[0];\n                    img.src = this.value;\n                    break;\n                case 'alternative-text':\n                    var img = affectedEl.getElementsByTagName('img')[0];\n                    img.alt = this.value;\n                    break;\n                case 'image-link': affectedEl.getElementsByTagName('a')[0].href = this.value;\n                    break;\n                case 'button-link-target':\n                    if (this.checked == true) {\n                        affectedEl.getElementsByTagName('a')[0].target = '_blank';\n                    } else {\n                        affectedEl.getElementsByTagName('a')[0].target = '_self';\n                    }\n                    break;\n                case 'image-size':\n                    affectedEl.getElementsByTagName('img')[0].style.width = this.value + '%';\n                    affectedEl.getElementsByTagName('img')[0].style.height = 'auto';\n                    this.parentNode.parentNode.getElementsByClassName('wptb-image-size-slider')[0].value = this.value;\n                    break;\n                case 'image-alignment':\n                    if (this.value != 'center') {\n                        affectedEl.getElementsByTagName('img')[0].style.display = 'inline';\n                        affectedEl.getElementsByTagName('img')[0].style.float = this.value;\n                        affectedEl.getElementsByTagName('img')[0].style.margin = 'inherit';\n                    } else {\n                        affectedEl.getElementsByTagName('img')[0].style.float = 'none';\n                        affectedEl.getElementsByTagName('img')[0].style.display = 'block';\n                        affectedEl.getElementsByTagName('img')[0].style.margin = '0 auto';\n                    }\n                    break;\n                case 'font-size':\n                    affectedEl.style.fontSize = val + 'px';\n                    break;\n                case 'button-alignment':\n                    var jc = '';\n                    if (this.value == 'left') {\n                        jc = 'start';\n                    } else if (this.value == 'right') {\n                        jc = 'flex-end';\n                    } else {\n                        jc = 'center';\n                    }\n                    affectedEl.getElementsByClassName('wptb-button-wrapper')[0].style.justifyContent = jc;\n                    break;\n                case 'button-link':\n                    affectedEl.getElementsByTagName('a')[0].href = this.value;\n                    break;\n                case 'button-link-target':\n                    if (this.checked == true) {\n                        affectedEl.getElementsByTagName('a')[0].target = '_blank';\n                    } else {\n                        affectedEl.getElementsByTagName('a')[0].target = '_self';\n                    }\n                    break;\n                case 'button-color':\n                    //Kind of redundan\n                    break;\n                case 'list-alignment':\n                    var jc = '';\n                    if (this.value == 'left') {\n                        jc = 'flex-start';\n                    } else if (this.value == 'right') {\n                        jc = 'flex-end';\n                    } else {\n                        jc = 'center';\n                    }\n                    var articles = affectedEl.querySelectorAll('article');\n                    for (var i = 0; i < articles.length; i++) {\n                        articles[i].style.justifyContent = jc;\n                    }\n                    break;\n                case 'list-class':\n                    if (val == 'unordered') {\n                        event.target\n                            .parentNode\n                            .parentNode\n                            .querySelector('[data-type=list-style-type]')\n                            .parentNode\n                            .style\n                            .display = 'flex';\n                        document.querySelector('#wptb-list-icon-select-label').style.display = 'flex';\n                        var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                        for (var i = 0; i < bullets.length; i++) {\n                            bullets[i].style.listStyleType = 'disc';\n                        }\n                        document.querySelector('[data-type=list-style-type]').value = 'disc';\n                    } else {\n                        event.target\n                            .parentNode\n                            .parentNode\n                            .querySelector('[data-type=list-style-type]')\n                            .parentNode\n                            .style\n                            .display = 'none';\n                        document.querySelector('#wptb-list-icon-select-label').style.display = 'none';\n                        var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                        for (var i = 0; i < bullets.length; i++) {\n                            bullets[i].style.listStyleType = 'decimal';\n                        }\n                    }\n                    break;\n                case 'list-style-type':\n                    var bullets = affectedEl.querySelectorAll('article .wptb-list-item-style-dot li');\n                    for (var i = 0; i < bullets.length; i++) {\n                        bullets[i].style.listStyleType = val.toLowerCase();\n                    }\n                    break;\n            }\n        }\n    }\n};","var WPTB_Image = function (src) {\n\n\tvar DOMElement = document.createElement('div'),\n\t\tanchor = document.createElement('a'),\n\t\timg = document.createElement('img');\n\n\tthis.kind = 'image';\n\n\tanchor.appendChild(img);\n\tDOMElement.appendChild(img);\n\n\tthis.getDOMElement = function () {\n\t\treturn DOMElement;\n\t}\n\tapplyGenericItemSettings(this);\n\n\tfile_frame = wp.media.frames.file_frame = wp.media({\n\t\ttitle: 'Select a image to upload',\n\t\tbutton: {\n\t\t\ttext: 'Use this image',\n\t\t},\n\t\tmultiple: false\n\t});\n\t// When an image is selected, run a callback.\n\tfile_frame.on('select', function () {\n\t\tattachment = file_frame.state().get('selection').first().toJSON();\n\t\timg.src = attachment.url;\n\t});\n\t// Finally, open the modal\n\tif (src == undefined) {\n\t\tfile_frame.open();\n\t}\n\telse {\n\t\timg.src = src;\n\t}\n\n\treturn this;\n\n};","var WPTB_Initializer = function () {\n\n\tconst MIN_COLUMNS = 1,\n\t\tMIN_ROWS = 1,\n\t\tMAX_COLUMNS = 10,\n\t\tMAX_ROWS = 10;\n\n\tvar tableGenerator = document.body;\n\tcolumnsDecrementButton = tableGenerator.getElementsByClassName('wptb-input-number-decrement')[0],\n\t\tcolumnsIncrementButton = tableGenerator.getElementsByClassName('wptb-input-number-increment')[0],\n\t\trowsDecrementButton = tableGenerator.getElementsByClassName('wptb-input-number-decrement')[1],\n\t\trowsIncrementButton = tableGenerator.getElementsByClassName('wptb-input-number-increment')[1],\n\t\tcolumnsInput = document.getElementById('wptb-columns-number'),\n\t\trowsInput = document.getElementById('wptb-rows-number');\n\n\tcolumnsDecrementButton.onclick = function () {\n\t\tif (columnsInput.value > MIN_COLUMNS) {\n\t\t\tcolumnsInput.value--;\n\t\t}\n\t};\n\n\tcolumnsDecrementButton.onmousedown = function (event) {\n\t\tevent.preventDefault();\n\t}\n\n\tcolumnsIncrementButton.onclick = function () {\n\t\tif (columnsInput.value < MAX_COLUMNS) {\n\t\t\tcolumnsInput.value++;\n\t\t}\n\t};\n\n\tcolumnsIncrementButton.onmousedown = function (event) {\n\t\tevent.preventDefault();\n\t}\n\n\trowsDecrementButton.onclick = function () {\n\t\tif (rowsInput.value > MIN_ROWS) {\n\t\t\trowsInput.value--;\n\t\t}\n\t};\n\n\trowsDecrementButton.onmousedown = function (event) {\n\t\tevent.preventDefault();\n\t}\n\n\trowsIncrementButton.onclick = function () {\n\t\tif (rowsInput.value < MAX_ROWS) {\n\t\t\trowsInput.value++;\n\t\t}\n\t};\n\n\trowsIncrementButton.onmousedown = function (event) {\n\t\tevent.preventDefault();\n\t}\n\n\tdocument.getElementById('wptb-generate-table').onclick = function () {\n\t\tvar columns = document.getElementById('wptb-columns-number').value,\n\t\t\trows = document.getElementById('wptb-rows-number').value;\n\n\t\tWPTB_Table(columns, rows);\n\t}\n\n};","var WPTB_LeftPanel = function () {\n\n    var table = document.getElementsByClassName('wptb-preview-table')[0],\n        wptbElementButtons = document.getElementsByClassName('wptb-element');\n\n    function hexToRgb(hex) {\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        return result ? 'rgb(' + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16) + ')' : null;\n    }\n\n    jQuery('#wptb-even-row-bg').wpColorPicker({\n        change: function (event, ui) {\n            var tableRows = table.getElementsByTagName('tr');\n            for (var i = 1; i < tableRows.length; i += 2) {\n                tds = tableRows[i].getElementsByTagName('td');\n                for (var j = 0; j < tds.length; j++) {\n                    tds[j].style.backgroundColor = ui.color.toString();\n                }\n            }\n        }\n    });\n\n    jQuery('#wptb-odd-row-bg').wpColorPicker({\n        change: function (event, ui) {\n            var tableRows = table.getElementsByTagName('tr');\n            for (var i = 2; i < tableRows.length; i += 2) {\n                tds = tableRows[i].getElementsByTagName('td');\n                for (var j = 0; j < tds.length; j++) {\n                    tds[j].style.backgroundColor = ui.color.toString();\n                }\n            }\n        }\n    });\n\n    jQuery('#wptb-table-header-bg').wpColorPicker({\n        change: function (event, ui) {\n            var tableHeader = table.getElementsByTagName('tr')[0],\n                tds = tableHeader.getElementsByTagName('td');\n            for (var j = 0; j < tds.length; j++) {\n                tds[j].style.backgroundColor = ui.color.toString();\n            }\n        }\n    });\n\n    jQuery('#wptb-table-border-color').wpColorPicker({\n        change: function (event, ui) {\n            var tableCells = table.getElementsByTagName('td');\n            table.style.border = document.querySelector('#wptb-table-border-number').value + 'px solid ' + ui.color.toString();\n\n            for (var i = 0; i < tableCells.length; i++) {\n                tableCells[i].style.border = document.querySelector('#wptb-table-inner-border-number').value + 'px solid ' + ui.color.toString();\n            }\n        }\n    });\n\n    function addInnerBorderSize(value) {\n        var tableCells = table.getElementsByTagName('td');\n        for (var i = 0; i < tableCells.length; i++) {\n            tableCells[i].style.border = document.querySelector('#wptb-table-inner-border-number').value + 'px solid ' + hexToRgb(jQuery('#wptb-table-border-color').val());\n        }\n    }\n\n    function addCellPadding(value) {\n        var tableCells = table.getElementsByTagName('td');\n        for (var i = 0; i < tableCells.length; i++) {\n            tableCells[i].style.padding = value + 'px';\n        }\n    }\n\n    function addInnerBorder(checked) {\n        var styles, color = document.querySelector('#wptb-table-border-color').value != undefined ?\n            document.querySelector('#wptb-table-border-color').value : 'rgb(0,0,0)';\n\n        if (checked == 'checked') {\n            document.getElementById('wptb-apply-inner-border').style.marginBottom = '0px';\n            var tableCells = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n            for (var i = 0; i < tableCells.length; i++) {\n                tableCells[i].style.border = '1px solid ' + color;\n            }\n            document.getElementById('wptb-apply-inner-border').classList.add('visible');\n        } else {\n            document.getElementById('wptb-apply-inner-border').classList.remove('visible');\n            var tableCells = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n            for (var i = 0; i < tableCells.length; i++) {\n                tableCells[i].style.border = '0px solid ' + color;\n            }\n        }\n    }\n\n    function addBorderSize(value) {\n        table.style.border = value + 'px solid';\n    }\n\n    document.getElementById('wptb-table-cell-slider').oninput = function () {\n        document.getElementById('wptb-table-cell-number').value = this.value;\n        addCellPadding(this.value);\n    };\n\n    document.getElementById('wptb-table-cell-number').onchange = function () {\n        document.getElementById('wptb-table-cell-slider').value = this.value;\n        addCellPadding(this.value);\n    };\n\n    document.getElementById('wptb-table-border-slider').oninput = function () {\n        document.getElementById('wptb-table-border-number').value = this.value;\n        addBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-border-number').onchange = function () {\n        document.getElementById('wptb-table-border-slider').value = this.value;\n        addBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-inner-border-slider').oninput = function () {\n        document.getElementById('wptb-table-inner-border-number').value = this.value;\n        addInnerBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-table-inner-border-number').onchange = function () {\n        document.getElementById('wptb-table-inner-border-slider').value = this.value;\n        addInnerBorderSize(this.value);\n    };\n\n    document.getElementById('wptb-inner-border-check').onchange = function () {\n        var _val = this.checked ? 'checked' : 'unchecked';\n        addInnerBorder(_val);\n    };\n\n    for (var i = 0; i < wptbElementButtons.length; i++) {\n        wptbElementButtons[i].ondragstart = function (e) {\n            e.dataTransfer.setData('wptbElement', this.dataset.wptbElement);\n        }\n    }\n\n    document.getElementById('wptb-activate-cell-management-mode').onclick = table.toggleTableEditMode;\n    document.getElementById('wptb-add-end-row').onclick = table.addRowToTheEnd;\n    document.getElementById('wptb-add-start-row').onclick = table.addRowToTheStart;\n    document.getElementById('wptb-add-row-before').onclick = table.addRowBefore;\n    document.getElementById('wptb-add-row-after').onclick = table.addRowAfter;\n    document.getElementById('wptb-add-end-column').onclick = table.addColumnEnd;\n    document.getElementById('wptb-add-start-column').onclick = table.addColumnStart;\n    document.getElementById('wptb-add-column-before').onclick = table.addColumnBefore;\n    document.getElementById('wptb-add-column-after').onclick = table.addColumnAfter;\n    document.getElementById('wptb-delete-column').onclick = table.deleteColumn;\n    document.getElementById('wptb-delete-row').onclick = table.deleteRow;\n    document.getElementById('wptb-merge-cells').onclick = table.mergeCells;\n    document.getElementById('wptb-split-cell').onclick = table.splitCell;\n    document.getElementById('add-elements').onclick = function () {\n        document.getElementById('element-options').getElementsByTagName('a')[0].classList.remove('active');\n        document.getElementById('add-elements').getElementsByTagName('a')[0].classList.add('active');\n        document.getElementsByClassName('wptb-elements-container')[0].style.display = 'table';\n        document.getElementsByClassName('wptb-settings-section')[0].style.display = 'block';\n        document.getElementById(\"element-options-group\").style.display = 'none';\n    };\n\n};","var WPTB_List = function (innerElements) {\n\n    var el_L = document.createElement('ul'), item,\n        DOMElement = document.createElement('div');\n\n    this.kind = 'list';\n\n    if (innerElements === '') {\n        //Case for edit mode list\n    } else if (!innerElements) {\n        for (var i = 0; i < 3; i++) {\n            item = new WPTB_ListItem('List Item ' + (i + 1));\n            el_L.appendChild(item.getDOMElement());\n        }\n    } else {\n        for (var i = 0; i < innerElements.length; i++) {\n            item = new WPTB_ListItem(innerElements[i]);\n            el_L.appendChild(item.getDOMElement());\n        }\n    }\n    DOMElement.appendChild(el_L);\n    //window.addElementOptions('list', elList);\n\n    this.getDOMElement = function () {\n        return DOMElement;\n    }\n    applyGenericItemSettings(this);\n\n    return this;\n\n};","var WPTB_ListItem = function (text) {\n\n    if (text == undefined) text = 'New List Item';\n    var DOMElement = document.createElement('article'),\n        divdot = document.createElement('div'),\n        divcontent = document.createElement('div'),\n        libullet = document.createElement('li');\n    divdot.classList.add('wptb-list-item-style-dot');\n    divcontent.classList.add('wptb-list-item-content');\n    libullet.classList.add('wptb-bullet');\n    DOMElement.appendChild(divdot);\n    DOMElement.appendChild(divcontent);\n    divdot.appendChild(libullet);\n    divcontent.innerHTML = text;\n    divcontent.onkeyup = window.listItemKeyListener;\n\n    DOMElement.onmouseenter = function (event) {\n\n        var btnDelete = document.createElement('span'),\n            btnCopy = document.createElement('span'),\n            actions = document.createElement('span'),\n            previous, i;\n        actions.classList.add('wptb-actions');\n        btnDelete.classList.add('dashicons', 'dashicons-trash', 'delete-action');\n        btnCopy.classList.add('dashicons', 'dashicons-admin-page', 'duplicate-action');\n        this.classList.add('wptb-directlyhovered');\n\n        btnDelete.onclick = function () {\n            var item = this.parentNode.parentNode,\n                parent = item.parentNode;\n            parent.removeChild(item);\n        };\n\n        btnCopy.onclick = function (event) {\n            var article = event.target.parentNode.parentNode,\n                content = article.querySelector('.wptb-list-item-content'),\n                html = content.innerHTML;\n            var duplicate = new WPTB_ListItem(html);\n            article.parentNode.appendChild(duplicate.getDOMElement());\n        };\n\n        actions.append(btnCopy, btnDelete);\n        this.appendChild(actions);\n    };\n\n    DOMElement.onmouseleave = function (event) {\n        this.classList.remove('wptb-directlyhovered');\n        var actions = this.parentNode.querySelector('.wptb-actions');\n        if (actions != undefined) {\n            let parent = actions.parentNode;\n            parent.removeChild(actions);\n        }\n    };\n\n    divcontent.onkeydown = function (event) {\n        var key = (event.which != undefined) ? event.which :\n            event.keyCode,\n            duplicate, lastP;\n        if (key !== 13 ||\n            (window.dontAddItems !== undefined && window.dontAddItems === true)) {\n            return;\n        }\n        event.preventDefault();\n        duplicate = new WPTB_ListItem(this.innerHTML);\n        DOMElement.parentNode.insertBefore(duplicate.getDOMElement(), DOMElement);\n        divcontent.innerHTML = 'New List Item';\n        duplicate.getDOMElement().querySelector('.wptb-list-item-content').focus();\n\n        return false;\n    };\n\n    this.getDOMElement = function () {\n        return DOMElement;\n    }\n\n    return this;\n\n};","var MultipleSelect = function () {\n\n\tvar selectedCells = [],\n\t\tmultipleCellMode = false;\n\n\tthis.activateMultipleSelectMode = function () {\n\t\tselectedCells = [];\n\t\tvar tds = document.getElementsByClassName('wptb-preview-table')[0].getElementsByTagName('td');\n\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\ttds[i].classList.remove('wptb-highlighted');\n\t\t}\n\t\tmultipleCellMode = true;\n\t}\n\n\tthis.deactivateMultipleSelectMode = function () {\n\t\tmultipleCellMode = false;\n\t}\n\n\tthis.isActivated = function () {\n\t\treturn multipleCellMode;\n\t}\n\n\tthis.pushSelectedCell = function (cell) {\n\t\tif (!multipleCellMode) {\n\t\t\treturn;\n\t\t}\n\t\tselectedCells.push(cell);\n\t\tcell.classList.add('wptb-highlighted');\n\t};\n\n\tthis.selectedCells = function () {\n\t\treturn selectedCells;\n\t}\n\n\tthis.flushSelectedCells = function () {\n\t\tselectedCells = [];\n\t}\n\n\tthis.getFirst = function () {\n\t\tvar minXIndex = 1000, minYIndex = 1000, first;\n\t\tfor (var i = selectedCells.length - 1; i >= 0; i--) {\n\t\t\tif (minXIndex >= selectedCells[i].dataset.xIndex\n\t\t\t\t&& minYIndex >= selectedCells[i].dataset.yIndex) {\n\t\t\t\tfirst = selectedCells[i];\n\t\t\t\tminXIndex = selectedCells[i].dataset.xIndex;\n\t\t\t\tminYIndex = selectedCells[i].dataset.yIndex;\n\t\t\t}\n\t\t}\n\t\treturn first;\n\t}\n\n\tthis.getLast = function () {\n\t\tvar maxXIndex = -1, maxYIndex = -1, last;\n\t\tfor (var i = selectedCells.length - 1; i >= 0; i--) {\n\t\t\tif (maxXIndex <= selectedCells[i].dataset.xIndex\n\t\t\t\t&& maxYIndex <= selectedCells[i].dataset.yIndex) {\n\t\t\t\tlast = selectedCells[i];\n\t\t\t\tmaxXIndex = selectedCells[i].dataset.xIndex;\n\t\t\t\tmaxYIndex = selectedCells[i].dataset.yIndex;\n\t\t\t}\n\t\t}\n\t\treturn last;\n\t}\n\n\tthis.removeAllButFirst = function () {\n\t\tvar td = this.getFirst();\n\t\tfor (var i = 1; i < selectedCells.length; i++) {\n\t\t\tselectedCells[i].classList.add('wptb-fused-cell-' + td.dataset.xIndex + '-' + td.dataset.yIndex);\n\t\t}\n\t}\n\n\treturn this;\n\n};","var WPTB_Parser = function (code) {\n\n\tvar node, pos = 0;\n\n\tfunction getChar() {\n\t\tif (pos >= code.length) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn code[pos++];\n\t}\n\n\tfunction getToken() {\n\t\tvar char = getChar(),\n\t\t\ttoken = char;\n\n\t\tif (char !== '[') {\n\t\t\treturn;\n\t\t}\n\n\t\tdo {\n\t\t\tchar = getChar();\n\t\t\tif (char === -1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\ttoken += char;\n\t\t} while (char != ']');\n\n\t\tctoken = token;\n\n\t\treturn true;\n\t}\n\n\tfunction getCurrentToken() {\n\t\treturn ctoken;\n\t}\n\n\tfunction getExpectedToken(expected) {\n\t\tif (getWordFromToken(ctoken) !== expected) {\n\t\t\tthrow 'There was an error with the file and therefore the table could not be rendered';\n\t\t}\n\t\tgetToken();\n\t}\n\n\tfunction getWordFromToken(token) {\n\t\tvar p = token.indexOf(' '),\n\t\t\tword = token.substring(1, p);\n\t\tif (p == -1) { //This is, if token tag has no attributes \n\t\t\treturn token;\n\t\t}\n\t\treturn '[' + word + ']';\n\t}\n\n\tfunction getAttributesFromToken() {\n\t\tvar elems = ctoken.split(' '),\n\t\t\tpair,\n\t\t\tkey,\n\t\t\tvalue,\n\t\t\tattr = [];\n\t\tfor (var i = 1; i < elems.length; i++) {\n\t\t\tpair = elems[i].trim().split('=');\n\t\t\tkey = pair[0];\n\t\t\tvalue = pair[1].substring(1, pair[1].length - 1).split('\\\"').join('');\n\t\t\tattr[key] = value;\n\t\t}\n\n\t\treturn attr;\n\t}\n\n\tfunction parseAllHTML() {\n\t\tvar html = '';\n\t\tpos--;\n\n\t\tdo {\n\t\t\tchar = getChar();\n\t\t\tif (char === -1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\thtml += char;\n\t\t} while (char != '[');\n\n\t\thtml = html.substring(0, html.length - 1);\n\n\t\tpos--;\n\n\t\treturn html;\n\n\t}\n\n\tfunction analizeImage(attributes) {\n\t\tvar node;\n\t\tnode = new WPTB_Image(attr['src']);\n\t\tgetExpectedToken('[img]');\n\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.width = attr['width'];\n\t\tnode.getDOMElement().getElementsByTagName('img')[0].alt = attr['alt'];\n\t\tnode.getDOMElement().getElementsByTagName('a')[0].href = attr['link'];\n\t\tnode.getDOMElement().getElementsByTagName('a')[0].target = attr['newtab'];\n\n\t\tif (attr['alignment'] != 'center') {\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.display = 'inline';\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.float = this.value;\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.margin = 'inherit';\n\t\t} else {\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.float = 'none';\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.display = 'block';\n\t\t\tnode.getDOMElement().getElementsByTagName('img')[0].style.margin = '0 auto';\n\t\t}\n\n\t\tnode.getDOMElement().getElementsByTagName('img')[0]\n\n\t\treturn node;\n\n\t}\n\n\tfunction analizeText(attributes) {\n\t\tvar node;\n\t\tgetExpectedToken('[text]');\n\t\thtml = parseAllHTML();\n\t\tnode = new WPTB_Text(html);\n\t\tnode.getDOMElement().style.fontSize = attributes.size;\n\t\tnode.getDOMElement().style.color = attributes.color;\n\t\tgetToken();\n\t\tgetExpectedToken('[/text]');\n\t\treturn node;\n\t}\n\n\tfunction analizeButton(attributes) {\n\t\tvar node;\n\t\tgetExpectedToken('[button]');\n\t\thtml = parseAllHTML();\n\t\tnode = new WPTB_Button(html);\n\t\tnode.getDOMElement().classList.add('wptb-size-' + attributes['size']);\n\t\tnode.getDOMElement().getElementsByClassName('wptb-button-wrapper')[0].style.justifyContent = attributes['alignment'];\n\t\tnode.getDOMElement().getElementsByClassName('wptb-button')[0].style.backgroundColor = attributes.color;\n\t\tnode.getDOMElement().getElementsByClassName('wptb-button')[0].style.color = attributes.textcolor;\n\t\tnode.getDOMElement().querySelector('.wptb-button-wrapper a').href = attributes['link'];\n\t\tnode.getDOMElement().querySelector('.wptb-button-wrapper a').target = attributes['newtab'];\n\t\tgetToken();\n\t\tgetExpectedToken('[/button]');\n\t\treturn node;\n\t}\n\n\tfunction analizeListItem() {\n\t\tvar node;\n\t\tgetExpectedToken('[item]');\n\t\thtml = parseAllHTML();\n\t\tnode = new WPTB_ListItem(html);\n\t\tgetToken();\n\t\tgetExpectedToken('[/item]');\n\t\treturn node;\n\t}\n\n\tfunction analizeList(attributes) {\n\t\tvar node = new WPTB_List(''), stylety;\n\t\tgetExpectedToken('[list]');\n\t\tif (attributes['class'] == 'numbered') {\n\t\t\tstylety = 'decimal';\n\t\t} else {\n\t\t\tstylety = attributes['style-type'];\n\t\t}\n\t\tdo {\n\t\t\tnode.getDOMElement().getElementsByTagName('ul')[0]\n\t\t\t\t.appendChild(analizeListItem().getDOMElement());\n\t\t} while (getWordFromToken(ctoken) == '[item]');\n\n\t\tgetExpectedToken('[/list]');\n\n\t\tvar articles = node.getDOMElement().querySelectorAll('article');\n\t\tfor (var i = 0; i < articles.length; i++) {\n\t\t\tarticles[i].style.justifyContent = attributes['align'];\n\t\t}\n\n\t\tvar bullets = node.getDOMElement().querySelectorAll('article .wptb-list-item-style-dot li');\n\t\tfor (var i = 0; i < bullets.length; i++) {\n\t\t\tbullets[i].style.listStyleType = stylety;\n\t\t}\n\t\treturn node;\n\t}\n\n\tfunction analizeElement() {\n\t\tvar t = getWordFromToken(getCurrentToken()), html, node;\n\n\t\tswitch (t) {\n\t\t\tcase '[text]': attr = getAttributesFromToken();\n\t\t\t\tnode = analizeText(attr);\n\t\t\t\tbreak;\n\t\t\tcase '[list]': attr = getAttributesFromToken();\n\t\t\t\tnode = analizeList(attr);\n\t\t\t\tbreak;\n\t\t\tcase '[button]': attr = getAttributesFromToken();\n\t\t\t\tnode = analizeButton(attr);\n\t\t\t\tbreak;\n\t\t\tcase '[img]': attr = getAttributesFromToken();\n\t\t\t\tnode = analizeImage();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn node.getDOMElement();\n\t}\n\n\tfunction analizeElements(td) {\n\t\tvar space;\n\t\tif (getWordFromToken(ctoken) == '[img]'\n\t\t\t|| getWordFromToken(ctoken) == '[text]'\n\t\t\t|| getWordFromToken(ctoken) == '[list]'\n\t\t\t|| getWordFromToken(ctoken) == '[button]') {\n\t\t\tspace = new WPTB_Space();\n\t\t\ttd.appendChild(space);\n\t\t\twhile (getWordFromToken(ctoken) == '[img]'\n\t\t\t\t|| getWordFromToken(ctoken) == '[text]'\n\t\t\t\t|| getWordFromToken(ctoken) == '[list]'\n\t\t\t\t|| getWordFromToken(ctoken) == '[button]') {\n\t\t\t\ttd.appendChild(analizeElement());\n\t\t\t\tspace = new WPTB_Space();\n\t\t\t\ttd.appendChild(space);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction analizeRows(tableNode) {\n\t\twhile (getWordFromToken(getCurrentToken()) === '[tr]') {\n\t\t\tvar tr = tableNode.insertRow();\n\t\t\ttr.classList.add('wptb-row');\n\t\t\tgetExpectedToken('[tr]');\n\t\t\tanalizeTds(tr);\n\t\t\tgetExpectedToken('[/tr]');\n\t\t}\n\t}\n\n\tfunction analizeTd() {\n\t\tvar td = new WPTB_Cell();\n\t\tvar attrs = getAttributesFromToken();\n\t\tgetExpectedToken('[td]');\n\t\tif (attrs['colspan'] != undefined)\n\t\t\ttd.getDOMElement().colSpan = parseInt(attrs['colspan']);\n\t\tif (attrs['rowspan'] != undefined)\n\t\t\ttd.getDOMElement().rowSpan = parseInt(attrs['rowspan']);\n\t\tanalizeElements(td.getDOMElement());\n\t\tgetExpectedToken('[/td]');\n\t\treturn td.getDOMElement();\n\t}\n\n\tfunction analizeTds(row) {\n\t\tdo {\n\t\t\trow.appendChild(analizeTd());\n\t\t} while (getCurrentToken() == '[td]');\n\t}\n\n\tfunction analizeHeader(tableNode) {\n\t\tvar header = tableNode.insertRow();\n\t\theader.classList.add('wptb-row', 'wptb-table-head');\n\t\tgetExpectedToken('[tr]');\n\t\tanalizeTds(header);\n\t\tgetExpectedToken('[/tr]');\n\t}\n\n\tfunction analizeRoot() {\n\t\tgetToken();\n\t\tvar n = document.createElement('table');\n\t\tn.classList.add('wptb-preview-table');\n\t\tvar attributes = getAttributesFromToken();\n\t\tgetExpectedToken('[table]');\n\t\tanalizeHeader(n);\n\t\tanalizeRows(n);\n\t\tgetExpectedToken('[/table]');\n\t\tvar tableHeader = n.getElementsByTagName('tr')[0],\n\t\t\ttds = tableHeader.getElementsByTagName('td');\n\t\tfor (var j = 0; j < tds.length; j++) {\n\t\t\ttds[j].style.backgroundColor = attributes['data-bg1'];\n\t\t}\n\t\tvar tableRows = n.getElementsByTagName('tr');\n\t\tfor (var i = 1; i < tableRows.length; i += 2) {\n\t\t\ttds = tableRows[i].getElementsByTagName('td');\n\t\t\tfor (var j = 0; j < tds.length; j++) {\n\t\t\t\ttds[j].style.backgroundColor = attributes['data-bg2'];\n\t\t\t}\n\t\t}\n\t\tfor (var i = 2; i < tableRows.length; i += 2) {\n\t\t\ttds = tableRows[i].getElementsByTagName('td');\n\t\t\tfor (var j = 0; j < tds.length; j++) {\n\t\t\t\ttds[j].style.backgroundColor = attributes['data-bg3'];\n\t\t\t}\n\t\t}\n\n\t\tvar tableCells = n.getElementsByTagName('td');\n\t\tfor (var i = 0; i < tableCells.length; i++) {\n\t\t\ttableCells[i].style.padding = attributes['padding'];\n\t\t\ttableCells[i].style.border = attributes['inner-border'] + ' solid ' + attributes['border-color'];\n\t\t\tn.style.border = attributes['outer-border'] + ' solid ' + attributes['border-color'];\n\t\t}\n\n\t\tjQuery('#wptb-table-header-bg').val(attributes['data-bg1']);\n\t\tjQuery('#wptb-even-row-bg').val(attributes['data-bg2']);\n\t\tjQuery('#wptb-odd-row-bg').val(attributes['data-bg3']);\n\t\tjQuery('#wptb-table-border-color').val(attributes['border-color']);\n\t\tjQuery('#wptb-table-inner-border-number,#wptb-table-inner-border-slider').val(attributes['inner-border']);\n\t\tjQuery('#wptb-table-border-number,#wptb-table-border-slider').val(attributes['outer-border']);\n\n\t\treturn n;\n\t}\n\n\tnode = analizeRoot();\n\n\treturn node;\n\n};","var WPTB_Settings = function () {\n\n\tvar elems = document.getElementsByClassName('wptb-element');\n\n\tfunction detectMode() {\n\t\tvar url = window.location.href,\n\t\t\tregex = new RegExp('[?&]table(=([^&#]*)|&|#|$)'),\n\t\t\tresults = regex.exec(url);\n\t\tif (!results) return false;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, ' '));\n\t}\n\n\tfor (var i = 0; i < elems.length; i++) {\n\t\telems[i].ondragstart = function (event) {\n\t\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\t\tevent.dataTransfer.setData('wptbElement', event.target.dataset.wptbElement);\n\t\t}\n\t};\n\n\tdocument.getElementsByClassName('wptb-save-btn')[0].onclick = function () {\n\t\tvar http = new XMLHttpRequest(),\n\t\t\turl = ajaxurl + \"?action=save_table\",\n\t\t\tt = document.getElementById('wptb-setup-name').value.trim(),\n\t\t\tmessagingArea,\n\t\t\tcode = WPTB_Stringifier(document.getElementsByClassName('wptb-preview-table')[0]);\n\n\t\tif (t === '') {\n\t\t\tmessagingArea = document.getElementById('wptb-messaging-area');\n\t\t\tmessagingArea.innerHTML = '<div class=\"wptb-error wptb-message\">Error: You must assign a name to the table before saving it.</div>';\n\t\t\tmessagingArea.classList.add('wptb-warning');\n\t\t\tsetTimeout(function () {\n\t\t\t\tmessagingArea.removeChild(messagingArea.firstChild);\n\t\t\t}, 4000);\n\t\t\treturn;\n\t\t}\n\n\t\tvar params = 'title=' + t + '&content=' + code;\n\n\t\tif ((rs = detectMode()) || (rs = document.wptbId)) {\n\t\t\tparams += '&id=' + rs;\n\t\t}\n\n\t\thttp.open('POST', url, true);\n\t\thttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\t\thttp.onreadystatechange = function (action) {\n\t\t\tif (this.readyState == 4 && this.status == 200) {\n\n\t\t\t\tvar data = JSON.parse(http.responseText);\n\t\t\t\tmessagingArea = document.getElementById('wptb-messaging-area');\n\n\t\t\t\tif (data[0] == 'saved') {\n\t\t\t\t\tdocument.wptbId = data[1];\n\t\t\t\t\tmessagingArea.innerHTML = '<div class=\"wptb-success wptb-message\">Table \"' + t + '\" was successfully saved.</div>';\n\t\t\t\t} else {\n\t\t\t\t\tmessagingArea.innerHTML = '<div class=\"wptb-success wptb-message\">Table \"' + t + '\" was successfully updated.</div>';\n\n\t\t\t\t}\n\t\t\t\tmessagingArea.classList.add('wptb-success');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tmessagingArea.removeChild(messagingArea.firstChild);\n\t\t\t\t}, 4000);\n\t\t\t}\n\t\t}\n\t\thttp.send(params);\n\t}\n};\n","var WPTB_Space = function (text) {\n\n    function newElementProxy(el) {\n        if (el.includes('list')) {\n            return new WPTB_List();\n        } else if (el.includes('image')) {\n            return new WPTB_Image();\n        } else if (el.includes('text')) {\n            return new WPTB_Text();\n        } else if (el.includes('button')) {\n            return new WPTB_Button();\n        }\n    }\n\n    spaceBetween = document.createElement('div'),\n        spaceBetween.classList.add('wptb-space-between');\n\n    spaceBetween.ondragenter = function () {\n        this.classList.add('visible');\n    };\n    spaceBetween.ondragover = function (event) {\n        event.preventDefault();\n    };\n\n    spaceBetween.ondragleave = function () {\n        this.classList.remove('visible');\n    };\n\n    spaceBetween.ondrop = function (event) {\n        event.stopPropagation();\n\n        var p = event.target.nextSibling,\n            td = event.target,\n            element, t_space, spaceParent;\n\n        while (!td.classList.contains('wptb-droppable')) {\n            td = td.parentNode;\n        }\n\n        if (event.dataTransfer.getData('wptbElement')) {\n            element = newElementProxy(event.dataTransfer.getData('wptbElement'));\n            this.classList.remove('visible');\n\n            if (p == null) {\n                td.appendChild(element.getDOMElement());\n                td.appendChild(new WPTB_Space());\n            } else {\n                td.insertBefore(element.getDOMElement(), p);\n                td.insertBefore(new WPTB_Space(), p);\n            }\n\n        } else {\n            element = document.getElementsByClassName(event.dataTransfer.getData('node'))[0];\n\n            t_space = element.nextSibling;\n            spaceParent = element.parentNode;\n            if (t_space != undefined) {\n                spaceParent.removeChild(t_space);\n            }\n\n            if (p == null) {\n                td.appendChild(element);\n                td.appendChild(new WPTB_Space());\n            } else {\n                td.insertBefore(element, p);\n                td.insertBefore(new WPTB_Space(), p);\n            }\n\n        }\n        this.classList.remove('visible');\n    };\n\n    return spaceBetween;\n\n};","var WPTB_Stringifier = function (node) {\n\n\tif (node == undefined || node.tagName == undefined) {\n\t\treturn '';\n\t}\n\n\tvar code = '', children = node.childNodes,\n\t\tpadding, margin, bg1, bg2, bg3, border,\n\t\tcolSpan, rowSpan, isHidden, borderColor, // Table Attributes\n\t\tlistClass, listStyleType, listAlignment, //list attributes\n\t\tbuttonSize, buttonColor, buttonBorder, buttonTextColor, buttonLink, buttonAlignment, //button attributes\n\t\tfontSize, fontColor, fontFamily, //text attributes\n\t\tsrc, width, height, imageAlignment, imageLink, openInNewTab, //image attributes\n\t\tadditionalCSS, additionalClass, additionalID; // A few global attributes I wanted to add.\n\n\tswitch (node.tagName.toLowerCase()) {\n\t\tcase 'table':\n\t\t\tborder = node.style.borderWidth;\n\t\t\tpadding = node.getElementsByTagName('td')[0].style.padding;\n\t\t\tinnerBorder = node.getElementsByTagName('td')[0].style.borderWidth;\n\t\t\tbg1 = node.rows[0].getElementsByTagName('td')[0].style.backgroundColor.replace(/\\s/g, '');\n\t\t\tborderColor = node.style.borderColor.replace(/\\s/g, '');\n\n\t\t\tif (node.rows.length > 1) {\n\t\t\t\tbg2 = node.rows[1].getElementsByTagName('td')[0].style.backgroundColor.replace(/\\s/g, '');\n\t\t\t}\n\t\t\tif (node.rows.length > 2) {\n\t\t\t\tbg3 = node.rows[2].getElementsByTagName('td')[0].style.backgroundColor.replace(/\\s/g, '');\n\t\t\t}\n\t\t\tcode += '[table border-color=\"'\n\t\t\t\t+ (borderColor != undefined && borderColor != '' ? borderColor : 'transparent')\n\t\t\t\t+ '\" padding=\"' + (padding != undefined && padding != '' ? padding : '0px')\n\t\t\t\t+ '\" inner-border=\"' + (innerBorder != undefined && innerBorder != ''\n\t\t\t\t\t&& node.getElementsByTagName('td')[0].style.borderStyle == 'solid' ?\n\t\t\t\t\tinnerBorder : '0px')\n\t\t\t\t+ '\" outer-border=\"' + (border != undefined && border != '' ? border : '0px')\n\t\t\t\t+ '\" data-bg1=\"' + (bg1 != undefined && bg1 != '' ? bg1 : 'transparent')\n\t\t\t\t+ '\" data-bg2=\"' + (bg2 != undefined && bg2 != '' ? bg2 : 'transparent')\n\t\t\t\t+ '\" data-bg3=\"' + (bg3 != undefined && bg3 != '' ? bg3 : 'transparent')\n\t\t\t\t+ '\"]';\n\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t}\n\n\t\t\tcode += '[/table]';\n\t\t\tbreak;\n\t\tcase 'tbody':\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'tr':\n\t\t\tcode += '[tr]';\n\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t}\n\n\t\t\tcode += '[/tr]';\n\t\t\tbreak;\n\t\tcase 'td': colspan = node.colSpan;\n\t\t\trowspan = node.rowSpan;\n\t\t\tisHidden = node.classList.contains(/^wptb-fused-cell-(\\d+)$/);\n\t\t\tcode += '[td'\n\t\t\t\t+ (colspan != undefined && colspan > 1 ? ' colspan=\"' + colspan + '\"' : '')\n\t\t\t\t+ (rowspan != undefined && rowspan > 1 ? ' rowspan=\"' + rowspan + '\"' : '')\n\t\t\t\t+ (isHidden ? ' hidden=\"true\"' : '')\n\t\t\t\t+ ']';\n\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tcode += WPTB_Stringifier(children[i]);\n\t\t\t}\n\n\t\t\tcode += '[/td]';\n\t\t\tbreak;\n\t\tcase 'div':\n\t\t\tif (node.classList.contains('wptb-ph-element')) {\n\n\t\t\t\tvar infArr = node.className.match(/wptb-element-(.+)-(\\d+)/i),\n\t\t\t\t\toptionsClass, trueNode,\n\t\t\t\t\tnodeContent;\n\t\t\t\tif (infArr == undefined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tswitch (infArr[1]) {\n\t\t\t\t\tcase 'list':\n\t\t\t\t\t\ttrueNode = node.getElementsByTagName('ul')[0];\n\t\t\t\t\t\tif (!trueNode) {\n\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlistStyleType = trueNode.getElementsByTagName('li')[0].style.listStyleType;\n\t\t\t\t\t\tlistClass = listStyleType == 'decimal' ? 'numbered' : 'unordered';\n\t\t\t\t\t\tlistAlignment = trueNode.getElementsByTagName('article')[0].style.justifyContent;\n\n\t\t\t\t\t\tcode += '[list'\n\t\t\t\t\t\t\t+ (listAlignment != undefined ? ' align=\"' + listAlignment + '\"' : 'align=\"left\"')\n\t\t\t\t\t\t\t+ (listClass != undefined ? ' class=\"' + listClass + '\"' : 'class=\"unordered\"')\n\t\t\t\t\t\t\t+ (listStyleType != undefined ? ' style-type=\"' + listStyleType + '\"' : '')\n\t\t\t\t\t\t\t+ ']';\n\t\t\t\t\t\tlistitems = trueNode.getElementsByTagName('article');\n\t\t\t\t\t\tfor (var i = 0; i < listitems.length; i++) {\n\t\t\t\t\t\t\tcode += '[item]';\n\t\t\t\t\t\t\tcode += listitems[i]\n\t\t\t\t\t\t\t\t.getElementsByClassName('wptb-list-item-content')[0]\n\t\t\t\t\t\t\t\t.innerHTML;\n\t\t\t\t\t\t\tcode += '[/item]';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcode += '[/list]';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\ttrueNode = node.getElementsByTagName('img')[0];\n\t\t\t\t\t\tif (!trueNode) {\n\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsrc = trueNode.src;\n\t\t\t\t\t\twidth = trueNode.style.width;\n\t\t\t\t\t\talt = trueNode.alt;\n\t\t\t\t\t\timageLink = undefined;\n\t\t\t\t\t\tif (node.getElementsByTagName('a')[0] &&\n\t\t\t\t\t\t\tnode.getElementsByTagName('a')[0].href != '') {\n\t\t\t\t\t\t\timageLink = node.getElementsByTagName('a')[0].href;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (trueNode.style.display != 'inline') {\n\t\t\t\t\t\t\timageAlignment = 'center';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\timageAlignment = trueNode.style.float;\n\t\t\t\t\t\t}\n\t\t\t\t\t\topenInNewTab = node.getElementsByTagName('a')[0].target;\n\t\t\t\t\t\tcode += '[img'\n\t\t\t\t\t\t\t+ (src != undefined ? ' src=\"' + src + '\"' : 'src=\"\"')\n\t\t\t\t\t\t\t+ (width != undefined ? ' width=\"' + width + '\"' : 'width=\"100%;\"')\n\t\t\t\t\t\t\t+ (alt != undefined ? ' alt=\"' + alt + '\"' : 'alt=\"\"')\n\t\t\t\t\t\t\t+ (imageAlignment != undefined ? ' alignment=\"' + imageAlignment + '\"' : 'alignment=\"left\"')\n\t\t\t\t\t\t\t+ (imageLink != undefined ? ' link=\"' + imageLink + '\"' : 'href=\"#\"')\n\t\t\t\t\t\t\t+ (openInNewTab != undefined ? ' newtab=\"' + openInNewTab + '\"' : 'newtab=\"false\"')\n\t\t\t\t\t\t\t+ ']';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'text':\n\t\t\t\t\t\ttrueNode = node.getElementsByClassName('editable')[0];\n\t\t\t\t\t\tif (!trueNode) {\n\t\t\t\t\t\t\treturn ''; //We ignore the node in case of error\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfontSize = trueNode.parentNode.style.fontSize;\n\t\t\t\t\t\tfontColor = trueNode.parentNode.style.color.replace(/\\s/g, '');\n\t\t\t\t\t\tcode += '[text'\n\t\t\t\t\t\t\t+ (fontSize != undefined ? ' size=\"' + fontSize + '\"' : '')\n\t\t\t\t\t\t\t+ (fontColor != undefined ? ' color=\"' + fontColor + '\"' : '')\n\t\t\t\t\t\t\t+ ']';\n\t\t\t\t\t\tcode += trueNode.innerHTML;\n\t\t\t\t\t\tcode += '[/text]';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'button':\n\t\t\t\t\t\ttrueNode = node.getElementsByClassName('editable')[0];\n\t\t\t\t\t\tif (!trueNode) {\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbuttonColor = trueNode.style.backgroundColor.replace(/\\s/g, '');\n\t\t\t\t\t\tbuttonSize = node.className.match(/wptb-size-(\\w)/i)[1];\n\t\t\t\t\t\tbuttonTextColor = node.getElementsByTagName('a')[0].style.color;\n\n\t\t\t\t\t\tif (!buttonTextColor) {\n\t\t\t\t\t\t\tbuttonTextColor = 'rgb(255,255,255)';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbuttonLink = undefined;\n\t\t\t\t\t\tif (node.getElementsByTagName('a')[0] &&\n\t\t\t\t\t\t\tnode.getElementsByTagName('a')[0].href != '') {\n\t\t\t\t\t\t\tbuttonLink = node.getElementsByTagName('a')[0].href;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbuttonAlignment = node.getElementsByClassName('wptb-button-wrapper')[0].style.justifyContent;\n\t\t\t\t\t\tbuttonOpenInNewTab = node.getElementsByTagName('a')[0].target;\n\t\t\t\t\t\tif (buttonOpenInNewTab == '') {\n\t\t\t\t\t\t\tbuttonOpenInNewTab = '_self';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcode += '[button'\n\t\t\t\t\t\t\t+ (buttonTextColor != undefined ? ' textcolor=\"' + buttonTextColor + '\"' : 'textcolor=\"rgb(255,255,255)\"')\n\t\t\t\t\t\t\t+ (buttonColor != undefined ? ' color=\"' + buttonColor + '\"' : 'rgb(50,157,63)')\n\t\t\t\t\t\t\t+ (buttonSize != undefined ? ' size=\"' + buttonSize + '\"' : ' size=\"M\"')\n\t\t\t\t\t\t\t+ (buttonAlignment != undefined ? ' alignment=\"' + buttonAlignment + '\"' : ' alignment=\"center\"')\n\t\t\t\t\t\t\t+ (buttonLink != undefined ? ' link=\"' + buttonLink + '\"' : ' link=\"#\"')\n\t\t\t\t\t\t\t+ (buttonOpenInNewTab != undefined ? ' newtab=\"' + buttonOpenInNewTab + '\"' : 'newtab=\"_self\"')\n\t\t\t\t\t\t\t+ ']';\n\t\t\t\t\t\tcode += trueNode.innerHTML;\n\t\t\t\t\t\tcode += '[/button]';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcode += '';\n\t\t\tbreak;\n\t}\n\n\tif (node.nextSibling != undefined) {\n\t\tWPTB_Stringifier(node.nextSibling);\n\t}\n\n\treturn code;\n\n};","var array = [], WPTB_Table = function (columns, rows) {\n\n\t/* The members of the class */\n\tvar settings = document.getElementsByClassName('wptb-settings-items'),\n\t\twptbTableSetup = document.getElementsByClassName(\"wptb-table-setup\")[0],\n\t\ttable, row, cell,\n\t\tmaxAmountOfCells,\n\t\tmaxAmountOfRows;\n\n\t//HERE ARE THE PRIVATE FUNCTIONS\n\t/*\n\t * This function toggles buttons visibility in cell edit mode\n\t * (according to the amount of currently selected cells), and\n\t * highlights visually the clicked cell if it is not highlighted, or\n\t * removes highlight if clicked cell is already highlighted. \n\t * It too toggles the bits of our abstract representation.\n\t * @param Event this is the event instance of the click performed over a cell.\n\t */\n\tvar mark = function (event) {\n\t\tvar rs = this.rowSpan,\n\t\t\tcs = this.colSpan,\n\t\t\tmarkedCells,\n\t\t\tnoCells = document.getElementsByClassName('no-cell-action'),\n\t\t\tsingleCells = document.getElementsByClassName('single-action'),\n\t\t\tmultipleCells = document.getElementsByClassName('multiple-select-action'),\n\t\t\tposition = getCoords(this),\n\t\t\trow = position[0],\n\t\t\tcolumn = position[1];\n\t\tif (!document.select.isActivated()) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.className.match(/wptb-highlighted/)) {\n\t\t\tthis.classList.remove('wptb-highlighted');\n\t\t\tfor (var i = 0; i < rs; i++) {\n\t\t\t\tfor (var j = 0; j < cs; j++) {\n\t\t\t\t\tarray[row + i][column + j] = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.classList.add('wptb-highlighted');\n\t\t\tfor (var i = 0; i < rs; i++) {\n\t\t\t\tfor (var j = 0; j < cs; j++) {\n\t\t\t\t\tarray[row + i][column + j] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tmarkedCells = document.getElementsByClassName('wptb-highlighted').length;\n\t\tif (markedCells === 0) {\n\t\t\tfor (var i = 0; i < multipleCells.length; i++) {\n\t\t\t\tmultipleCells[i].classList.remove('visible');\n\t\t\t}\n\t\t\tfor (var i = 0; i < noCells.length; i++) {\n\t\t\t\tnoCells[i].classList.add('visible');\n\t\t\t}\n\t\t\tfor (var i = 0; i < singleCells.length; i++) {\n\t\t\t\tsingleCells[i].classList.remove('visible');\n\t\t\t}\n\t\t} else if (markedCells === 1) {\n\t\t\tfor (var i = 0; i < multipleCells.length; i++) {\n\t\t\t\tmultipleCells[i].classList.remove('visible');\n\t\t\t}\n\t\t\tfor (var i = 0; i < noCells.length; i++) {\n\t\t\t\tnoCells[i].classList.remove('visible');\n\t\t\t}\n\t\t\tfor (var i = 0; i < singleCells.length; i++) {\n\t\t\t\tsingleCells[i].classList.add('visible');\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < multipleCells.length; i++) {\n\t\t\t\tif (table.isSquare(array)) {\n\t\t\t\t\tmultipleCells[i].classList.add('visible');\n\t\t\t\t} else {\n\t\t\t\t\tmultipleCells[i].classList.remove('visible');\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < noCells.length; i++) {\n\t\t\t\tnoCells[i].classList.remove('visible');\n\t\t\t}\n\t\t\tfor (var i = 0; i < singleCells.length; i++) {\n\t\t\t\tsingleCells[i].classList.remove('visible');\n\t\t\t}\n\t\t}\n\t};\n\n\t/* \n\t * This function fills an array with 1's according to the actual design\n\t * of HTML table.\n\t * @returns an array of arrays containing an abstract representation\n\t * of HTML table.\n\t * @deprecated\n\t * */\n\n\tvar realTimeArray = function () {\n\t\tvar carried = [], tds, cols, matriz = [];\n\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\tcarried[i] = 0;\n\t\t}\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tcols = [];\n\n\t\t\tvar tds = table.rows[i].getElementsByTagName('td');\n\n\t\t\tfor (items = 0; items < tds.length; items++) {\n\n\t\t\t\tfor (var k = 0; k < tds[items].colSpan; k++) {\n\t\t\t\t\tcols.push(1);\n\t\t\t\t}\n\n\t\t\t\tif (tds[items].rowSpan > 1) {\n\t\t\t\t\tfor (var k = 0; k < tds[items].colSpan; k++) {\n\t\t\t\t\t\tcarried[items + k] = {\n\t\t\t\t\t\t\tjustAssigned: true,\n\t\t\t\t\t\t\tamount: tds[items].rowSpan\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var k = 0; k < maxAmountOfCells; k++) {\n\t\t\t\tif (typeof carried[k] == 'object' && carried[k].amount > 0) {\n\t\t\t\t\tcarried[k].amount--;\n\t\t\t\t\tif (carried[k].justAssigned) {\n\t\t\t\t\t\tcarried[k].justAssigned = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcols.push(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmatriz.push(cols);\n\n\t\t}\n\t\treturn matriz;\n\t};\n\n\t/*\n\t * This function gets the number and position of cell spaces in current row that are occuped \n\t * by upper rowspanned cells.\n\t * @param number the number of row where we wish to calculate the carried rowspans up to.\n\t * @return an array with the remaining rowspans in each column.\n\t */\n\tvar carriedRowspans = function (row) {\n\t\tvar carried = [], tds, cols;\n\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\tcarried[i] = 0;\n\t\t}\n\n\t\tif (row == -1) {\n\t\t\treturn carried;\n\t\t}\n\n\t\tfor (var i = 0; i <= row; i++) {\n\t\t\tcellsBuffer = table.rows[i].getElementsByTagName('td');\n\t\t\tcellPointer = 0;\n\n\t\t\tfor (var xPosition = 0; xPosition < maxAmountOfCells; xPosition += stepsToMove) {\n\t\t\t\tstepsToMove = 1;\n\n\t\t\t\tif (carried[xPosition]) {\n\t\t\t\t\tcarried[xPosition]--;\n\t\t\t\t} else {\n\t\t\t\t\tcelda = cellsBuffer[cellPointer++];\n\t\t\t\t\tif (celda.rowSpan > 1) {\n\t\t\t\t\t\tfor (k = 0; k < celda.colSpan; k++) {\n\t\t\t\t\t\t\tcarried[xPosition + k] = celda.rowSpan - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstepsToMove = celda.colSpan;\n\t\t\t\t\t} else if (celda.colSpan > 1) {\n\t\t\t\t\t\tstepsToMove = celda.colSpan;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn carried;\n\t};\n\n\t/*\n\t * A helpful function for showing\n\t * the abstract table in console.\n\t * @param Array our abstract table.\n\t */\n\tvar drawTable = function (a) {\n\t\tvar string = 'DRAWING TABLE:\\n';\n\t\tfor (var i = 0; i < a.length; i++) {\n\n\t\t\tfor (var j = 0; j < a[i].length; j++) {\n\t\t\t\tstring += ' ' + a[i][j];\n\t\t\t}\n\t\t\tstring += '\\n';\n\t\t}\n\t\ttable.isSquare(a);\n\t};\n\n\t/*\n\t * It resets all the bits of our abstract representation\n\t * to 0 and removes the highlighting class of all cells.\n\t */\n\n\tvar undoSelect = function () {\n\t\tvar noCells = document.getElementsByClassName('no-cell-action'),\n\t\t\tsingleCells = document.getElementsByClassName('single-action'),\n\t\t\tmultipleCells = document.getElementsByClassName('multiple-select-action'),\n\t\t\ttds = table.getElementsByClassName('wptb-highlighted');\n\t\twhile (tds.length) {\n\t\t\ttds[0].classList.remove('wptb-highlighted');\n\t\t}\n\t\tfor (var i = 0; i < array.length; i++) {\n\t\t\tfor (var j = 0; j < array[i].length; j++) {\n\t\t\t\tarray[i][j] = 0;\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0; i < multipleCells.length; i++) {\n\t\t\tmultipleCells[i].classList.remove('visible');\n\t\t}\n\t\tfor (var i = 0; i < noCells.length; i++) {\n\t\t\tnoCells[i].classList.add('visible');\n\t\t}\n\t\tfor (var i = 0; i < singleCells.length; i++) {\n\t\t\tsingleCells[i].classList.remove('visible');\n\t\t}\n\t};\n\n\t/*\n\t * This fills the abstract representation of our table with \n\t * zeros, at the start. the max amount of cells is the greatest sum\n\t * of all colspans for row.\n\t */\n\n\tvar fillTableArray = function () {\n\t\tvar colspansSums = [], a = [];\n\n\t\t//calculate max amount of cells inside a row\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tvar cells = table.rows[i].getElementsByTagName('td'),\n\t\t\t\tcolspanSumInRow = 0;\n\t\t\tfor (var j = 0; j < cells.length; j++) {\n\t\t\t\tcolspanSumInRow += cells[j].colSpan;\n\t\t\t}\n\t\t\tcolspansSums.push(colspanSumInRow);\n\t\t}\n\n\t\tmaxAmountOfCells = Math.max.apply(null, colspansSums);\n\t\t//calculate max rows\n\t\tvar maxAmountOfRows = table.rows.length;\n\n\t\t// fill with zeros from both values\n\t\tfor (var i = 0; i < maxAmountOfRows; i++) {\n\t\t\ta[i] = [];\n\t\t\tfor (var j = 0; j < maxAmountOfCells; j++) {\n\t\t\t\ta[i].push(0);\n\t\t\t}\n\t\t}\n\t\tdrawTable(a);\n\t\treturn a;\n\t};\n\n\t/*\n\t * This function gets the sum of all colspans in a row.\n\t * @param number the number of row to be used as reference.\n\t */\n\tvar getActualPointsInRow = function (row) {\n\t\tvar tds = table.rows[row].getElementsByTagName('td'),\n\t\t\tpoints = 0;\n\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\tpoints += tds[i].colSpan;\n\t\t}\n\t\treturn points;\n\t}\n\n\t/*\n\t * This function gets us the exact coordinates of\n\t * an exact cell, in a more reliable way than xIndex and yIndex,\n\t * these last ones were meant to be used for getting the cell trough them.\n\t * @param DOMElement the cell to get the coordinates.\n\t */\n\tvar getCoords = function (search) {\n\t\tvar skipInCols = [], cell;\n\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\tskipInCols[i] = 0;\n\t\t}\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tvar cellsBuffer = table.rows[i].getElementsByTagName('td');\n\t\t\tcellPointer = 0;\n\t\t\tfor (var xPosition = 0; xPosition < maxAmountOfCells; xPosition += stepsToMove) {\n\t\t\t\tstepsToMove = 1;\n\n\t\t\t\tif (skipInCols[xPosition]) {\n\t\t\t\t\tskipInCols[xPosition]--;\n\t\t\t\t} else {\n\t\t\t\t\tvar td = cellsBuffer[cellPointer++];\n\t\t\t\t\tif (td == search) {\n\t\t\t\t\t\treturn [i, xPosition];\n\t\t\t\t\t}\n\t\t\t\t\tif (td.rowSpan > 1) {\n\t\t\t\t\t\tfor (k = 0; k < td.colSpan; k++) {\n\t\t\t\t\t\t\tskipInCols[xPosition + k] = td.rowSpan - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstepsToMove = td.colSpan;\n\t\t\t\t\t} else if (td.colSpan > 1) {\n\t\t\t\t\t\tstepsToMove = td.colSpan;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t//END OF PRIVATE FUNCTIONS\n\tfor (var i = 0; i < settings.length; i++) {\n\t\tif (settings[i].id !== 'wptb-apply-inner-border') {\n\t\t\tsettings[i].classList.add('visible');\n\t\t}\n\t}\n\n\t//Create a HTML Table element.\n\ttable = document.createElement('table');\n\ttable.classList.add('wptb-preview-table');\n\n\tjQuery('#wptb-table-header-bg').val('');\n\tjQuery('#wptb-even-row-bg').val('');\n\tjQuery('#wptb-odd-row-bg').val('');\n\tjQuery('#wptb-table-border-color').val('');\n\tjQuery('#wptb-table-inner-border-number,#wptb-table-inner-border-slider').val('0');\n\tjQuery('#wptb-table-border-number,#wptb-table-border-slider').val('0');\n\tjQuery('#wptb-table-padding-number,#wptb-table-padding-slider').val('15');\n\n\t//Add the header row.\n\trow = table.insertRow(-1);\n\trow.classList.add('wptb-table-head', 'wptb-row');\n\n\tfor (var i = 0; i < columns; i++) {\n\t\tcell = new WPTB_Cell(mark);\n\t\tcell.setCoords(0, i);\n\t\trow.appendChild(cell.getDOMElement());\n\t}\n\n\t//Add the data rows.\n\tfor (var i = 1; i < rows; i++) {\n\n\t\trow = table.insertRow(-1);\n\t\trow.classList.add('wptb-row');\n\n\t\tfor (var j = 0; j < columns; j++) {\n\t\t\tcell = new WPTB_Cell(mark);\n\t\t\tcell.setCoords(i, j);\n\t\t\trow.appendChild(cell.getDOMElement());\n\t\t}\n\t}\n\n\t/*\n\t * This just toggles visibility of cell edit bar, and toggles \n\t * cell selecting mode.\n\t */\n\n\ttable.toggleTableEditMode = function () {\n\t\tvar bar = document.getElementById('edit-bar');\n\t\tif (bar.classList.contains('visible')) {\n\t\t\tdocument.select.deactivateMultipleSelectMode();\n\t\t\tbar.classList.remove('visible');\n\t\t} else {\n\t\t\tdocument.select.activateMultipleSelectMode();\n\t\t\tbar.classList.add('visible');\n\t\t}\n\t}\n\n\t/*\n\t * For assigning to each cell xIndex and y Index attributes,\n\t * these are the column number and row number of cell in table. \n\t */\n\n\ttable.recalculateIndexes = function () {\n\t\tvar trs = this.getElementsByTagName('tr'), tds, maxCols = 0;\n\n\t\tfor (var i = 0; i < trs.length; i++) {\n\t\t\ttds = trs[i].getElementsByTagName('td');\n\t\t\tfor (var j = 0; j < tds.length; j++) {\n\n\t\t\t\tif (i == 0) {\n\t\t\t\t\ttds[j].parentNode.className = '';\n\t\t\t\t\ttds[j].style.backgroundColor = jQuery('#wptb-table-header-bg').val();\n\t\t\t\t\ttds[j].parentNode.classList.add('wptb-row', 'wptb-table-head');\n\t\t\t\t} else {\n\t\t\t\t\tif (i % 2 == 0) {\n\t\t\t\t\t\ttds[j].style.backgroundColor = jQuery('#wptb-odd-row-bg').val();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttds[j].style.backgroundColor = jQuery('#wptb-even-row-bg').val();\n\t\t\t\t\t}\n\t\t\t\t\ttds[j].parentNode.className = '';\n\t\t\t\t\ttds[j].parentNode.classList.add('wptb-row');\n\t\t\t\t}\n\n\t\t\t\ttds[j].dataset.xIndex = j;\n\t\t\t\ttds[j].dataset.yIndex = i;\n\t\t\t}\n\t\t\tif (j > maxCols) {\n\t\t\t\tmaxCols = j;\n\t\t\t}\n\t\t}\n\t\tthis.columns = maxCols;\n\t}\n\n\t/*\n\t * As simple as it is: adds a column to the end of table.\n\t */\n\ttable.addColumnEnd = function () {\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\ttd = new WPTB_Cell(mark);\n\t\t\ttable.rows[i].appendChild(td.getDOMElement());\n\t\t\tarray[i].push(0);\n\t\t}\n\t\tmaxAmountOfCells++;\n\t\trecalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * As simple as it looks: adds a column to the start of table.\n\t */\n\n\ttable.addColumnStart = function () {\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\ttd = new WPTB_Cell(mark);\n\t\t\tfirstCell = table.rows[i].getElementsByTagName('td')[0];\n\t\t\tif (firstCell) {\n\t\t\t\ttable.rows[i].insertBefore(td.getDOMElement(), firstCell);\n\t\t\t} else {\n\t\t\t\ttable.rows[i].appendChild(td.getDOMElement());\n\t\t\t}\n\t\t\tarray[i].push(0);\n\t\t}\n\n\t\tmaxAmountOfCells++;\n\t\trecalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * Well, not so simple as previous functions.\n\t * It adds a column after a certain column of reference.\n\t * @param integer the column number to be used as reference.\n\t *\tIf empty, then the first highlighted cell is used as reference.\n\t */\n\n\ttable.addColumnAfter = function (c_pos) {\n\t\tvar rows = table.rows,\n\t\t\tcellsBuffer,\n\t\t\tcell = document.querySelector('.wptb-highlighted'),\n\t\t\tpos = c_pos != undefined && typeof c_pos === 'number' ? c_pos : getCoords(cell)[1],\n\t\t\tpendingInsertion = false,\n\t\t\tstepsToMove,\n\t\t\ttd, bro,\n\t\t\tcarriedRowspans = [],\n\t\t\tcurrentCell;\n\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\tcarriedRowspans.push(0);\n\t\t}\n\n\t\tfor (var i = 0; i < rows.length; i++) {\n\t\t\tcellPointer = 0;\n\t\t\tcellsBuffer = rows[i].getElementsByTagName('td');\n\t\t\tpendingInsertion = false;\n\t\t\tfor (var xPosition = 0;\n\t\t\t\txPosition < maxAmountOfCells;\n\t\t\t\txPosition += stepsToMove) {\n\t\t\t\tstepsToMove = 1;\n\n\t\t\t\tif (pendingInsertion) {\n\t\t\t\t\ttd = new WPTB_Cell(mark);\n\n\t\t\t\t\tif (currentCell && rows[i].contains(currentCell)) {\n\t\t\t\t\t\tbro = currentCell.nextSibling;\n\t\t\t\t\t\tif (bro) {\n\t\t\t\t\t\t\trows[i].insertBefore(td.getDOMElement(), bro);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trows[i].appendChild(td.getDOMElement());\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trows[i].insertBefore(td.getDOMElement(), cellsBuffer[0]);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (carriedRowspans[xPosition] > 0) {\n\t\t\t\t\t// If no pending insertion, let's check if no rowspan from upper cells is pending in current position\n\t\t\t\t\tif (pos == xPosition) {\n\t\t\t\t\t\tpendingInsertion = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcurrentCell = cellsBuffer[cellPointer++];\n\t\t\t\t\tif (currentCell.rowSpan > 1) {\n\t\t\t\t\t\tstepsToMove = currentCell.colSpan;\n\t\t\t\t\t\tfor (var k = 0; k < currentCell.colSpan; k++) {\n\t\t\t\t\t\t\tcarriedRowspans[xPosition + k] = currentCell.rowSpan;\n\t\t\t\t\t\t\tif (xPosition + k == pos) {\n\t\t\t\t\t\t\t\tpendingInsertion = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (currentCell.colSpan > 1) {\n\t\t\t\t\t\tstepsToMove = currentCell.colSpan;\n\t\t\t\t\t\tfor (var k = 0; k < currentCell.colSpan; k++) {\n\t\t\t\t\t\t\tif (xPosition + k == pos) {\n\t\t\t\t\t\t\t\tpendingInsertion = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (xPosition == pos) {\n\t\t\t\t\t\tpendingInsertion = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var l = 0; l < maxAmountOfCells; l++) {\n\t\t\t\tif (carriedRowspans[l] > 0)\n\t\t\t\t\tcarriedRowspans[l]--;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (var i = 0; i < array.length; i++) {\n\t\t\tarray[i].push(0);\n\t\t}\n\t\tmaxAmountOfCells++;\n\t\tdrawTable(array);\n\t\ttable.recalculateIndexes();\n\t\tundoSelect();\n\n\t};\n\n\t/*\n\t * For preventing us to take a lot of time,\n\t * This is just calling the function addColumnAfter, but\n\t * using the previous column to current one as reference.\n\t * @see addColumnAfter\n\t */\n\n\ttable.addColumnBefore = function () {\n\t\tvar cell = document.querySelector('.wptb-highlighted'),\n\t\t\tpos = getCoords(cell)[1];\n\n\t\tif (pos === 0) {\n\t\t\ttable.addColumnStart();\n\t\t}\n\t\telse {\n\t\t\ttable.addColumnAfter(pos - 1);\n\t\t}\n\t};\n\n\t/*\n\t * Luckily, thisfunction is simple, \n\t * it just add a row to the end of table.\n\t */\n\n\ttable.addRowToTheEnd = function () {\n\t\tvar r = table.insertRow(-1),\n\t\t\ttd,\n\t\t\taux;\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\ttd = new WPTB_Cell(mark);\n\t\t\tr.appendChild(td.getDOMElement());\n\t\t}\n\t\taux = Array.from(array[0]);\n\t\tarray.push(aux);\n\t\tdrawTable(array);\n\t\ttable.recalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * Yet another simple function, \n\t * it just add a row to the start of table.\n\t */\n\n\ttable.addRowToTheStart = function () {\n\t\tvar r = table.insertRow(0);\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\ttd = new WPTB_Cell(mark);\n\t\t\tr.appendChild(td.getDOMElement());\n\t\t}\n\t\taux = Array.from(array[0]);\n\t\tarray.push(aux);\n\t\tdrawTable(array);\n\t\ttable.recalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/* \n\t * This function adds a row before the current one.\n\t * Since the biggest factor of problem is a not-started but ongoing rowspan,\n\t * the most of the troubles is not here.\n\t */\n\n\ttable.addRowBefore = function () {\n\t\tvar cell = document.querySelector('.wptb-highlighted'),\n\t\t\trow = getCoords(cell)[0],\n\t\t\tr = table.insertRow(row),\n\t\t\taux,\n\t\t\trowspans = carriedRowspans(row - 1);\n\n\t\tnoPending = rowspans.filter(function (elem) {\n\t\t\treturn elem == 0;\n\t\t});\n\n\t\tfor (var i = 0; i < noPending.length; i++) {\n\t\t\tvar td = new WPTB_Cell(mark);\n\t\t\tr.appendChild(td.getDOMElement());\n\t\t}\n\n\t\tarr = realTimeArray();\n\n\t\tfor (var i = 0; i < arr.length; i++) {\n\n\t\t\tif (arr[i].length > maxAmountOfCells) {\n\t\t\t\t//Still not watched\n\t\t\t}\n\n\t\t\tif (arr[i].length < maxAmountOfCells) {\n\n\t\t\t\tfor (var j = arr[i].length; j < maxAmountOfCells; j++) {\n\t\t\t\t\ttd = new WPTB_Cell(mark);\n\t\t\t\t\ttable.rows[i].appendChild(td.getDOMElement());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\taux = Array.from(array[0]);\n\t\tarray.push(aux);\n\t\tdrawTable(array);\n\t\ttable.recalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * Well... by the name convention of the previous 3 functions,\n\t * it's pretty obvious that this functions attaches a new\n\t * row after highlighted cell row. The greatest obstacle it was\n\t * the possibility of a TR not having the exact amount of columns\n\t * occuped by actual node but rowspanned upper cells. For that purpose\n\t * it was created the function realTimeArray.\n\t * @see realTimeArray\n\t */\n\n\ttable.addRowAfter = function () {\n\n\t\tvar cell = document.querySelector('.wptb-highlighted'),\n\t\t\trow = getCoords(cell)[0],\n\t\t\tr = table.insertRow(row + 1),\n\t\t\taux,\n\t\t\trowspans = carriedRowspans(row);\n\n\t\tnoPending = rowspans.filter(function (elem) {\n\t\t\treturn elem == 0;\n\t\t});\n\n\t\tfor (var i = 0; i < noPending.length; i++) {\n\t\t\ttd = new WPTB_Cell(mark);\n\t\t\tr.appendChild(td.getDOMElement());\n\t\t}\n\n\t\tarr = realTimeArray();\n\n\t\tfor (var i = 0; i < arr.length; i++) {\n\n\t\t\tif (arr[i].length > maxAmountOfCells) {\n\t\t\t\t//Still not watched\n\t\t\t}\n\n\t\t\tif (arr[i].length < maxAmountOfCells) {\n\n\t\t\t\tfor (var j = arr[i].length; j < maxAmountOfCells; j++) {\n\t\t\t\t\ttd = new WPTB_Cell(mark);\n\t\t\t\t\ttable.rows[i].appendChild(td.getDOMElement());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\taux = Array.from(array[0]);\n\t\tarray.push(aux);\n\t\tdrawTable(array);\n\t\ttable.recalculateIndexes();\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * This function checks the current selected cells\n\t * make a rectangular shape.\n\t * @param Array the abstract table.\n\t * @return false, if not making a rectangle, or\n\t *\tArray an array containing number of rows and columns, if selection makes a rectangle.\n\t */\n\n\ttable.isSquare = function (a) {\n\t\tvar rowStart = -1,\n\t\t\tcolumnStart = -1,\n\t\t\trowEnd = -1,\n\t\t\tcolumnEnd = -1,\n\t\t\theight,\n\t\t\twidth,\n\t\t\titemsEstimate = 0,\n\t\t\titems = 0;\n\n\t\tfor (var i = 0; i < a.length; i++) {\n\t\t\tfor (var j = 0; j < a[i].length; j++) {\n\t\t\t\tif (a[i][j] == 1) {\n\t\t\t\t\trowStart = i;\n\t\t\t\t\tcolumnStart = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (rowStart !== -1 && columnStart !== -1) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = a.length - 1; i > -1; i--) {\n\t\t\tfor (var j = a[i].length - 1; j > -1; j--) {\n\t\t\t\tif (a[i][j] == 1) {\n\t\t\t\t\trowEnd = i;\n\t\t\t\t\tcolumnEnd = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (rowEnd !== -1 && columnEnd !== -1) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\t\tfor (var i = rowStart; i < rowEnd; i++) {\n\t\t\tfor (var j = columnStart; j < columnEnd; j++) {\n\t\t\t\tif (a[i][j] == 0 || a[i][j] == undefined) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < a.length; i++) {\n\t\t\tfor (var j = 0; j < a[i].length; j++) {\n\t\t\t\tif (a[i][j] == 1) {\n\t\t\t\t\titems++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\theight = rowEnd - rowStart + 1;\n\t\twidth = columnEnd - columnStart + 1;\n\t\titemsEstimate = height * width;\n\n\t\tif (itemsEstimate !== items) {\n\t\t\treturn false;\n\t\t}\n\t\treturn [height, width];\n\t};\n\n\t/*\n\t * This function merges all selected cells.\n\t * Well, actually sets the colspan and rowspan of first \n\t * upper left  cell in selection and deletes the another selected cells.\n\t */\n\n\ttable.mergeCells = function () {\n\t\tvar dimensions = table.isSquare(array),\n\t\t\trowspan = dimensions[0],\n\t\t\tcolspan = dimensions[1],\n\t\t\tfirst = document.querySelector('.wptb-highlighted'),\n\t\t\ttds = [].slice.call(document.getElementsByClassName('wptb-highlighted'), 1);\n\n\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\tvar p = tds[i].parentNode;\n\t\t\tp.removeChild(tds[i]);\n\t\t}\n\n\t\tfirst.colSpan = colspan;\n\t\tfirst.rowSpan = rowspan;\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * This functions makes the exact inverse as above.\n\t * It resets colspan and rowspan and appends \n\t * the same amount in cells to the table.\n\t * @bug\n\t */\n\n\ttable.splitCell = function () {\n\t\tvar cell = document.getElementsByClassName('wptb-highlighted')[0],\n\t\t\trowspan = cell.rowSpan,\n\t\t\tcolspan = cell.colSpan;\n\t\tcell.rowSpan = 1;\n\t\tcell.colSpan = 1;\n\t\ttable.addLackingCells();\n\n\t\tundoSelect();\n\t};\n\n\t/*\n\t * Searches for rowspanned cells up to row number meeting it.\n\t * @param number the number of row where the function\n\t * must search up to.\n\t */\n\n\ttable.findRowspannedCells = function (row) {\n\t\tvar array = [],\n\t\t\tdifference;\n\t\tactualPoints = getActualPointsInRow(row);\n\t\tif (actualPoints === maxAmountOfCells) {\n\t\t\treturn [];\n\t\t}\n\t\tdifference = maxAmountOfCells - actualPoints;\n\n\t\tfor (var i = row - 1; i >= 0 && difference; i--) {\n\t\t\tvar tds = table.rows[i].getElementsByTagName('td');\n\t\t\tfor (var i = 0; i < tds.length; i++) {\n\t\t\t\tif (tds[i].rowSpan > 1) {\n\t\t\t\t\tarray.push(tds[i]);\n\t\t\t\t\tdifference -= tds[i].colSpan;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn array;\n\n\t}\n\n\t/*\n\t * This function explores the table and adds \n\t * a cell for each lacking one for each row\n\t * to meet an even amount of cells.\n\t */\n\n\ttable.addLackingCells = function () {\n\t\tvar sumRows = [];\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tsumRows.push(0);\n\t\t}\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tvar tds = table.rows[i].getElementsByTagName('td');\n\t\t\tfor (var j = 0; j < tds.length; j++) {\n\t\t\t\tif (tds[j].rowSpan > 1) {\n\t\t\t\t\tfor (var k = 1; k < tds[j].rowSpan; k++) {\n\t\t\t\t\t\tsumRows[i + k]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tvar tds = table.rows[i].getElementsByTagName('td'),\n\t\t\t\ttotalColspan = 0;\n\t\t\tfor (var j = 0; j < tds.length; j++) {\n\t\t\t\ttotalColspan += tds[j].colSpan;\n\t\t\t}\n\t\t\ttotalColspan += sumRows[i];\n\t\t\tdifference = maxAmountOfCells - totalColspan;\n\t\t\tfor (var j = 0; j < difference; j++) {\n\t\t\t\tvar td = new WPTB_Cell(mark);\n\t\t\t\ttable.rows[i].appendChild(td.getDOMElement());\n\t\t\t}\n\t\t}\n\n\t};\n\n\t/*\n\t * This function deletes the row of currently\n\t * selected cell. \n\t */\n\n\ttable.deleteRow = function () {\n\n\t\tvar cell = document.querySelector('.wptb-highlighted'),\n\t\t\trow = getCoords(cell)[0],\n\t\t\treduct = table.findRowspannedCells(row);\n\n\t\tfor (i = 0; i < reduct.length; i++) {\n\t\t\treduct[i].rowSpan--;\n\t\t}\n\n\t\ttable.getElementsByTagName('tbody')[0].removeChild(table.rows[row]);\n\t\tarray.pop();\n\t\tundoSelect();\n\t\ttable.addLackingCells();\n\t}\n\n\t/*\n\t * This function deletes the column of currently\n\t * selected cell. Again, this is way more complicated than\n\t * delete row case.\n\t */\n\n\ttable.deleteColumn = function () {\n\n\t\tvar cell_ref = document.querySelector('.wptb-highlighted'),\n\t\t\tcolumn = getCoords(cell_ref)[1],\n\t\t\tbuffer, cell,\n\t\t\tcarriedRowspans = [];\n\n\t\tfor (var i = 0; i < maxAmountOfCells; i++) {\n\t\t\tcarriedRowspans.push(0);\n\t\t}\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tbuffer = table.rows[i].getElementsByTagName('td');\n\t\t\tstepsToMove = 1;\n\t\t\tcellPointer = 0;\n\t\t\tfor (var j = 0; j < maxAmountOfCells; j += stepsToMove) {\n\n\t\t\t\tstepsToMove = 1;\n\n\t\t\t\tif (carriedRowspans[j] == 0) {\n\t\t\t\t\tcell = buffer[cellPointer++];\n\t\t\t\t\tif (cell.rowSpan > 1) {\n\t\t\t\t\t\tstepsToMove = cell.colSpan;\n\t\t\t\t\t\tfor (var k = 0; k < cell.colSpan; k++) {\n\t\t\t\t\t\t\tcarriedRowspans[j + k] = cell.rowSpan;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (column > j && column <= j + k - 1) {\n\t\t\t\t\t\t\t//cell.style.backgroundColor = 'pink';\n\t\t\t\t\t\t\tcell.colSpan--;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (cell.colSpan > 1) {\n\t\t\t\t\t\tstepsToMove = cell.colSpan;\n\n\t\t\t\t\t\tif (column > j && column <= j + cell.colSpan - 1) {\n\t\t\t\t\t\t\t//cell.style.backgroundColor = 'pink';\n\t\t\t\t\t\t\tcell.colSpan--;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\tif (column == j) {\n\t\t\t\t\t\t\ttable.rows[i].removeChild(cell);\n\t\t\t\t\t\t\t//cell.style.backgroundColor = 'pink';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var l = 0; l < carriedRowspans.length; l++) {\n\t\t\t\tif (carriedRowspans[l] > 0) {\n\t\t\t\t\tcarriedRowspans[l]--;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\tmaxAmountOfCells--;\n\n\t\tfor (var i = 0; i < table.rows.length; i++) {\n\t\t\tif (array[i] != undefined)\n\t\t\t\tarray[i].pop();\n\t\t}\n\t\tundoSelect();\n\t};\n\n\tdocument.getElementsByClassName('wptb-table-generator')[0].style.display = 'none';\n\n\tarray = fillTableArray();\n\n\tundoSelect();\n\tdrawTable(array);\n\n\twptbTableSetup.appendChild(table);\n\n\ttable.recalculateIndexes();\n\n\tWPTB_LeftPanel();\n\n\n};","var WPTB_Text = function (text) {\n\n\tvar DOMElement = document.createElement('div'),\n\t\telText2 = document.createElement('div'),\n\t\telP = document.createElement('p');\n\n\tthis.kind = 'text';\n\n\telText2.classList.add('editable');\n\telP.innerHTML = text != undefined ? text : 'Text';\n\telText2.appendChild(elP);\n\tDOMElement.appendChild(elText2);\n\n\tthis.getDOMElement = function () {\n\t\treturn DOMElement;\n\t}\n\tapplyGenericItemSettings(this);\n\n\treturn this;\n\n};","var applyGenericItemSettings = function (element) {\n\tvar node = element.getDOMElement(),\n\t\tindex = document.counter.nextIndex(element.kind),\n\t\tlistItems;\n\n\tnode.onmouseenter = function (event) {\n\t\tthis.classList.add('wptb-directlyhovered');\n\t\tvar btnDelete = document.createElement('span'),\n\t\t\tbtnCopy = document.createElement('span'),\n\t\t\tbtnMove = document.createElement('span'),\n\t\t\tactions = document.createElement('span'),\n\t\t\tprevious, i;\n\t\tactions.classList.add('wptb-actions');\n\t\tbtnDelete.classList.add('dashicons', 'dashicons-trash', 'delete-action');\n\t\tbtnCopy.classList.add('dashicons', 'dashicons-admin-page', 'duplicate-action');\n\t\tbtnMove.classList.add(\"dashicons\", \"dashicons-move\", 'move-action');\n\t\tbtnMove.draggable = true;\n\t\tbtnDelete.onclick = function (event) {\n\t\t\tvar act = this.parentNode.parentNode,\n\t\t\t\tel = act.parentNode,\n\t\t\t\tspace = act.nextSibling,\n\t\t\t\tnum, space2;\n\t\t\tel.removeChild(act);\n\t\t\tel.removeChild(space);\n\t\t\tnum = el.getElementsByClassName('wptb-ph-element').length;\n\t\t\tif (!num) {\n\t\t\t\tspace2 = el.getElementsByClassName('wptb-space-between')[0];\n\t\t\t\tif (space2) {\n\t\t\t\t\tel.removeChild(space2);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tbtnCopy.onclick = function (event) {\n\t\t\tif (element.kind == 'list') {\n\n\t\t\t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t\t\t\t\ttemp = [],\n\t\t\t\t\tsrcList = event.target.parentNode.parentNode.querySelectorAll('ul article .wptb-list-item-content');\n\n\t\t\t\tfor (var i = 0; i < srcList.length; i++) {\n\t\t\t\t\ttemp.push(srcList[i].innerHTML);\n\t\t\t\t}\n\t\t\t\tvar copy = new WPTB_List(temp);\n\t\t\t\ttd.appendChild(copy.getDOMElement());\n\n\t\t\t} else if (element.kind == 'text') {\n\t\t\t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t\t\t\t\tcopy = new WPTB_Text(event.target.parentNode.parentNode.childNodes[0].innerHTML);\n\t\t\t\ttd.appendChild(copy.getDOMElement());\n\t\t\t} else if (element.kind == 'image') {\n\t\t\t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t\t\t\t\tcopy = new WPTB_Image(event.target.parentNode.parentNode.childNodes[0].src);\n\t\t\t\ttd.appendChild(copy.getDOMElement());\n\t\t\t} else {\n\t\t\t\tvar td = event.target.parentNode.parentNode.parentNode,\n\t\t\t\t\tcopy = new WPTB_Button(event.target.parentNode.parentNode.childNodes[0].innerHTML);\n\t\t\t\ttd.appendChild(copy.getDOMElement());\n\t\t\t}\n\t\t};\n\t\tbtnMove.ondragstart = function (event) {\n\t\t\tvar parent = this, infArr, type;\n\n\t\t\twhile (parent.className == '' ||\n\t\t\t\t!parent.classList.contains('wptb-ph-element')) {\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\n\t\t\tinfArr = parent.className.match(/wptb-element-(.+)-(\\d+)/i);\n\t\t\ttype = infArr[1];\n\n\t\t\tvar img = document.createElement(\"img\");\n\t\t\timg.src = \"http://localhost/sandbox/wp-content/plugins/wp-table-builder/inc/admin/views/builder/icons/\" + type + \".png\";\n\t\t\tevent.dataTransfer.setDragImage(img, 0, 0);\n\t\t\tevent.dataTransfer.setData('node', 'wptb-element-' + infArr[1] + '-' + infArr[2]);\n\t\t};\n\n\t\tif (element.kind === 'button') {\n\t\t\ttinyMCE.init({\n\t\t\t\ttarget: node.childNodes[0].childNodes[0],\n\t\t\t\tinline: true,\n\t\t\t\tplugins: \"link\",\n\t\t\t\tdialog_type: \"modal\",\n\t\t\t\ttheme: 'modern',\n\t\t\t\tmenubar: false,\n\t\t\t\tfixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t\t\t\ttoolbar: 'bold italic strikethrough',\n\t\t\t\tverify_html: false,\n\t\t\t\tsetup: function (ed) {\n\t\t\t\t\ted.on(\"init\",\n\t\t\t\t\t\tfunction (ed) {\n\t\t\t\t\t\t\ttinyMCE.execCommand('mceRepaint');\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tinit_instance_callback: function (editor) {\n\t\t\t\t\teditor.on('change', function (e) {\n\t\t\t\t\t\t// check if it becomes empty because if there's no value it's hard to edit the editor in button element\n\t\t\t\t\t\tif (editor.getContent().trim() == \"\") {\n\t\t\t\t\t\t\teditor.setContent(\"<a class='wptb-button'>Button Text</a>\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\teditor.on('KeyDown', function (e) {\n\t\t\t\t\t\tvar range = editor.selection.getRng();\n\t\t\t\t\t\tvar KeyID = e.keyCode;\n\t\t\t\t\t\tif (range.startOffset == 0 && (KeyID == 8 || KeyID == 46)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\teditor.setContent(\"<p class='wptb-button'></p>\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\twindow.currentEditor = editor;\n\t\t\t\t\teditor.on('focus', function (e) {\n\t\t\t\t\t\tvar totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t\t\tif (window.currentEditor &&\n\t\t\t\t\t\t\tdocument.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t\t\t\twindow.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (element.kind === 'text') {\n\t\t\ttinyMCE.init({\n\t\t\t\ttarget: node.childNodes[0],\n\t\t\t\tinline: true,\n\t\t\t\tplugins: \"link, paste\",\n\t\t\t\tdialog_type: \"modal\",\n\t\t\t\ttheme: 'modern',\n\t\t\t\tmenubar: false,\n\t\t\t\tfixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t\t\t\tpaste_as_text: true,\n\t\t\t\ttoolbar: 'bold italic strikethrough link unlink | alignleft aligncenter alignright alignjustify',\n\t\t\t\tinit_instance_callback: function (editor) {\n\t\t\t\t\twindow.currentEditor = editor;\n\t\t\t\t\teditor.on('focus', function (e) {\n\n\t\t\t\t\t\tvar totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t\t\tif (window.currentEditor &&\n\t\t\t\t\t\t\tdocument.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t\t\t\twindow.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t} else {\n\t\t\tlistItems = node.getElementsByClassName('wptb-list-item-content');\n\t\t\tfor (var i = 0; i < listItems.length; i++) {\n\t\t\t\ttinyMCE.init({\n\t\t\t\t\ttarget: listItems[i],\n\t\t\t\t\tinline: true,\n\t\t\t\t\tplugins: \"link, paste\",\n\t\t\t\t\tdialog_type: \"modal\",\n\t\t\t\t\ttheme: 'modern',\n\t\t\t\t\tmenubar: false,\n\t\t\t\t\tfixed_toolbar_container: '#wpcd_fixed_toolbar',\n\t\t\t\t\tpaste_as_text: true,\n\t\t\t\t\ttoolbar: 'bold italic strikethrough link unlink | alignleft aligncenter alignright alignjustify',\n\t\t\t\t\tinit_instance_callback: function (editor) {\n\t\t\t\t\t\twindow.currentEditor = editor;\n\t\t\t\t\t\teditor.on('focus', function (e) {\n\t\t\t\t\t\t\tvar totalWidth = document.getElementsByClassName('wptb-builder-panel')[0].offsetWidth;\n\t\t\t\t\t\t\tif (window.currentEditor &&\n\t\t\t\t\t\t\t\tdocument.getElementById('wptb_builder').scrollTop >= 55 &&\n\t\t\t\t\t\t\t\twindow.currentEditor.bodyElement.style.display != 'none') {\n\t\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'fixed';\n\t\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.right = (totalWidth / 2 - document.getElementById('wpcd_fixed_toolbar').offsetWidth / 2) + 'px';\n\t\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.top = '100px';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdocument.getElementById('wpcd_fixed_toolbar').style.position = 'static';\n\t\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.right;\n\t\t\t\t\t\t\t\tdelete document.getElementById('wpcd_fixed_toolbar').style.top;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tactions.appendChild(btnMove);\n\t\tactions.appendChild(btnCopy);\n\t\tactions.appendChild(btnDelete);\n\t\tthis.appendChild(actions);\n\t};\n\n\tnode.onmouseleave = function (event) {\n\t\tvar formerActions = this.getElementsByClassName('wptb-actions');\n\t\tif (formerActions && formerActions[0]) {\n\t\t\tlet par = formerActions[0].parentNode;\n\t\t\tpar.removeChild(formerActions[0]);\n\t\t}\n\t\tthis.classList.remove('wptb-directlyhovered');\n\t};\n\n\tnode.classList.add('wptb-ph-element', 'wptb-element-' + element.kind + '-' +\n\t\tindex);\n\n\tnew WPTB_ElementOptions(element, index);\n\n\tdocument.counter.increment(element.kind);\n\n};",""]}