(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const r=window.ReactDOM,n=window.React,e=window.wp.data,o=function(t){var n=t.targetQuery,e=t.children,o=document.querySelector(n);return o?(0,r.createPortal)(e,o):null},i=function(t,r){this.blockId=t,this.promotionTargetId=r},a=window.wp.components,c=window.ReactJSXRuntime;function l(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,o,i,a,c=[],l=!0,u=!1;try{if(i=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;l=!1}else for(;!(l=(e=i.call(n)).done)&&(c.push(e.value),c.length!==r);l=!0);}catch(t){u=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,r)||function(t,r){if(t){if("string"==typeof t)return u(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}const s=function(t){var r,e=t.promotion,o=t.onBlacklistRequest,i=t.onPromotionInstall,u=t.onReload,s=l((0,n.useState)(!1),2),d=s[0],f=s[1],p=l((0,n.useState)(!1),2),m=p[0],y=p[1],b=l((0,n.useState)(!1),2),h=b[0],v=b[1],g=function(t){return t.charAt(0).toUpperCase()+t.slice(1)};return(0,c.jsxs)(a.Card,{className:"dotcamp-promoter-inspector-card",children:[(0,c.jsxs)(a.CardHeader,{className:"dotcamp-promoter-inspector-card__header",children:[(0,c.jsxs)("h2",{className:"dotcamp-promoter-inspector-card__header__heading",children:["".concat(g(e.promotionTarget)," Plugin"),(0,c.jsx)(a.Tooltip,{text:"Recommended by ".concat(g(e.promoterPlugin)),placement:"top",children:(0,c.jsx)("span",{children:(0,c.jsx)(a.Dashicon,{className:"dotcamp-promoter-inspector-card__body__info-tooltip-anchor",icon:"info-outline",size:14})})})]}),(0,c.jsx)(a.Button,{className:"dotcamp-promoter-inspector-card__header__toggle-button",onClick:function(){return o(e)},children:(0,c.jsx)(a.Dashicon,{icon:"no-alt"})})]}),(0,c.jsx)(a.CardBody,{className:"dotcamp-promoter-inspector-card__body",children:h?m?(0,c.jsxs)("div",{className:"dotcamp-promoter-inspector-card__body__success",children:[g(e.promotionTarget)," ","installed successfully. Save your work and reload this page to start using."]}):(0,c.jsx)("div",{className:"dotcamp-promoter-inspector-card__body__error",children:"An error occurred. Please try again later."}):(0,c.jsx)("div",{className:"dotcamp-promoter-inspector-card__body__description",children:(0,c.jsxs)("div",{children:[e.description,e.linkHref&&(0,c.jsx)(a.ExternalLink,{className:"dotcamp-promoter-inspector-card__body__description__link",href:e.linkHref,children:null!==(r=e.linkLabel)&&void 0!==r?r:"Link"})]})})}),(0,c.jsx)(a.CardFooter,{className:"dotcamp-promoter-inspector-card__footer",children:h&&m?(0,c.jsx)(a.Button,{variant:"secondary",onClick:u,children:"Reload"}):(0,c.jsxs)("div",{className:"dotcamp-promoter-inspector-card__footer__install-button-container",children:[(0,c.jsx)(a.Button,{disabled:d,onClick:function(){f(!0),v(!1),i(e).then((function(){y(!0)})).catch((function(){y(!1)})).finally((function(){f(!1),v(!0)}))},variant:"secondary",children:"Install"}),d&&(0,c.jsx)("span",{className:"dotcamp-promoter-inspector-card__footer__install-button-container__spinner",children:(0,c.jsx)(a.Dashicon,{icon:"update",size:20})})]})})]})};function d(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,o,i,a,c=[],l=!0,u=!1;try{if(i=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;l=!1}else for(;!(l=(e=i.call(n)).done)&&(c.push(e.value),c.length!==r);l=!0);}catch(t){u=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,r)||function(t,r){if(t){if("string"==typeof t)return f(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}const p=function(t){var r=t.blackListRequest,e=t.installRequest,o=t.reloadRequest,i=t.promotions,a=t.blackList,l=t.activeBlock,u=d((0,n.useState)(!1),2),f=u[0],p=u[1],m=d((0,n.useState)(null),2),y=m[0],b=m[1];return(0,n.useEffect)((function(){if(l){var t=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=i.filter((function(r){return r.blocksToUse.includes(t)&&!function(t){return a.some((function(r){return t.blocksToUse.includes(l)&&r.blockId===l&&r.promotionTargetId===t.promotionTargetId}))}(r)}));return r&&(n=n.reduce((function(t,r){return t.some((function(t){return t.promotionTargetId===r.promotionTargetId}))||t.push(r),t}),[])),n}(l,!0);t&&t.length?(p(!0),b(t)):(p(!1),b(null))}else p(!1),b(null)}),[l,a]),f&&y.map((function(t){return(0,c.jsx)(s,{promotion:t,onBlacklistRequest:r,onPromotionInstall:e,onReload:o},"".concat(t.promoterPluginId,"_").concat(t.promotionTargetId))}))};function m(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,o,i,a,c=[],l=!0,u=!1;try{if(i=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;l=!1}else for(;!(l=(e=i.call(n)).done)&&(c.push(e.value),c.length!==r);l=!0);}catch(t){u=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,r)||y(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,r){if(t){if("string"==typeof t)return b(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,r):void 0}}function b(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}const h=(0,e.withSelect)((function(t){var r;return{activeBlockName:null===(r=(0,t("core/block-editor").getSelectedBlock)())||void 0===r?void 0:r.name}}))((function(t){var r=t.promotions,e=t.portalQuery,a=t.activeBlockName,l=t.blackList,u=t.blacklistAjaxInfo,s=t.installAjaxInfo,d=m((0,n.useState)([]),2),f=d[0],h=d[1],v=m((0,n.useState)(!1),2),g=v[0],w=v[1],j=(0,n.useRef)(g);return(0,n.useEffect)((function(){j.current=g}),[g]),(0,n.useEffect)((function(){h(l)}),[l]),(0,n.useEffect)((function(){var t=function(t){j.current&&(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[]),(0,c.jsx)(o,{targetQuery:e,children:(0,c.jsx)(p,{promotions:r,blackListRequest:function(t){var r,n=u.action,e=u.nonce,o=u.url,c=new FormData;c.append("action",n),c.append("_wpnonce",e),c.append("promotionTargetId",t.promotionTargetId),c.append("blockId",a),f.some((function(r){return r.promotionTargetId===t.promotionTargetId&&r.blockId===a}))||(h([].concat(function(t){if(Array.isArray(t))return b(t)}(r=f)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||y(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[new i(a,t.promotionTargetId)])),fetch(o,{method:"POST",body:c}).catch((function(){})))},installRequest:function(t){var r=s.action,n=s.nonce,e=s.url,o=new FormData;return o.append("action",r),o.append("_wpnonce",n),o.append("promotionTargetId",t.promotionTargetId),w(!0),fetch(e,{method:"POST",body:o}).then((function(t){if(t.ok)return t.json();throw new Error("Network response was not ok.")})).then((function(t){if(t.success)return!0;throw new Error("Response was not successful.")})).finally((function(){w(!1)}))},reloadRequest:function(){window.location.reload()},blackList:f,activeBlock:a})})})),v=function(t,r,n){this.action=t,this.nonce=r,this.url=n},g=function(t,r,n,e,o,i){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.promoterPluginId=t,this.promoterPlugin=r,this.promotionTarget=n,this.promotionTargetId=e,this.description=o,this.blocksToUse=i,this.linkHref=a,this.linkLabel=c};function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function j(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.push.apply(n,e)}return n}function _(t,r,n){return(r=function(t){var r=function(t){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}var k;k=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?j(Object(n),!0).forEach((function(r){_(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}({},(t.g||window).dotcampPromoterEditorData),document.addEventListener("DOMContentLoaded",(function(){var t=document.createRange();t.setStart(document.body,0);var n=t.createContextualFragment('<div id="dotcampPromoterContainer"></div>');document.body.appendChild(n);var e=(0,r.createRoot)(document.getElementById("dotcampPromoterContainer")),o=k.promotions,a=k.ajax,l=k.blacklist,u=a.blacklist,s=a.install,d=new v(u.action,u.nonce,u.url),f=new v(s.action,s.nonce,s.url),p=o.map((function(t){var r=t.promoterPluginId,n=t.promoterPlugin,e=t.promotionTarget,o=t.promotionTargetId,i=t.description,a=t.blocksToUse,c=t.linkHref,l=t.linkLabel;return new g(r,n,e,o,i,a,c,l)})),m=l.map((function(t){var r=t.blockId,n=t.promotionPluginId;return new i(r,n)}));e.render((0,c.jsx)(h,{promotions:p,portalQuery:".editor-sidebar__panel",blacklistAjaxInfo:d,blackList:m,installAjaxInfo:f}))}))})();